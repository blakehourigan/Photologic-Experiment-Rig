<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>valve_testing_window API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#logger">logger</a>
            </li>
            <li>
                    <a class="variable" href="#rig_config">rig_config</a>
            </li>
            <li>
                    <a class="variable" href="#TOTAL_VALVES">TOTAL_VALVES</a>
            </li>
            <li>
                    <a class="variable" href="#VALVES_PER_SIDE">VALVES_PER_SIDE</a>
            </li>
            <li>
                    <a class="class" href="#WindowMode">WindowMode</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#WindowMode.TESTING">TESTING</a>
                        </li>
                        <li>
                                <a class="variable" href="#WindowMode.PRIMING">PRIMING</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ValveTestWindow">ValveTestWindow</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ValveTestWindow.__init__">ValveTestWindow</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.arduino_controller">arduino_controller</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.arduino_data">arduino_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.window_mode">window_mode</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.test_running">test_running</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.prime_running">prime_running</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.desired_volume">desired_volume</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.actuations">actuations</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.ml_dispensed">ml_dispensed</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.valve_buttons">valve_buttons</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.valve_test_button">valve_test_button</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.table_entries">table_entries</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.valve_selections">valve_selections</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.side_one_tests">side_one_tests</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.side_two_tests">side_two_tests</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.stop_event">stop_event</a>
                        </li>
                        <li>
                                <a class="variable" href="#ValveTestWindow.manual_adjust_window">manual_adjust_window</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.setup_basic_window_attr">setup_basic_window_attr</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.show">show</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.switch_window_mode">switch_window_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.create_interface">create_interface</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.start_testing_toggle">start_testing_toggle</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.create_buttons">create_buttons</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.create_valve_test_table">create_valve_test_table</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.update_table_entry_test_status">update_table_entry_test_status</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.update_table_entries">update_table_entries</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.toggle_valve_button">toggle_valve_button</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.verify_variables">verify_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.verify_schedule">verify_schedule</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.send_schedules">send_schedules</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.stop_priming">stop_priming</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.take_input">take_input</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.run_test">run_test</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.abort_test">abort_test</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.testing_complete">testing_complete</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.auto_update_durations">auto_update_durations</a>
                        </li>
                        <li>
                                <a class="function" href="#ValveTestWindow.confirm_valve_changes">confirm_valve_changes</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
valve_testing_window    </h1>

                        <div class="docstring"><p>This module defines the ValveTestWindow class, a Tkinter Toplevel window
providing functionality for testing and priming valves. Test and prime procedures are
facilitated via the <code>controllers.arduino_control.ArduinoManager</code>.</p>

<p>It allows users to:</p>

<ul>
<li>Select individual valves for testing or priming.</li>
<li>Configure test parameters like desired dispense volume and number of actuations.</li>
<li>Initiate automated valve tests, calculating new opening durations based on
user-provided dispensed volumes.</li>
<li>Initiate valve test/priming sequences.</li>
<li>Manually override and adjust valve timings via a separate window (<code>ManualTimeAdjustment</code>).</li>
<li>View test results and current valve timings in a table format.</li>
<li>Confirm or abort automatically calculated timing changes.</li>
</ul>

<p>This window interacts heavily with the <code>controllers.arduino_control.ArduinoManager</code> controller for communication
and the <code>modesl.arduino_data.ArduinoData</code> model for storing/retrieving valve duration configurations.</p>

<p>It uses <code>views.gui_common.GUIUtils</code> for common UI elements and window management.</p>
</div>

                        <input id="mod-valve_testing_window-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-valve_testing_window-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">This module defines the ValveTestWindow class, a Tkinter Toplevel window</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">providing functionality for testing and priming valves. Test and prime procedures are</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">facilitated via the `controllers.arduino_control.ArduinoManager`.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">It allows users to:</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">- Select individual valves for testing or priming.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">- Configure test parameters like desired dispense volume and number of actuations.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">- Initiate automated valve tests, calculating new opening durations based on</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">  user-provided dispensed volumes.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">- Initiate valve test/priming sequences.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">- Manually override and adjust valve timings via a separate window (`ManualTimeAdjustment`).</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">- View test results and current valve timings in a table format.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">- Confirm or abort automatically calculated timing changes.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">This window interacts heavily with the `controllers.arduino_control.ArduinoManager` controller for communication</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">and the `modesl.arduino_data.ArduinoData` model for storing/retrieving valve duration configurations.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">It uses `views.gui_common.GUIUtils` for common UI elements and window management.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tk</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">N</span><span class="p">,</span> <span class="n">simpledialog</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ttk</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="c1">### USED FOR TYPE HINTING ###</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">toml</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">controllers.arduino_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArduinoManager</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">models.arduino_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArduinoData</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">views.gui_common</span><span class="w"> </span><span class="kn">import</span> <span class="n">GUIUtils</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">views.valve_testing.manual_time_adjustment_window</span><span class="w"> </span><span class="kn">import</span> <span class="n">ManualTimeAdjustment</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">views.valve_testing.valve_changes_window</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValveChanges</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">system_config</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">&quot;&quot;&quot;Get the logger in use for the app.&quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="n">rig_config</span> <span class="o">=</span> <span class="n">system_config</span><span class="o">.</span><span class="n">get_rig_config</span><span class="p">()</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rig_config</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="n">VALVE_CONFIG</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="s2">&quot;valve_config&quot;</span><span class="p">]</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="c1"># pull total valves constant from toml config</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="n">TOTAL_VALVES</span> <span class="o">=</span> <span class="n">VALVE_CONFIG</span><span class="p">[</span><span class="s2">&quot;TOTAL_CURRENT_VALVES&quot;</span><span class="p">]</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="n">VALVES_PER_SIDE</span> <span class="o">=</span> <span class="n">TOTAL_VALVES</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WindowMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">    Represents the two primary operational modes of the ValveTestWindow:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">    Testing mode for calibrating valve durations, and Priming mode for</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">    actuating valves repeatedly without calibration.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>    <span class="n">TESTING</span> <span class="o">=</span> <span class="s2">&quot;Testing&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>    <span class="n">PRIMING</span> <span class="o">=</span> <span class="s2">&quot;Priming&quot;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ValveTestWindow</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">):</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">    *This is a bit of a god class and should likely be refactored... but for now... it works!*</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    Implements the main Tkinter Toplevel window for valve testing and priming operations.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">    This window provides an interface to interact with the Arduino</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">    controller for calibrating valve open times based on dispensed volume or</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">    for running priming sequences. It features modes for testing and</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">    priming, manages valve selections, displays test progress and results,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">    and handles communication with the Arduino.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">    Attributes</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">    ----------</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">    - **`arduino_controller`** (*ArduinoManager*): Reference to the main Arduino controller instance, used for sending commands and data.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">    - **`arduino_data`** (*ArduinoData*): Reference to the data model holding valve duration configurations.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">    - **`window_mode`** (*WindowMode*): Enum indicating the current operational mode (Testing or Priming).</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">    - **`test_running`** (*bool*): Flag indicating if an automated test sequence is currently active.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">    - **`prime_running`** (*bool*): Flag indicating if a priming sequence is currently active.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">    - **`desired_volume`** (*tk.DoubleVar*): Tkinter variable storing the target volume (in microliters) per actuation for automatic duration calculation.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">    - **`actuations`** (*tk.IntVar*): Tkinter variable storing the number of times each valve should be actuated during a test or prime sequence.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">    - **`ml_dispensed`** (*list[tuple[int, float]]*): Stores tuples of (valve_number, dispensed_volume_ml) entered by the user during a test.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">    - **`valve_buttons`** (*list[tk.Button | None]*): List holding the Tkinter Button widgets for each valve selection.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">    - **`valve_test_button`** (*tk.Button | None*): The main button used to start/abort tests or start/stop priming.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">    - **`table_entries`** (*list[str | None]*): List holding the item IDs for each row in the ttk.Treeview table, used for modifying/hiding/showing specific rows.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">    - **`valve_selections`** (*npt.NDArray[np.int8]*): Numpy array representing the selection state of each valve (0 if not selected, valve_number if selected).</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">    - **`side_one_tests`** (*npt.NDArray[np.int8] | None*): Numpy array holding the valve numbers (0-indexed) selected for testing/priming on side one.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">    - **`side_two_tests`** (*npt.NDArray[np.int8] | None*): Numpy array holding the valve numbers (0-indexed) selected for testing/priming on side two.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">    - **`stop_event`** (*threading.Event*): Event flag used to signal the Arduino listener thread (`run_test`) to stop.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">    - **`mode_button`** (*tk.Button*): Button to switch between Testing and Priming modes.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">    - **`dispensed_vol_frame`** (*tk.Frame*): Container frame for the desired volume input elements (visible in Testing mode).</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">    - **`valve_table_frame`** (*tk.Frame*): Container frame for the valve test results table (visible in Testing mode).</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">    - **`valve_table`** (*ttk.Treeview*): The table widget displaying valve numbers, test status, and timings.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">    - **`valve_buttons_frame`** (*tk.Frame*): Main container frame for the side-by-side valve selection buttons.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">    - **`side_one_valves_frame`** (*tk.Frame*): Frame holding valve selection buttons for the first side.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">    - **`side_two_valves_frame`** (*tk.Frame*): Frame holding valve selection buttons for the second side.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">    - **`manual_adjust_window`** (*ManualTimeAdjustment*): Instance of the separate window for manual timing adjustments.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">    Methods</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">    -------</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">    - `setup_basic_window_attr`()</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">        Configures basic window properties like title, key bindings, and icon.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">    - `show`()</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">        Makes the window visible (deiconifies).</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">    - `switch_window_mode`()</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">        Toggles the window between Testing and Priming modes, adjusting UI elements accordingly.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">    - `create_interface`()</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">        Builds the entire GUI layout, placing widgets and frames.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">    - `start_testing_toggle`()</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">        Handles the press of the main test/prime button in Testing mode (starts or aborts test).</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">    - `create_buttons`()</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">        Creates and places the valve selection buttons and the main start/abort button.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">    - `create_valve_test_table`()</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        Creates the ttk.Treeview table for displaying valve test results and timings.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">    - `update_table_entry_test_status`(...)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">        Updates the &#39;Amount Dispensed&#39; column for a specific valve in the table.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">    - `update_table_entries`(...)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        Updates the entire valve table, showing/hiding rows based on selections and refreshing currently loaded durations.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">    - `toggle_valve_button`(...)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">        Handles clicks on valve selection buttons, updating their appearance and the `valve_selections` array.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">    - `verify_variables`(...)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        Reads verification data back from Arduino to confirm test parameters were received correctly.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">    - `verify_schedule`(...)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        Reads verification data back from Arduino to confirm the valve test/prime schedule was received correctly.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">    - `send_schedules`()</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        Sends the command, parameters (schedule lengths, actuations), and valve schedule to the Arduino. Handles mode-specific commands and confirmations.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">    - `stop_priming`()</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        Sends a command to the Arduino to stop an ongoing priming sequence.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">    - `take_input`(...)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        Prompts the user (via simpledialog) to enter the dispensed volume for a completed valve test pair. Sends confirmation back to Arduino.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">    - `run_test`()</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">        Runs in a separate thread to listen for messages from the Arduino during a test, triggering events for input prompts or completion.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">    - `abort_test`()</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        Sends a command to the Arduino to abort the current test and stops the listener thread.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">    - `testing_complete`(...)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        Handles the event triggered when the Arduino signals the end of the entire test sequence. Initiates duration updates.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">    - `auto_update_durations`()</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        Calculates new valve durations based on test results (`ml_dispensed`) and opens the `ValveChanges` confirmation window.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">    - `confirm_valve_changes`(...)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        Callback function executed if the user confirms changes in the `ValveChanges` window. Saves new durations and archives old ones via `ArduinoData`.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arduino_controller</span><span class="p">:</span> <span class="n">ArduinoManager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        Initializes the ValveTestWindow.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">        Parameters</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        ----------</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">        - **arduino_controller** (*ArduinoManager*): The application&#39;s instance of the Arduino controller.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">        Raises</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        ------</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        - Propagates exceptions from `GUIUtils` methods during icon setting.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        - Propagates exceptions from `arduino_data.load_durations()`.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="p">:</span> <span class="n">ArduinoManager</span> <span class="o">=</span> <span class="n">arduino_controller</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="p">:</span> <span class="n">ArduinoData</span> <span class="o">=</span> <span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">setup_basic_window_attr</span><span class="p">()</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span><span class="p">:</span> <span class="n">WindowMode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">Button</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">TOTAL_VALVES</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">TOTAL_VALVES</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="p">(</span><span class="n">TOTAL_VALVES</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_interface</span><span class="p">()</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="c1"># hide main window for now until we deliberately enter this window.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span> <span class="o">=</span> <span class="n">ManualTimeAdjustment</span><span class="p">(</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="c1"># hide the adjustment window until we need it.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Valve Test Window initialized.&quot;</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_basic_window_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        Sets up fundamental window properties.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        Configures the window title, binds Ctrl+W and the close button (&#39;X&#39;)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">        to hide the window, sets grid column/row weights for resizing behavior,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        and applies the application icon using `GUIUtils`.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Testing&quot;</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Control-w&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">())</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span><span class="s2">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">())</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="n">window_icon_path</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">get_window_icon_path</span><span class="p">()</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">set_program_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon_path</span><span class="o">=</span><span class="n">window_icon_path</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        Makes the ValveTestWindow visible.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        Calls `deiconify()` to show the window if it was previously hidden (withdrawn).</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">switch_window_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        Toggles the window&#39;s operational mode between Testing and Priming.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        Updates the window title and mode button text/color. Hides or shows</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        mode-specific UI elements (desired volume input, test results table).</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        Changes the command associated with the main start/stop button.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        Prevents mode switching if a test or prime sequence is currently running to avoid Arduino</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        Communications errors. Resizes and centers the window after GUI changes.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>                <span class="c1"># if the test is currently running we do not want to switch modes. Stop testing to switch modes</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>                <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>                    <span class="s2">&quot;ACTION PROHIBITED&quot;</span><span class="p">,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>                    <span class="s2">&quot;You cannot switch modes while a test is running. If you&#39;d like to switch modes, please abort the test and try again.&quot;</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>                <span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                <span class="k">return</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Priming&quot;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Switch to Testing Mode&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;DeepSkyBlue3&quot;</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>            <span class="c1"># orig. row 1</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>            <span class="c1"># orig. row 3</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>            <span class="c1"># start testing button -&gt; start priming button / command</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Priming&quot;</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                    <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                    <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">(),</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                <span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                <span class="c1"># if the test is currently running we do not want to switch modes. Stop testing to switch modes</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>                    <span class="s2">&quot;ACTION PROHIBITED&quot;</span><span class="p">,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                    <span class="s2">&quot;You cannot switch modes while a valve prime operation is running. If you&#39;d like to switch modes, please abort the prime and try again.&quot;</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                <span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                <span class="k">return</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Testing&quot;</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Switch to Priming Mode&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                    <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                    <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_testing_toggle</span><span class="p">(),</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                <span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="c1"># resize the window to fit current content</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">center_window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">        Constructs and arranges all GUI elements within the window.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">        Creates frames for structure, input fields (desired volume, actuations),</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        the mode switch button, the valve selection buttons, the test results table,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        and the main start/abort/prime button. Uses `GUIUtils` for</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        widget creation where possible. Calls helper methods `create_valve_test_table`</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">        and `create_buttons`. Centers the window after creation.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="s2">&quot;Switch to Priming Mode&quot;</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_window_mode</span><span class="p">(),</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>        <span class="c1"># create a new frame to contain the desired dispensed volume label and frame</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Desired Dispensed Volume in Microliters (ul)&quot;</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;dark blue&quot;</span><span class="p">,</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>        <span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="p">,</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>            <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="p">,</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="c1"># create another new frame to contain the amount of times each</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="c1"># valve should actuate label and frame</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="n">frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="n">frame</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;How Many Times Should the Valve Actuate?&quot;</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;dark blue&quot;</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="n">frame</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="c1">### ROW 3 ###</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_valve_test_table</span><span class="p">()</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="c1"># setup frames for valve buttons</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="c1">### ROW 4 ###</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="c1">### ROW 5 ###</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_buttons</span><span class="p">()</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">center_window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_testing_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">        Handles the action of the main button when in Testing mode.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        If a test is running, it calls `abort_test()` and updates the button appearance.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        If no test is running, it calls `send_schedules()` to initiate a new test.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">()</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">        Creates and places the individual valve selection buttons and the main action button.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">        Generates buttons for each valve (1 to TOTAL_VALVES), arranging them</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        into side-one and side-two frames using `GUIUtils.create_button`.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">        Assigns the `toggle_valve_button` command to each valve button.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        Creates the main &#39;Start Testing&#39; / &#39;Start Priming&#39; / &#39;Abort&#39; button.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">):</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="c1"># GUIUtils.create_button returns both the buttons frame and button object in a tuple. using [1] on the</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="c1"># return item yields the button object.</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="c1"># return the side one button and put it on the side one &#39;side&#39;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="c1"># of the list (0-4)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="p">,</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                <span class="sa">f</span><span class="s2">&quot;Valve </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_valve_button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                <span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                <span class="mi">0</span><span class="p">,</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="c1"># return the side two button and put it on the side two &#39;side&#39;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>            <span class="c1"># of the list (5-8)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="p">,</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                <span class="sa">f</span><span class="s2">&quot;Valve </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_valve_button</span><span class="p">(</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)],</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                <span class="p">),</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                <span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                <span class="mi">0</span><span class="p">,</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_testing_toggle</span><span class="p">(),</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_valve_test_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">        Creates, configures, and populates the initial state of the ttk.Treeview table.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        Sets up the table columns (&quot;Valve&quot;, &quot;Amount Dispensed...&quot;, &quot;Testing Opening Time...&quot;).</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        Adds a button above the table to open the `ManualTimeAdjustment` window.</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">        Loads the currently selected valve durations from `models.arduino_data.ArduinoData`.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">        Inserts initial rows for all possible valves, marking them as &quot;Test Not Complete&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        and displaying their current duration. Stores row IDs in `self.table_entries` for later access.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="c1"># this function creates and labels the testing window table that displays the information recieved from the arduino reguarding the results of the tes</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="c1"># tell the frame to fill the available width</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Treeview</span><span class="p">(</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;headings&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">12</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="n">headings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>            <span class="s2">&quot;Valve&quot;</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="s2">&quot;Amount Dispensed Per Lick (ul)&quot;</span><span class="p">,</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>            <span class="s2">&quot;Testing Opening Time of (ms)&quot;</span><span class="p">,</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="p">]</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headings</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;ew&quot;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="n">button</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="p">,</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Manual Valve Duration Override&quot;</span><span class="p">,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span><span class="o">.</span><span class="n">show</span><span class="p">(),</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="n">button</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="c1"># Configure the columns</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="n">arduino_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="n">side_one_durations</span><span class="p">,</span> <span class="n">side_two_durations</span><span class="p">,</span> <span class="n">date_used</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="c1"># insert default entries for each total valve until user selects how many</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="c1"># they want to test</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">):</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>                    <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">side_one_durations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>                <span class="p">),</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>            <span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>                <span class="n">i</span> <span class="o">+</span> <span class="n">VALVES_PER_SIDE</span><span class="p">,</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>                <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">VALVES_PER_SIDE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>                    <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">side_two_durations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                <span class="p">),</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_table_entry_test_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valve</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">l_per_lick</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">        Updates the &#39;Amount Dispensed Per Lick (ul)&#39; column for a specific valve row.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        Parameters</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        ----------</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        - **valve** (*int*): The 1-indexed valve number whose row needs updating.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        - **l_per_lick** (*float*): The calculated volume dispensed per lick in milliliters (mL).</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l_per_lick</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2"> uL&quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_table_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">        Refreshes the entire valve test table based on current selections and durations.</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">        Hides rows for unselected valves and shows rows for selected valves.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">        Reloads the latest durations from `ArduinoData` and updates the</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">        &#39;Testing Opening Time&#39; column for all visible rows. Resets the</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">        &#39;Amount Dispensed&#39; column to &quot;Test Not Complete&quot; for visible rows.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="c1"># np array where the entry is not zero but the valve number itself</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="n">selected_valves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="c1"># for all valve numbers, if that number is in selected_valves -1 (the entire array</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="c1"># decremented by one) place it in the table and ensure its duration is up-to-date</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TOTAL_VALVES</span><span class="p">):</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>            <span class="c1"># if the iter number is also contained in the selected valves arr</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">selected_valves</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                <span class="c1"># check if it&#39;s side two or side one</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">VALVES_PER_SIDE</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                    <span class="n">duration</span> <span class="o">=</span> <span class="n">side_two</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">VALVES_PER_SIDE</span><span class="p">]</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                    <span class="n">duration</span> <span class="o">=</span> <span class="n">side_one</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                    <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                        <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                    <span class="p">),</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                <span class="p">)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">reattach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Valve test table updated.&quot;</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_valve_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span> <span class="n">valve_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">        Handles the click event for a valve selection button.</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">        Toggles the button&#39;s visual state (raised/sunken). Updates the</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">        corresponding entry in the `self.valve_selections` numpy array (0 for</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">        deselected, valve_number + 1 for selected). Calls `update_table_entries`</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a><span class="sd">        to refresh the table display. Filling arrays this way allows us to tell</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">        the arduino exactly which valves should be toggled (1, 4, 7) as long as</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        their value in the array is not 0.</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        Parameters</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        ----------</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        - **button** (*tk.Button*): The specific valve button widget that was clicked.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">        - **valve_num** (*int*): The 0-indexed number of the valve corresponding to the button.</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="c1"># Attempt to get the value to ensure it&#39;s a valid float as expected</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="c1"># If successful, call the function to update/create the valve test table</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">valve_num</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_table_entries</span><span class="p">()</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        Verifies that the Arduino correctly received the test/prime parameters.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">        Waits for and reads back the schedule lengths and actuation count echoed</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">        by the Arduino. Compares the received bytes with the originally sent data.</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">        Parameters</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        ----------</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">        - **original_data** (*bytes*): The byte string containing schedule lengths and actuation count originally sent to the Arduino.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">        Returns</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        -------</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        - *bool*: `True` if the received data matches the original data, `False` otherwise (logs error and shows message box on mismatch).</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="c1"># wait until all data is on the wire ready to be read (4 bytes),</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="c1"># then read it all in quick succession</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="k">pass</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="n">ver_len_sched_sd_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>        <span class="n">ver_len_sched_sd_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="n">ver_valve_act_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="n">verification_data</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="n">ver_len_sched_sd_one</span> <span class="o">+</span> <span class="n">ver_len_sched_sd_two</span> <span class="o">+</span> <span class="n">ver_valve_act_time</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="k">if</span> <span class="n">verification_data</span> <span class="o">==</span> <span class="n">original_data</span><span class="p">:</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====VERIFIED TEST VARIABLES====&quot;</span><span class="p">)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT VARIABLES DETECTED, TRY AGAIN====&quot;</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_schedule</span><span class="p">(</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">len_sched</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sent_schedule</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">        Verifies that the Arduino correctly received the valve schedule.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        Waits for and reads back the valve numbers (0-indexed) echoed byte-by-byte</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">        by the Arduino. Compares the reconstructed numpy array with the schedule</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        that was originally sent.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        Parameters</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">        ----------</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">        - **len_sched** (*int*): The total number of valves in the schedule being sent.</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">        - **sent_schedule** (*npt.NDArray[np.int8]*): The numpy array (0-indexed valve numbers) representing the schedule originally sent.</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">        Returns</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">        -------</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">        - *bool*: `True` if the received schedule matches the sent schedule, `False` otherwise (logs error and shows message box on mismatch).</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="c1"># np array used for verification later</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">received_sched</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">len_sched</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&lt;</span> <span class="n">len_sched</span><span class="p">:</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="k">pass</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_sched</span><span class="p">):</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>            <span class="n">received_sched</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>            <span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">received_sched</span><span class="p">,</span> <span class="n">sent_schedule</span><span class="p">):</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;===TESTING SCHEDULE VERIFIED as ==&gt; </span><span class="si">{</span><span class="n">received_sched</span><span class="si">}</span><span class="s2">===&quot;</span><span class="p">)</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====================BEGIN TESTING NOW====================&quot;</span><span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_schedules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        Performs the process of sending test or prime configuration to the Arduino.</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">        Determines selected valves and schedule lengths for each side. Sends current</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        valve durations to Arduino. Then sends the appropriate command (&#39;TEST VOL&#39; or &#39;PRIME VALVES&#39;).</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        Sends test parameters (schedule lengths, actuations) and verifies them using `verify_variables`.</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        Sends the actual valve schedule (0-indexed) and verifies it using `verify_schedule`.</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">        User is then prompted to confirm before proceeding.</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        If confirmed, initiates the test/prime sequence on the Arduino</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        and starts the listener thread (`run_test`) if Testing, or sends start command if Priming.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        Updates button states accordingly.</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[:</span><span class="n">VALVES_PER_SIDE</span><span class="p">])</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">VALVES_PER_SIDE</span><span class="p">:])</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="n">len_sched_one</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="n">len_sched_two</span><span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">len_sched</span> <span class="o">=</span> <span class="n">len_sched_one</span> <span class="o">+</span> <span class="n">len_sched_two</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="c1"># because self.actuations is a IntVar, we use .get() method to get its value</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="n">valve_acuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>        <span class="c1"># schedule is TOTAL_VALVES long to accomodate testing of up to all valves at one time.</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="c1"># if we are not testing them all, filter out the zero entries (valves we are not testing)</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="c1"># decrement each element in the array by one to move to zero-indexing. We moved to 1</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="c1"># indexing becuase using zero indexing does not work with the method of toggling valves</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="c1"># defined above</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="n">schedule</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[:</span><span class="n">len_sched_one</span><span class="p">]</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="n">len_sched_one</span><span class="p">:]</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">len_sched_one</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">len_sched_two</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="n">valve_acuations</span> <span class="o">=</span> <span class="n">valve_acuations</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_valve_durations</span><span class="p">()</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>            <span class="c1">###====SENDING TEST COMMAND====###</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TEST VOL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span><span class="p">:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;PRIME VALVES</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="c1">###====SENDING TEST VARIABLES (len side one, two, num_actuations per test)====###</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="n">data_bytes</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="n">len_sched_one</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="o">+</span> <span class="n">len_sched_two</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="o">+</span> <span class="n">valve_acuations</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="c1"># verify the data</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_variables</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">):</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="k">return</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="c1">###====SENDING SCHEDULE====###</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="n">sched_data_bytes</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">sched_data_bytes</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_schedule</span><span class="p">(</span><span class="n">len_sched</span><span class="p">,</span> <span class="n">schedule</span><span class="p">):</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="k">return</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="n">schedule</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">valves</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valve</span><span class="p">)</span> <span class="k">for</span> <span class="n">valve</span> <span class="ow">in</span> <span class="n">schedule</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>            <span class="c1">####### ARDUINO HALTS HERE UNTIL THE GO-AHEAD IS GIVEN #######</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>            <span class="c1"># inc each sched element by one so that it is 1-indexes and matches the valve labels</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>            <span class="n">test_confirmed</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                <span class="s2">&quot;CONFIRM THE TEST SCHEDULE&quot;</span><span class="p">,</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                <span class="sa">f</span><span class="s2">&quot;Valves </span><span class="si">{</span><span class="n">valves</span><span class="si">}</span><span class="s2">, will be tested. Review the test table to confirm schedule and timings. Each valve will be actuated </span><span class="si">{</span><span class="n">valve_acuations</span><span class="si">}</span><span class="s2"> times. Ok to begin?&quot;</span><span class="p">,</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>            <span class="c1">### include section to manually modify timings</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="k">if</span> <span class="n">test_confirmed</span><span class="p">:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event0&gt;&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testing_complete</span><span class="p">)</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event1&gt;&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_input</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_test</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>            <span class="n">priming_confirmed</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                <span class="s2">&quot;CONFIRM THE ACTION&quot;</span><span class="p">,</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                <span class="sa">f</span><span class="s2">&quot;Valves </span><span class="si">{</span><span class="n">valves</span><span class="si">}</span><span class="s2">, will be primed (opened and closed) </span><span class="si">{</span><span class="n">valve_acuations</span><span class="si">}</span><span class="s2"> times. Ok to begin?&quot;</span><span class="p">,</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="p">)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>            <span class="k">if</span> <span class="n">priming_confirmed</span><span class="p">:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                <span class="c1"># in case of prime, we send 0 to mean continue or start</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>                <span class="c1"># and we send a 1 at any point to abort or cancel the prime</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;STOP Priming&quot;</span><span class="p">,</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                        <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                        <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_priming</span><span class="p">(),</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                    <span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop_priming</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">        Sends the stop command to the Arduino during a priming sequence.</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">        Sets the `prime_running` flag to False. Updates the prime button state.</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">        Sends a byte representation of 1 (`np.int8(1).tobytes()`) to signal abort to the Arduino.</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Priming&quot;</span><span class="p">,</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">(),</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>            <span class="p">)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">take_input</span><span class="p">(</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pair_num_override</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">        Prompts the user to enter the dispensed volume for a completed test pair.</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">        Determines which valve(s) were just tested based on the pair number received</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        from the Arduino (via the event state or override). Uses `simpledialog.askfloat`</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        to get the dispensed volume (in mL) for each valve in the pair. Stores the</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        results in `self.ml_dispensed`.</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        Sends a byte back to the Arduino to instruct if further pairs will be tested or if this is the final iteration,</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        (1 if via event, 0 if via override/final pair).</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">        Handles potential abort if the user cancels the dialog window.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">        Parameters</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">        ----------</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">        - **event** (*tk.Event | None*): Uses custom thread-safe event (`&lt;&lt;event1&gt;&gt;`) generated by `run_test`, carrying the pair number in `event.state`</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="sd">        attribute. This is None if called directly by `testing_complete`, which indicated procedure is now finished.</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">        - **pair_num_override** (*int | None, optional*): Allows manually specifying the pair number, used when called from `testing_complete` for the</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">        final pair. Defaults to None.</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="n">pair_number</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">state</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="n">pair_number</span> <span class="o">=</span> <span class="n">pair_num_override</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="c1"># decide how many valves were tested last. if 0 we will not arrive</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="c1"># here so we need not test for this.</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="k">if</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="p">):</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="p">]</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="k">elif</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">):</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="p">]</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="p">]</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="c1"># for each test that we ran store the amount dispensed or abort</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="k">for</span> <span class="n">valve</span> <span class="ow">in</span> <span class="n">valves_tested</span><span class="p">:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">simpledialog</span><span class="o">.</span><span class="n">askfloat</span><span class="p">(</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="s2">&quot;INPUT AMOUNT DISPENSED&quot;</span><span class="p">,</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                <span class="sa">f</span><span class="s2">&quot;Please input the amount of liquid dispensed for the test of valve </span><span class="si">{</span><span class="n">valve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>            <span class="p">)</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">valve</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>        <span class="k">if</span> <span class="n">pair_num_override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">        Listens for messages from the Arduino during an active test sequence (runs in a background thread).</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">        Sends the initial &#39;start test&#39; command byte to the Arduino. Enters a loop</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">        that continues as long as `self.test_running` is True and `self.stop_event`</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">        is not set. Checks for incoming data from the Arduino. Reads bytes indicating</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">        if more tests remain and the number of the just-completed pair. Generates</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        custom Tkinter events (`&lt;&lt;event1&gt;&gt;` for input dispensed liquid prompt, `&lt;&lt;event0&gt;&gt;` for test completion)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        to communicate back to the main GUI thread safely. Updates the main button state to &#39;ABORT TESTING&#39;.</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;ABORT TESTING&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="c1">###====SENDING BEGIN TEST COMMAND====###</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>            <span class="c1"># if stop event, shut down the thread</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                <span class="k">break</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                <span class="n">remaining_tests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>                <span class="n">pair_number</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>                    <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">,</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                    <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>                <span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>                <span class="k">if</span> <span class="n">remaining_tests</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">():</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event1&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">pair_number</span><span class="p">)</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>                <span class="k">if</span> <span class="n">remaining_tests</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">():</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event0&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">pair_number</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">abort_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">        Aborts an ongoing test sequence.</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        Sets the `self.stop_event` to signal the `run_test` listener thread to exit.</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        Sets `self.test_running` to False. Sends the abort *testing* command byte</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">        (`np.int8(0).tobytes()`) to the Arduino. Resets the main button state to &#39;Start Testing&#39;.</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="c1"># if test is aborted, stop the test listener thread</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="c1">###====SENDING ABORT TEST COMMAND====###</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">testing_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">        Handles the final steps after the Arduino signals test completion.</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">        Calls `take_input` one last time for the final test pair (using `pair_num_override`).</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">        Resets the main button state and `self.test_running` flag. Sets the</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">        `self.stop_event` to ensure the listener thread terminates cleanly.</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">        Calls `auto_update_durations` to process the collected data and suggest timing changes.</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">        Parameters</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">        ----------</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">        - **event** (*tk.Event*): The custom event (`&lt;&lt;event0&gt;&gt;`) generated by `run_test`, carrying the final pair number in `event.state`.</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="c1"># take input from last pair/valve</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">take_input</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair_num_override</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="c1"># reconfigure the testing button and testing state</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="c1"># stop the arduino testing listener thread</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="c1"># update valves and such</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_update_durations</span><span class="p">()</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">auto_update_durations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        This function is similar to the `views.valve_testing.manual_time_adjustment_window.ManualTimeAdjustment.write_timing_changes` function, it</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">        calculates new valve durations based on test results and desired volume.</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">        Loads the current &#39;selected&#39; durations. Iterates through the collected</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">        `self.ml_dispensed` data. For each tested valve, it calculates the actual</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">        volume dispensed per actuation and compares it to the desired volume per actuation.</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">        It computes a new duration using a ratio (`new_duration = old_duration * (desired_vol / actual_vol)`).</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        Updates the corresponding duration in the local copies of the side_one/side_two arrays.</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        Updates the table display for the valve using `update_table_entry_test_status`.</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        Compiles a list of changes (`changed_durations`) and opens the `ValveChanges`</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        confirmation window, passing the changes and the `confirm_valve_changes` callback.</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="c1"># list of tuples of tuples ==&gt; [(valve, (old_dur, new_dur))] sent to ChangesWindow instance, so that</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="c1"># user can confirm duration changes</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="n">changed_durations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="c1">## save current durations in the oldest valve duration archival location</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">date_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="n">side_one_old</span> <span class="o">=</span> <span class="n">side_one</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="n">side_two_old</span> <span class="o">=</span> <span class="n">side_two</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="k">for</span> <span class="n">valve</span><span class="p">,</span> <span class="n">dispensed_amt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="p">:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>            <span class="n">logical_valve</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>            <span class="n">tested_duration</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="n">side_durations</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="n">valve</span> <span class="o">&gt;</span> <span class="n">VALVES_PER_SIDE</span><span class="p">:</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="n">logical_valve</span> <span class="o">=</span> <span class="p">(</span><span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">VALVES_PER_SIDE</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                <span class="n">tested_duration</span> <span class="o">=</span> <span class="n">side_two</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                <span class="n">side_durations</span> <span class="o">=</span> <span class="n">side_two</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                <span class="n">logical_valve</span> <span class="o">=</span> <span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                <span class="n">tested_duration</span> <span class="o">=</span> <span class="n">side_one</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="n">side_durations</span> <span class="o">=</span> <span class="n">side_one</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>            <span class="c1"># divide by 1000 to get to mL from ul</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="n">desired_per_open_vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="c1"># divide by 1000 to get amount per opening, NOT changing units</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>            <span class="n">actual_per_open_vol</span> <span class="o">=</span> <span class="n">dispensed_amt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_table_entry_test_status</span><span class="p">(</span><span class="n">valve</span><span class="p">,</span> <span class="n">actual_per_open_vol</span><span class="p">)</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>            <span class="n">new_duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                <span class="n">tested_duration</span> <span class="o">*</span> <span class="p">(</span><span class="n">desired_per_open_vol</span> <span class="o">/</span> <span class="n">actual_per_open_vol</span><span class="p">)</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>            <span class="n">side_durations</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_duration</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="n">changed_durations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">valve</span><span class="p">,</span> <span class="p">(</span><span class="n">tested_duration</span><span class="p">,</span> <span class="n">new_duration</span><span class="p">)))</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="n">ValveChanges</span><span class="p">(</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="n">changed_durations</span><span class="p">,</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_valve_changes</span><span class="p">(</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">side_one_old</span><span class="p">,</span> <span class="n">side_two_old</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="p">),</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="p">)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">confirm_valve_changes</span><span class="p">(</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="n">side_one</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="n">side_two</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="n">side_one_old</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="n">side_two_old</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>    <span class="p">):</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        Callback function executed when changes are confirmed in the ValveChanges window.</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">        Instructs `self.arduino_data` to first save the `side_one_old` and `side_two_old`</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">        arrays to an archive slot, and then save the newly calculated `side_one` and `side_two`</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">        arrays as the &#39;selected&#39; durations.</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">        Parameters</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">        ----------</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">        - **side_one** (*npt.NDArray[np.int32]*): The numpy array containing the newly calculated durations for side one valves.</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">        - **side_two** (*npt.NDArray[np.int32]*): The numpy array containing the newly calculated durations for side two valves.</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">        - **side_one_old** (*npt.NDArray[np.int32]*): The numpy array containing the durations for side one valves *before* the test.</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        - **side_two_old** (*npt.NDArray[np.int32]*): The numpy array containing the durations for side two valves *before* the test.</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">save_durations</span><span class="p">(</span><span class="n">side_one_old</span><span class="p">,</span> <span class="n">side_two_old</span><span class="p">,</span> <span class="s2">&quot;archive&quot;</span><span class="p">)</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">save_durations</span><span class="p">(</span><span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="s2">&quot;selected&quot;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="logger">
                    <div class="attr variable">
            <span class="name">logger</span>        =
<span class="default_value">&lt;RootLogger root (INFO)&gt;</span>

        
    </div>
    <a class="headerlink" href="#logger"></a>
    
            <div class="docstring"><p>Get the logger in use for the app.</p>
</div>


                </section>
                <section id="rig_config">
                    <div class="attr variable">
            <span class="name">rig_config</span>        =
<span class="default_value">&#39;/home/blake/Documents/Photologic-Experiment-Rig-Files/assets/rig_config.toml&#39;</span>

        
    </div>
    <a class="headerlink" href="#rig_config"></a>
    
    

                </section>
                <section id="TOTAL_VALVES">
                    <div class="attr variable">
            <span class="name">TOTAL_VALVES</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#TOTAL_VALVES"></a>
    
    

                </section>
                <section id="VALVES_PER_SIDE">
                    <div class="attr variable">
            <span class="name">VALVES_PER_SIDE</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#VALVES_PER_SIDE"></a>
    
    

                </section>
                <section id="WindowMode">
                            <input id="WindowMode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WindowMode</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="WindowMode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WindowMode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WindowMode-60"><a href="#WindowMode-60"><span class="linenos">60</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WindowMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="WindowMode-61"><a href="#WindowMode-61"><span class="linenos">61</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WindowMode-62"><a href="#WindowMode-62"><span class="linenos">62</span></a><span class="sd">    Represents the two primary operational modes of the ValveTestWindow:</span>
</span><span id="WindowMode-63"><a href="#WindowMode-63"><span class="linenos">63</span></a><span class="sd">    Testing mode for calibrating valve durations, and Priming mode for</span>
</span><span id="WindowMode-64"><a href="#WindowMode-64"><span class="linenos">64</span></a><span class="sd">    actuating valves repeatedly without calibration.</span>
</span><span id="WindowMode-65"><a href="#WindowMode-65"><span class="linenos">65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="WindowMode-66"><a href="#WindowMode-66"><span class="linenos">66</span></a>
</span><span id="WindowMode-67"><a href="#WindowMode-67"><span class="linenos">67</span></a>    <span class="n">TESTING</span> <span class="o">=</span> <span class="s2">&quot;Testing&quot;</span>
</span><span id="WindowMode-68"><a href="#WindowMode-68"><span class="linenos">68</span></a>    <span class="n">PRIMING</span> <span class="o">=</span> <span class="s2">&quot;Priming&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Represents the two primary operational modes of the ValveTestWindow:
Testing mode for calibrating valve durations, and Priming mode for
actuating valves repeatedly without calibration.</p>
</div>


                            <div id="WindowMode.TESTING" class="classattr">
                                <div class="attr variable">
            <span class="name">TESTING</span>        =
<span class="default_value">&lt;<a href="#WindowMode.TESTING">WindowMode.TESTING</a>: &#39;Testing&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#WindowMode.TESTING"></a>
    
    

                            </div>
                            <div id="WindowMode.PRIMING" class="classattr">
                                <div class="attr variable">
            <span class="name">PRIMING</span>        =
<span class="default_value">&lt;<a href="#WindowMode.PRIMING">WindowMode.PRIMING</a>: &#39;Priming&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#WindowMode.PRIMING"></a>
    
    

                            </div>
                </section>
                <section id="ValveTestWindow">
                            <input id="ValveTestWindow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ValveTestWindow</span><wbr>(<span class="base">tkinter.Toplevel</span>):

                <label class="view-source-button" for="ValveTestWindow-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow-71"><a href="#ValveTestWindow-71"><span class="linenos">  71</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ValveTestWindow</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">):</span>
</span><span id="ValveTestWindow-72"><a href="#ValveTestWindow-72"><span class="linenos">  72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-73"><a href="#ValveTestWindow-73"><span class="linenos">  73</span></a><span class="sd">    *This is a bit of a god class and should likely be refactored... but for now... it works!*</span>
</span><span id="ValveTestWindow-74"><a href="#ValveTestWindow-74"><span class="linenos">  74</span></a>
</span><span id="ValveTestWindow-75"><a href="#ValveTestWindow-75"><span class="linenos">  75</span></a><span class="sd">    Implements the main Tkinter Toplevel window for valve testing and priming operations.</span>
</span><span id="ValveTestWindow-76"><a href="#ValveTestWindow-76"><span class="linenos">  76</span></a>
</span><span id="ValveTestWindow-77"><a href="#ValveTestWindow-77"><span class="linenos">  77</span></a><span class="sd">    This window provides an interface to interact with the Arduino</span>
</span><span id="ValveTestWindow-78"><a href="#ValveTestWindow-78"><span class="linenos">  78</span></a><span class="sd">    controller for calibrating valve open times based on dispensed volume or</span>
</span><span id="ValveTestWindow-79"><a href="#ValveTestWindow-79"><span class="linenos">  79</span></a><span class="sd">    for running priming sequences. It features modes for testing and</span>
</span><span id="ValveTestWindow-80"><a href="#ValveTestWindow-80"><span class="linenos">  80</span></a><span class="sd">    priming, manages valve selections, displays test progress and results,</span>
</span><span id="ValveTestWindow-81"><a href="#ValveTestWindow-81"><span class="linenos">  81</span></a><span class="sd">    and handles communication with the Arduino.</span>
</span><span id="ValveTestWindow-82"><a href="#ValveTestWindow-82"><span class="linenos">  82</span></a>
</span><span id="ValveTestWindow-83"><a href="#ValveTestWindow-83"><span class="linenos">  83</span></a><span class="sd">    Attributes</span>
</span><span id="ValveTestWindow-84"><a href="#ValveTestWindow-84"><span class="linenos">  84</span></a><span class="sd">    ----------</span>
</span><span id="ValveTestWindow-85"><a href="#ValveTestWindow-85"><span class="linenos">  85</span></a><span class="sd">    - **`arduino_controller`** (*ArduinoManager*): Reference to the main Arduino controller instance, used for sending commands and data.</span>
</span><span id="ValveTestWindow-86"><a href="#ValveTestWindow-86"><span class="linenos">  86</span></a><span class="sd">    - **`arduino_data`** (*ArduinoData*): Reference to the data model holding valve duration configurations.</span>
</span><span id="ValveTestWindow-87"><a href="#ValveTestWindow-87"><span class="linenos">  87</span></a><span class="sd">    - **`window_mode`** (*WindowMode*): Enum indicating the current operational mode (Testing or Priming).</span>
</span><span id="ValveTestWindow-88"><a href="#ValveTestWindow-88"><span class="linenos">  88</span></a><span class="sd">    - **`test_running`** (*bool*): Flag indicating if an automated test sequence is currently active.</span>
</span><span id="ValveTestWindow-89"><a href="#ValveTestWindow-89"><span class="linenos">  89</span></a><span class="sd">    - **`prime_running`** (*bool*): Flag indicating if a priming sequence is currently active.</span>
</span><span id="ValveTestWindow-90"><a href="#ValveTestWindow-90"><span class="linenos">  90</span></a><span class="sd">    - **`desired_volume`** (*tk.DoubleVar*): Tkinter variable storing the target volume (in microliters) per actuation for automatic duration calculation.</span>
</span><span id="ValveTestWindow-91"><a href="#ValveTestWindow-91"><span class="linenos">  91</span></a><span class="sd">    - **`actuations`** (*tk.IntVar*): Tkinter variable storing the number of times each valve should be actuated during a test or prime sequence.</span>
</span><span id="ValveTestWindow-92"><a href="#ValveTestWindow-92"><span class="linenos">  92</span></a><span class="sd">    - **`ml_dispensed`** (*list[tuple[int, float]]*): Stores tuples of (valve_number, dispensed_volume_ml) entered by the user during a test.</span>
</span><span id="ValveTestWindow-93"><a href="#ValveTestWindow-93"><span class="linenos">  93</span></a><span class="sd">    - **`valve_buttons`** (*list[tk.Button | None]*): List holding the Tkinter Button widgets for each valve selection.</span>
</span><span id="ValveTestWindow-94"><a href="#ValveTestWindow-94"><span class="linenos">  94</span></a><span class="sd">    - **`valve_test_button`** (*tk.Button | None*): The main button used to start/abort tests or start/stop priming.</span>
</span><span id="ValveTestWindow-95"><a href="#ValveTestWindow-95"><span class="linenos">  95</span></a><span class="sd">    - **`table_entries`** (*list[str | None]*): List holding the item IDs for each row in the ttk.Treeview table, used for modifying/hiding/showing specific rows.</span>
</span><span id="ValveTestWindow-96"><a href="#ValveTestWindow-96"><span class="linenos">  96</span></a><span class="sd">    - **`valve_selections`** (*npt.NDArray[np.int8]*): Numpy array representing the selection state of each valve (0 if not selected, valve_number if selected).</span>
</span><span id="ValveTestWindow-97"><a href="#ValveTestWindow-97"><span class="linenos">  97</span></a><span class="sd">    - **`side_one_tests`** (*npt.NDArray[np.int8] | None*): Numpy array holding the valve numbers (0-indexed) selected for testing/priming on side one.</span>
</span><span id="ValveTestWindow-98"><a href="#ValveTestWindow-98"><span class="linenos">  98</span></a><span class="sd">    - **`side_two_tests`** (*npt.NDArray[np.int8] | None*): Numpy array holding the valve numbers (0-indexed) selected for testing/priming on side two.</span>
</span><span id="ValveTestWindow-99"><a href="#ValveTestWindow-99"><span class="linenos">  99</span></a><span class="sd">    - **`stop_event`** (*threading.Event*): Event flag used to signal the Arduino listener thread (`run_test`) to stop.</span>
</span><span id="ValveTestWindow-100"><a href="#ValveTestWindow-100"><span class="linenos"> 100</span></a><span class="sd">    - **`mode_button`** (*tk.Button*): Button to switch between Testing and Priming modes.</span>
</span><span id="ValveTestWindow-101"><a href="#ValveTestWindow-101"><span class="linenos"> 101</span></a><span class="sd">    - **`dispensed_vol_frame`** (*tk.Frame*): Container frame for the desired volume input elements (visible in Testing mode).</span>
</span><span id="ValveTestWindow-102"><a href="#ValveTestWindow-102"><span class="linenos"> 102</span></a><span class="sd">    - **`valve_table_frame`** (*tk.Frame*): Container frame for the valve test results table (visible in Testing mode).</span>
</span><span id="ValveTestWindow-103"><a href="#ValveTestWindow-103"><span class="linenos"> 103</span></a><span class="sd">    - **`valve_table`** (*ttk.Treeview*): The table widget displaying valve numbers, test status, and timings.</span>
</span><span id="ValveTestWindow-104"><a href="#ValveTestWindow-104"><span class="linenos"> 104</span></a><span class="sd">    - **`valve_buttons_frame`** (*tk.Frame*): Main container frame for the side-by-side valve selection buttons.</span>
</span><span id="ValveTestWindow-105"><a href="#ValveTestWindow-105"><span class="linenos"> 105</span></a><span class="sd">    - **`side_one_valves_frame`** (*tk.Frame*): Frame holding valve selection buttons for the first side.</span>
</span><span id="ValveTestWindow-106"><a href="#ValveTestWindow-106"><span class="linenos"> 106</span></a><span class="sd">    - **`side_two_valves_frame`** (*tk.Frame*): Frame holding valve selection buttons for the second side.</span>
</span><span id="ValveTestWindow-107"><a href="#ValveTestWindow-107"><span class="linenos"> 107</span></a><span class="sd">    - **`manual_adjust_window`** (*ManualTimeAdjustment*): Instance of the separate window for manual timing adjustments.</span>
</span><span id="ValveTestWindow-108"><a href="#ValveTestWindow-108"><span class="linenos"> 108</span></a>
</span><span id="ValveTestWindow-109"><a href="#ValveTestWindow-109"><span class="linenos"> 109</span></a><span class="sd">    Methods</span>
</span><span id="ValveTestWindow-110"><a href="#ValveTestWindow-110"><span class="linenos"> 110</span></a><span class="sd">    -------</span>
</span><span id="ValveTestWindow-111"><a href="#ValveTestWindow-111"><span class="linenos"> 111</span></a><span class="sd">    - `setup_basic_window_attr`()</span>
</span><span id="ValveTestWindow-112"><a href="#ValveTestWindow-112"><span class="linenos"> 112</span></a><span class="sd">        Configures basic window properties like title, key bindings, and icon.</span>
</span><span id="ValveTestWindow-113"><a href="#ValveTestWindow-113"><span class="linenos"> 113</span></a><span class="sd">    - `show`()</span>
</span><span id="ValveTestWindow-114"><a href="#ValveTestWindow-114"><span class="linenos"> 114</span></a><span class="sd">        Makes the window visible (deiconifies).</span>
</span><span id="ValveTestWindow-115"><a href="#ValveTestWindow-115"><span class="linenos"> 115</span></a><span class="sd">    - `switch_window_mode`()</span>
</span><span id="ValveTestWindow-116"><a href="#ValveTestWindow-116"><span class="linenos"> 116</span></a><span class="sd">        Toggles the window between Testing and Priming modes, adjusting UI elements accordingly.</span>
</span><span id="ValveTestWindow-117"><a href="#ValveTestWindow-117"><span class="linenos"> 117</span></a><span class="sd">    - `create_interface`()</span>
</span><span id="ValveTestWindow-118"><a href="#ValveTestWindow-118"><span class="linenos"> 118</span></a><span class="sd">        Builds the entire GUI layout, placing widgets and frames.</span>
</span><span id="ValveTestWindow-119"><a href="#ValveTestWindow-119"><span class="linenos"> 119</span></a><span class="sd">    - `start_testing_toggle`()</span>
</span><span id="ValveTestWindow-120"><a href="#ValveTestWindow-120"><span class="linenos"> 120</span></a><span class="sd">        Handles the press of the main test/prime button in Testing mode (starts or aborts test).</span>
</span><span id="ValveTestWindow-121"><a href="#ValveTestWindow-121"><span class="linenos"> 121</span></a><span class="sd">    - `create_buttons`()</span>
</span><span id="ValveTestWindow-122"><a href="#ValveTestWindow-122"><span class="linenos"> 122</span></a><span class="sd">        Creates and places the valve selection buttons and the main start/abort button.</span>
</span><span id="ValveTestWindow-123"><a href="#ValveTestWindow-123"><span class="linenos"> 123</span></a><span class="sd">    - `create_valve_test_table`()</span>
</span><span id="ValveTestWindow-124"><a href="#ValveTestWindow-124"><span class="linenos"> 124</span></a><span class="sd">        Creates the ttk.Treeview table for displaying valve test results and timings.</span>
</span><span id="ValveTestWindow-125"><a href="#ValveTestWindow-125"><span class="linenos"> 125</span></a><span class="sd">    - `update_table_entry_test_status`(...)</span>
</span><span id="ValveTestWindow-126"><a href="#ValveTestWindow-126"><span class="linenos"> 126</span></a><span class="sd">        Updates the &#39;Amount Dispensed&#39; column for a specific valve in the table.</span>
</span><span id="ValveTestWindow-127"><a href="#ValveTestWindow-127"><span class="linenos"> 127</span></a><span class="sd">    - `update_table_entries`(...)</span>
</span><span id="ValveTestWindow-128"><a href="#ValveTestWindow-128"><span class="linenos"> 128</span></a><span class="sd">        Updates the entire valve table, showing/hiding rows based on selections and refreshing currently loaded durations.</span>
</span><span id="ValveTestWindow-129"><a href="#ValveTestWindow-129"><span class="linenos"> 129</span></a><span class="sd">    - `toggle_valve_button`(...)</span>
</span><span id="ValveTestWindow-130"><a href="#ValveTestWindow-130"><span class="linenos"> 130</span></a><span class="sd">        Handles clicks on valve selection buttons, updating their appearance and the `valve_selections` array.</span>
</span><span id="ValveTestWindow-131"><a href="#ValveTestWindow-131"><span class="linenos"> 131</span></a><span class="sd">    - `verify_variables`(...)</span>
</span><span id="ValveTestWindow-132"><a href="#ValveTestWindow-132"><span class="linenos"> 132</span></a><span class="sd">        Reads verification data back from Arduino to confirm test parameters were received correctly.</span>
</span><span id="ValveTestWindow-133"><a href="#ValveTestWindow-133"><span class="linenos"> 133</span></a><span class="sd">    - `verify_schedule`(...)</span>
</span><span id="ValveTestWindow-134"><a href="#ValveTestWindow-134"><span class="linenos"> 134</span></a><span class="sd">        Reads verification data back from Arduino to confirm the valve test/prime schedule was received correctly.</span>
</span><span id="ValveTestWindow-135"><a href="#ValveTestWindow-135"><span class="linenos"> 135</span></a><span class="sd">    - `send_schedules`()</span>
</span><span id="ValveTestWindow-136"><a href="#ValveTestWindow-136"><span class="linenos"> 136</span></a><span class="sd">        Sends the command, parameters (schedule lengths, actuations), and valve schedule to the Arduino. Handles mode-specific commands and confirmations.</span>
</span><span id="ValveTestWindow-137"><a href="#ValveTestWindow-137"><span class="linenos"> 137</span></a><span class="sd">    - `stop_priming`()</span>
</span><span id="ValveTestWindow-138"><a href="#ValveTestWindow-138"><span class="linenos"> 138</span></a><span class="sd">        Sends a command to the Arduino to stop an ongoing priming sequence.</span>
</span><span id="ValveTestWindow-139"><a href="#ValveTestWindow-139"><span class="linenos"> 139</span></a><span class="sd">    - `take_input`(...)</span>
</span><span id="ValveTestWindow-140"><a href="#ValveTestWindow-140"><span class="linenos"> 140</span></a><span class="sd">        Prompts the user (via simpledialog) to enter the dispensed volume for a completed valve test pair. Sends confirmation back to Arduino.</span>
</span><span id="ValveTestWindow-141"><a href="#ValveTestWindow-141"><span class="linenos"> 141</span></a><span class="sd">    - `run_test`()</span>
</span><span id="ValveTestWindow-142"><a href="#ValveTestWindow-142"><span class="linenos"> 142</span></a><span class="sd">        Runs in a separate thread to listen for messages from the Arduino during a test, triggering events for input prompts or completion.</span>
</span><span id="ValveTestWindow-143"><a href="#ValveTestWindow-143"><span class="linenos"> 143</span></a><span class="sd">    - `abort_test`()</span>
</span><span id="ValveTestWindow-144"><a href="#ValveTestWindow-144"><span class="linenos"> 144</span></a><span class="sd">        Sends a command to the Arduino to abort the current test and stops the listener thread.</span>
</span><span id="ValveTestWindow-145"><a href="#ValveTestWindow-145"><span class="linenos"> 145</span></a><span class="sd">    - `testing_complete`(...)</span>
</span><span id="ValveTestWindow-146"><a href="#ValveTestWindow-146"><span class="linenos"> 146</span></a><span class="sd">        Handles the event triggered when the Arduino signals the end of the entire test sequence. Initiates duration updates.</span>
</span><span id="ValveTestWindow-147"><a href="#ValveTestWindow-147"><span class="linenos"> 147</span></a><span class="sd">    - `auto_update_durations`()</span>
</span><span id="ValveTestWindow-148"><a href="#ValveTestWindow-148"><span class="linenos"> 148</span></a><span class="sd">        Calculates new valve durations based on test results (`ml_dispensed`) and opens the `ValveChanges` confirmation window.</span>
</span><span id="ValveTestWindow-149"><a href="#ValveTestWindow-149"><span class="linenos"> 149</span></a><span class="sd">    - `confirm_valve_changes`(...)</span>
</span><span id="ValveTestWindow-150"><a href="#ValveTestWindow-150"><span class="linenos"> 150</span></a><span class="sd">        Callback function executed if the user confirms changes in the `ValveChanges` window. Saves new durations and archives old ones via `ArduinoData`.</span>
</span><span id="ValveTestWindow-151"><a href="#ValveTestWindow-151"><span class="linenos"> 151</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-152"><a href="#ValveTestWindow-152"><span class="linenos"> 152</span></a>
</span><span id="ValveTestWindow-153"><a href="#ValveTestWindow-153"><span class="linenos"> 153</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arduino_controller</span><span class="p">:</span> <span class="n">ArduinoManager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-154"><a href="#ValveTestWindow-154"><span class="linenos"> 154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-155"><a href="#ValveTestWindow-155"><span class="linenos"> 155</span></a><span class="sd">        Initializes the ValveTestWindow.</span>
</span><span id="ValveTestWindow-156"><a href="#ValveTestWindow-156"><span class="linenos"> 156</span></a>
</span><span id="ValveTestWindow-157"><a href="#ValveTestWindow-157"><span class="linenos"> 157</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-158"><a href="#ValveTestWindow-158"><span class="linenos"> 158</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-159"><a href="#ValveTestWindow-159"><span class="linenos"> 159</span></a><span class="sd">        - **arduino_controller** (*ArduinoManager*): The application&#39;s instance of the Arduino controller.</span>
</span><span id="ValveTestWindow-160"><a href="#ValveTestWindow-160"><span class="linenos"> 160</span></a>
</span><span id="ValveTestWindow-161"><a href="#ValveTestWindow-161"><span class="linenos"> 161</span></a><span class="sd">        Raises</span>
</span><span id="ValveTestWindow-162"><a href="#ValveTestWindow-162"><span class="linenos"> 162</span></a><span class="sd">        ------</span>
</span><span id="ValveTestWindow-163"><a href="#ValveTestWindow-163"><span class="linenos"> 163</span></a><span class="sd">        - Propagates exceptions from `GUIUtils` methods during icon setting.</span>
</span><span id="ValveTestWindow-164"><a href="#ValveTestWindow-164"><span class="linenos"> 164</span></a><span class="sd">        - Propagates exceptions from `arduino_data.load_durations()`.</span>
</span><span id="ValveTestWindow-165"><a href="#ValveTestWindow-165"><span class="linenos"> 165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-166"><a href="#ValveTestWindow-166"><span class="linenos"> 166</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="ValveTestWindow-167"><a href="#ValveTestWindow-167"><span class="linenos"> 167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="p">:</span> <span class="n">ArduinoManager</span> <span class="o">=</span> <span class="n">arduino_controller</span>
</span><span id="ValveTestWindow-168"><a href="#ValveTestWindow-168"><span class="linenos"> 168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="p">:</span> <span class="n">ArduinoData</span> <span class="o">=</span> <span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="ValveTestWindow-169"><a href="#ValveTestWindow-169"><span class="linenos"> 169</span></a>
</span><span id="ValveTestWindow-170"><a href="#ValveTestWindow-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">setup_basic_window_attr</span><span class="p">()</span>
</span><span id="ValveTestWindow-171"><a href="#ValveTestWindow-171"><span class="linenos"> 171</span></a>
</span><span id="ValveTestWindow-172"><a href="#ValveTestWindow-172"><span class="linenos"> 172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span><span class="p">:</span> <span class="n">WindowMode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span>
</span><span id="ValveTestWindow-173"><a href="#ValveTestWindow-173"><span class="linenos"> 173</span></a>
</span><span id="ValveTestWindow-174"><a href="#ValveTestWindow-174"><span class="linenos"> 174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-175"><a href="#ValveTestWindow-175"><span class="linenos"> 175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-176"><a href="#ValveTestWindow-176"><span class="linenos"> 176</span></a>
</span><span id="ValveTestWindow-177"><a href="#ValveTestWindow-177"><span class="linenos"> 177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="ValveTestWindow-178"><a href="#ValveTestWindow-178"><span class="linenos"> 178</span></a>
</span><span id="ValveTestWindow-179"><a href="#ValveTestWindow-179"><span class="linenos"> 179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ValveTestWindow-180"><a href="#ValveTestWindow-180"><span class="linenos"> 180</span></a>
</span><span id="ValveTestWindow-181"><a href="#ValveTestWindow-181"><span class="linenos"> 181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ValveTestWindow-182"><a href="#ValveTestWindow-182"><span class="linenos"> 182</span></a>
</span><span id="ValveTestWindow-183"><a href="#ValveTestWindow-183"><span class="linenos"> 183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">Button</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">TOTAL_VALVES</span>
</span><span id="ValveTestWindow-184"><a href="#ValveTestWindow-184"><span class="linenos"> 184</span></a>
</span><span id="ValveTestWindow-185"><a href="#ValveTestWindow-185"><span class="linenos"> 185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow-186"><a href="#ValveTestWindow-186"><span class="linenos"> 186</span></a>
</span><span id="ValveTestWindow-187"><a href="#ValveTestWindow-187"><span class="linenos"> 187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">TOTAL_VALVES</span>
</span><span id="ValveTestWindow-188"><a href="#ValveTestWindow-188"><span class="linenos"> 188</span></a>
</span><span id="ValveTestWindow-189"><a href="#ValveTestWindow-189"><span class="linenos"> 189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="ValveTestWindow-190"><a href="#ValveTestWindow-190"><span class="linenos"> 190</span></a>            <span class="p">(</span><span class="n">TOTAL_VALVES</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span>
</span><span id="ValveTestWindow-191"><a href="#ValveTestWindow-191"><span class="linenos"> 191</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-192"><a href="#ValveTestWindow-192"><span class="linenos"> 192</span></a>
</span><span id="ValveTestWindow-193"><a href="#ValveTestWindow-193"><span class="linenos"> 193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow-194"><a href="#ValveTestWindow-194"><span class="linenos"> 194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow-195"><a href="#ValveTestWindow-195"><span class="linenos"> 195</span></a>
</span><span id="ValveTestWindow-196"><a href="#ValveTestWindow-196"><span class="linenos"> 196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="ValveTestWindow-197"><a href="#ValveTestWindow-197"><span class="linenos"> 197</span></a>
</span><span id="ValveTestWindow-198"><a href="#ValveTestWindow-198"><span class="linenos"> 198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_interface</span><span class="p">()</span>
</span><span id="ValveTestWindow-199"><a href="#ValveTestWindow-199"><span class="linenos"> 199</span></a>
</span><span id="ValveTestWindow-200"><a href="#ValveTestWindow-200"><span class="linenos"> 200</span></a>        <span class="c1"># hide main window for now until we deliberately enter this window.</span>
</span><span id="ValveTestWindow-201"><a href="#ValveTestWindow-201"><span class="linenos"> 201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
</span><span id="ValveTestWindow-202"><a href="#ValveTestWindow-202"><span class="linenos"> 202</span></a>
</span><span id="ValveTestWindow-203"><a href="#ValveTestWindow-203"><span class="linenos"> 203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span> <span class="o">=</span> <span class="n">ManualTimeAdjustment</span><span class="p">(</span>
</span><span id="ValveTestWindow-204"><a href="#ValveTestWindow-204"><span class="linenos"> 204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="ValveTestWindow-205"><a href="#ValveTestWindow-205"><span class="linenos"> 205</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-206"><a href="#ValveTestWindow-206"><span class="linenos"> 206</span></a>        <span class="c1"># hide the adjustment window until we need it.</span>
</span><span id="ValveTestWindow-207"><a href="#ValveTestWindow-207"><span class="linenos"> 207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
</span><span id="ValveTestWindow-208"><a href="#ValveTestWindow-208"><span class="linenos"> 208</span></a>
</span><span id="ValveTestWindow-209"><a href="#ValveTestWindow-209"><span class="linenos"> 209</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Valve Test Window initialized.&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-210"><a href="#ValveTestWindow-210"><span class="linenos"> 210</span></a>
</span><span id="ValveTestWindow-211"><a href="#ValveTestWindow-211"><span class="linenos"> 211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_basic_window_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-212"><a href="#ValveTestWindow-212"><span class="linenos"> 212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-213"><a href="#ValveTestWindow-213"><span class="linenos"> 213</span></a><span class="sd">        Sets up fundamental window properties.</span>
</span><span id="ValveTestWindow-214"><a href="#ValveTestWindow-214"><span class="linenos"> 214</span></a>
</span><span id="ValveTestWindow-215"><a href="#ValveTestWindow-215"><span class="linenos"> 215</span></a><span class="sd">        Configures the window title, binds Ctrl+W and the close button (&#39;X&#39;)</span>
</span><span id="ValveTestWindow-216"><a href="#ValveTestWindow-216"><span class="linenos"> 216</span></a><span class="sd">        to hide the window, sets grid column/row weights for resizing behavior,</span>
</span><span id="ValveTestWindow-217"><a href="#ValveTestWindow-217"><span class="linenos"> 217</span></a><span class="sd">        and applies the application icon using `GUIUtils`.</span>
</span><span id="ValveTestWindow-218"><a href="#ValveTestWindow-218"><span class="linenos"> 218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-219"><a href="#ValveTestWindow-219"><span class="linenos"> 219</span></a>
</span><span id="ValveTestWindow-220"><a href="#ValveTestWindow-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Testing&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-221"><a href="#ValveTestWindow-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Control-w&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">())</span>
</span><span id="ValveTestWindow-222"><a href="#ValveTestWindow-222"><span class="linenos"> 222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span><span class="s2">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">())</span>
</span><span id="ValveTestWindow-223"><a href="#ValveTestWindow-223"><span class="linenos"> 223</span></a>
</span><span id="ValveTestWindow-224"><a href="#ValveTestWindow-224"><span class="linenos"> 224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-225"><a href="#ValveTestWindow-225"><span class="linenos"> 225</span></a>
</span><span id="ValveTestWindow-226"><a href="#ValveTestWindow-226"><span class="linenos"> 226</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="ValveTestWindow-227"><a href="#ValveTestWindow-227"><span class="linenos"> 227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-228"><a href="#ValveTestWindow-228"><span class="linenos"> 228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ValveTestWindow-229"><a href="#ValveTestWindow-229"><span class="linenos"> 229</span></a>
</span><span id="ValveTestWindow-230"><a href="#ValveTestWindow-230"><span class="linenos"> 230</span></a>        <span class="n">window_icon_path</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">get_window_icon_path</span><span class="p">()</span>
</span><span id="ValveTestWindow-231"><a href="#ValveTestWindow-231"><span class="linenos"> 231</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">set_program_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon_path</span><span class="o">=</span><span class="n">window_icon_path</span><span class="p">)</span>
</span><span id="ValveTestWindow-232"><a href="#ValveTestWindow-232"><span class="linenos"> 232</span></a>
</span><span id="ValveTestWindow-233"><a href="#ValveTestWindow-233"><span class="linenos"> 233</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-234"><a href="#ValveTestWindow-234"><span class="linenos"> 234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-235"><a href="#ValveTestWindow-235"><span class="linenos"> 235</span></a><span class="sd">        Makes the ValveTestWindow visible.</span>
</span><span id="ValveTestWindow-236"><a href="#ValveTestWindow-236"><span class="linenos"> 236</span></a>
</span><span id="ValveTestWindow-237"><a href="#ValveTestWindow-237"><span class="linenos"> 237</span></a><span class="sd">        Calls `deiconify()` to show the window if it was previously hidden (withdrawn).</span>
</span><span id="ValveTestWindow-238"><a href="#ValveTestWindow-238"><span class="linenos"> 238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-239"><a href="#ValveTestWindow-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
</span><span id="ValveTestWindow-240"><a href="#ValveTestWindow-240"><span class="linenos"> 240</span></a>
</span><span id="ValveTestWindow-241"><a href="#ValveTestWindow-241"><span class="linenos"> 241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">switch_window_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-242"><a href="#ValveTestWindow-242"><span class="linenos"> 242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-243"><a href="#ValveTestWindow-243"><span class="linenos"> 243</span></a><span class="sd">        Toggles the window&#39;s operational mode between Testing and Priming.</span>
</span><span id="ValveTestWindow-244"><a href="#ValveTestWindow-244"><span class="linenos"> 244</span></a>
</span><span id="ValveTestWindow-245"><a href="#ValveTestWindow-245"><span class="linenos"> 245</span></a><span class="sd">        Updates the window title and mode button text/color. Hides or shows</span>
</span><span id="ValveTestWindow-246"><a href="#ValveTestWindow-246"><span class="linenos"> 246</span></a><span class="sd">        mode-specific UI elements (desired volume input, test results table).</span>
</span><span id="ValveTestWindow-247"><a href="#ValveTestWindow-247"><span class="linenos"> 247</span></a><span class="sd">        Changes the command associated with the main start/stop button.</span>
</span><span id="ValveTestWindow-248"><a href="#ValveTestWindow-248"><span class="linenos"> 248</span></a><span class="sd">        Prevents mode switching if a test or prime sequence is currently running to avoid Arduino</span>
</span><span id="ValveTestWindow-249"><a href="#ValveTestWindow-249"><span class="linenos"> 249</span></a><span class="sd">        Communications errors. Resizes and centers the window after GUI changes.</span>
</span><span id="ValveTestWindow-250"><a href="#ValveTestWindow-250"><span class="linenos"> 250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-251"><a href="#ValveTestWindow-251"><span class="linenos"> 251</span></a>
</span><span id="ValveTestWindow-252"><a href="#ValveTestWindow-252"><span class="linenos"> 252</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="ValveTestWindow-253"><a href="#ValveTestWindow-253"><span class="linenos"> 253</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="ValveTestWindow-254"><a href="#ValveTestWindow-254"><span class="linenos"> 254</span></a>                <span class="c1"># if the test is currently running we do not want to switch modes. Stop testing to switch modes</span>
</span><span id="ValveTestWindow-255"><a href="#ValveTestWindow-255"><span class="linenos"> 255</span></a>                <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span>
</span><span id="ValveTestWindow-256"><a href="#ValveTestWindow-256"><span class="linenos"> 256</span></a>                    <span class="s2">&quot;ACTION PROHIBITED&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-257"><a href="#ValveTestWindow-257"><span class="linenos"> 257</span></a>                    <span class="s2">&quot;You cannot switch modes while a test is running. If you&#39;d like to switch modes, please abort the test and try again.&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-258"><a href="#ValveTestWindow-258"><span class="linenos"> 258</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow-259"><a href="#ValveTestWindow-259"><span class="linenos"> 259</span></a>                <span class="k">return</span>
</span><span id="ValveTestWindow-260"><a href="#ValveTestWindow-260"><span class="linenos"> 260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Priming&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-261"><a href="#ValveTestWindow-261"><span class="linenos"> 261</span></a>
</span><span id="ValveTestWindow-262"><a href="#ValveTestWindow-262"><span class="linenos"> 262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span>
</span><span id="ValveTestWindow-263"><a href="#ValveTestWindow-263"><span class="linenos"> 263</span></a>
</span><span id="ValveTestWindow-264"><a href="#ValveTestWindow-264"><span class="linenos"> 264</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Switch to Testing Mode&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;DeepSkyBlue3&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-265"><a href="#ValveTestWindow-265"><span class="linenos"> 265</span></a>
</span><span id="ValveTestWindow-266"><a href="#ValveTestWindow-266"><span class="linenos"> 266</span></a>            <span class="c1"># orig. row 1</span>
</span><span id="ValveTestWindow-267"><a href="#ValveTestWindow-267"><span class="linenos"> 267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
</span><span id="ValveTestWindow-268"><a href="#ValveTestWindow-268"><span class="linenos"> 268</span></a>            <span class="c1"># orig. row 3</span>
</span><span id="ValveTestWindow-269"><a href="#ValveTestWindow-269"><span class="linenos"> 269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
</span><span id="ValveTestWindow-270"><a href="#ValveTestWindow-270"><span class="linenos"> 270</span></a>
</span><span id="ValveTestWindow-271"><a href="#ValveTestWindow-271"><span class="linenos"> 271</span></a>            <span class="c1"># start testing button -&gt; start priming button / command</span>
</span><span id="ValveTestWindow-272"><a href="#ValveTestWindow-272"><span class="linenos"> 272</span></a>
</span><span id="ValveTestWindow-273"><a href="#ValveTestWindow-273"><span class="linenos"> 273</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-274"><a href="#ValveTestWindow-274"><span class="linenos"> 274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow-275"><a href="#ValveTestWindow-275"><span class="linenos"> 275</span></a>                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Priming&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-276"><a href="#ValveTestWindow-276"><span class="linenos"> 276</span></a>                    <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-277"><a href="#ValveTestWindow-277"><span class="linenos"> 277</span></a>                    <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">(),</span>
</span><span id="ValveTestWindow-278"><a href="#ValveTestWindow-278"><span class="linenos"> 278</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow-279"><a href="#ValveTestWindow-279"><span class="linenos"> 279</span></a>
</span><span id="ValveTestWindow-280"><a href="#ValveTestWindow-280"><span class="linenos"> 280</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-281"><a href="#ValveTestWindow-281"><span class="linenos"> 281</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span><span class="p">:</span>
</span><span id="ValveTestWindow-282"><a href="#ValveTestWindow-282"><span class="linenos"> 282</span></a>                <span class="c1"># if the test is currently running we do not want to switch modes. Stop testing to switch modes</span>
</span><span id="ValveTestWindow-283"><a href="#ValveTestWindow-283"><span class="linenos"> 283</span></a>                <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span>
</span><span id="ValveTestWindow-284"><a href="#ValveTestWindow-284"><span class="linenos"> 284</span></a>                    <span class="s2">&quot;ACTION PROHIBITED&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-285"><a href="#ValveTestWindow-285"><span class="linenos"> 285</span></a>                    <span class="s2">&quot;You cannot switch modes while a valve prime operation is running. If you&#39;d like to switch modes, please abort the prime and try again.&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-286"><a href="#ValveTestWindow-286"><span class="linenos"> 286</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow-287"><a href="#ValveTestWindow-287"><span class="linenos"> 287</span></a>                <span class="k">return</span>
</span><span id="ValveTestWindow-288"><a href="#ValveTestWindow-288"><span class="linenos"> 288</span></a>
</span><span id="ValveTestWindow-289"><a href="#ValveTestWindow-289"><span class="linenos"> 289</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Testing&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-290"><a href="#ValveTestWindow-290"><span class="linenos"> 290</span></a>
</span><span id="ValveTestWindow-291"><a href="#ValveTestWindow-291"><span class="linenos"> 291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span>
</span><span id="ValveTestWindow-292"><a href="#ValveTestWindow-292"><span class="linenos"> 292</span></a>
</span><span id="ValveTestWindow-293"><a href="#ValveTestWindow-293"><span class="linenos"> 293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Switch to Priming Mode&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-294"><a href="#ValveTestWindow-294"><span class="linenos"> 294</span></a>
</span><span id="ValveTestWindow-295"><a href="#ValveTestWindow-295"><span class="linenos"> 295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span>
</span><span id="ValveTestWindow-296"><a href="#ValveTestWindow-296"><span class="linenos"> 296</span></a>                <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span>
</span><span id="ValveTestWindow-297"><a href="#ValveTestWindow-297"><span class="linenos"> 297</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-298"><a href="#ValveTestWindow-298"><span class="linenos"> 298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-299"><a href="#ValveTestWindow-299"><span class="linenos"> 299</span></a>
</span><span id="ValveTestWindow-300"><a href="#ValveTestWindow-300"><span class="linenos"> 300</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-301"><a href="#ValveTestWindow-301"><span class="linenos"> 301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow-302"><a href="#ValveTestWindow-302"><span class="linenos"> 302</span></a>                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-303"><a href="#ValveTestWindow-303"><span class="linenos"> 303</span></a>                    <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-304"><a href="#ValveTestWindow-304"><span class="linenos"> 304</span></a>                    <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_testing_toggle</span><span class="p">(),</span>
</span><span id="ValveTestWindow-305"><a href="#ValveTestWindow-305"><span class="linenos"> 305</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow-306"><a href="#ValveTestWindow-306"><span class="linenos"> 306</span></a>
</span><span id="ValveTestWindow-307"><a href="#ValveTestWindow-307"><span class="linenos"> 307</span></a>        <span class="c1"># resize the window to fit current content</span>
</span><span id="ValveTestWindow-308"><a href="#ValveTestWindow-308"><span class="linenos"> 308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
</span><span id="ValveTestWindow-309"><a href="#ValveTestWindow-309"><span class="linenos"> 309</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">center_window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="ValveTestWindow-310"><a href="#ValveTestWindow-310"><span class="linenos"> 310</span></a>
</span><span id="ValveTestWindow-311"><a href="#ValveTestWindow-311"><span class="linenos"> 311</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-312"><a href="#ValveTestWindow-312"><span class="linenos"> 312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-313"><a href="#ValveTestWindow-313"><span class="linenos"> 313</span></a><span class="sd">        Constructs and arranges all GUI elements within the window.</span>
</span><span id="ValveTestWindow-314"><a href="#ValveTestWindow-314"><span class="linenos"> 314</span></a>
</span><span id="ValveTestWindow-315"><a href="#ValveTestWindow-315"><span class="linenos"> 315</span></a><span class="sd">        Creates frames for structure, input fields (desired volume, actuations),</span>
</span><span id="ValveTestWindow-316"><a href="#ValveTestWindow-316"><span class="linenos"> 316</span></a><span class="sd">        the mode switch button, the valve selection buttons, the test results table,</span>
</span><span id="ValveTestWindow-317"><a href="#ValveTestWindow-317"><span class="linenos"> 317</span></a><span class="sd">        and the main start/abort/prime button. Uses `GUIUtils` for</span>
</span><span id="ValveTestWindow-318"><a href="#ValveTestWindow-318"><span class="linenos"> 318</span></a><span class="sd">        widget creation where possible. Calls helper methods `create_valve_test_table`</span>
</span><span id="ValveTestWindow-319"><a href="#ValveTestWindow-319"><span class="linenos"> 319</span></a><span class="sd">        and `create_buttons`. Centers the window after creation.</span>
</span><span id="ValveTestWindow-320"><a href="#ValveTestWindow-320"><span class="linenos"> 320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-321"><a href="#ValveTestWindow-321"><span class="linenos"> 321</span></a>
</span><span id="ValveTestWindow-322"><a href="#ValveTestWindow-322"><span class="linenos"> 322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow-323"><a href="#ValveTestWindow-323"><span class="linenos"> 323</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="ValveTestWindow-324"><a href="#ValveTestWindow-324"><span class="linenos"> 324</span></a>            <span class="s2">&quot;Switch to Priming Mode&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-325"><a href="#ValveTestWindow-325"><span class="linenos"> 325</span></a>            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_window_mode</span><span class="p">(),</span>
</span><span id="ValveTestWindow-326"><a href="#ValveTestWindow-326"><span class="linenos"> 326</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-327"><a href="#ValveTestWindow-327"><span class="linenos"> 327</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow-328"><a href="#ValveTestWindow-328"><span class="linenos"> 328</span></a>            <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow-329"><a href="#ValveTestWindow-329"><span class="linenos"> 329</span></a>        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ValveTestWindow-330"><a href="#ValveTestWindow-330"><span class="linenos"> 330</span></a>
</span><span id="ValveTestWindow-331"><a href="#ValveTestWindow-331"><span class="linenos"> 331</span></a>        <span class="c1"># create a new frame to contain the desired dispensed volume label and frame</span>
</span><span id="ValveTestWindow-332"><a href="#ValveTestWindow-332"><span class="linenos"> 332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="ValveTestWindow-333"><a href="#ValveTestWindow-333"><span class="linenos"> 333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-334"><a href="#ValveTestWindow-334"><span class="linenos"> 334</span></a>
</span><span id="ValveTestWindow-335"><a href="#ValveTestWindow-335"><span class="linenos"> 335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-336"><a href="#ValveTestWindow-336"><span class="linenos"> 336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-337"><a href="#ValveTestWindow-337"><span class="linenos"> 337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-338"><a href="#ValveTestWindow-338"><span class="linenos"> 338</span></a>
</span><span id="ValveTestWindow-339"><a href="#ValveTestWindow-339"><span class="linenos"> 339</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="ValveTestWindow-340"><a href="#ValveTestWindow-340"><span class="linenos"> 340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow-341"><a href="#ValveTestWindow-341"><span class="linenos"> 341</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Desired Dispensed Volume in Microliters (ul)&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-342"><a href="#ValveTestWindow-342"><span class="linenos"> 342</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-343"><a href="#ValveTestWindow-343"><span class="linenos"> 343</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span><span id="ValveTestWindow-344"><a href="#ValveTestWindow-344"><span class="linenos"> 344</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow-345"><a href="#ValveTestWindow-345"><span class="linenos"> 345</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;dark blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-346"><a href="#ValveTestWindow-346"><span class="linenos"> 346</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ValveTestWindow-347"><a href="#ValveTestWindow-347"><span class="linenos"> 347</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="ValveTestWindow-348"><a href="#ValveTestWindow-348"><span class="linenos"> 348</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-349"><a href="#ValveTestWindow-349"><span class="linenos"> 349</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="ValveTestWindow-350"><a href="#ValveTestWindow-350"><span class="linenos"> 350</span></a>
</span><span id="ValveTestWindow-351"><a href="#ValveTestWindow-351"><span class="linenos"> 351</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span>
</span><span id="ValveTestWindow-352"><a href="#ValveTestWindow-352"><span class="linenos"> 352</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow-353"><a href="#ValveTestWindow-353"><span class="linenos"> 353</span></a>            <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="p">,</span>
</span><span id="ValveTestWindow-354"><a href="#ValveTestWindow-354"><span class="linenos"> 354</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
</span><span id="ValveTestWindow-355"><a href="#ValveTestWindow-355"><span class="linenos"> 355</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow-356"><a href="#ValveTestWindow-356"><span class="linenos"> 356</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-357"><a href="#ValveTestWindow-357"><span class="linenos"> 357</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-358"><a href="#ValveTestWindow-358"><span class="linenos"> 358</span></a>        <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="ValveTestWindow-359"><a href="#ValveTestWindow-359"><span class="linenos"> 359</span></a>
</span><span id="ValveTestWindow-360"><a href="#ValveTestWindow-360"><span class="linenos"> 360</span></a>        <span class="c1"># create another new frame to contain the amount of times each</span>
</span><span id="ValveTestWindow-361"><a href="#ValveTestWindow-361"><span class="linenos"> 361</span></a>        <span class="c1"># valve should actuate label and frame</span>
</span><span id="ValveTestWindow-362"><a href="#ValveTestWindow-362"><span class="linenos"> 362</span></a>        <span class="n">frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="ValveTestWindow-363"><a href="#ValveTestWindow-363"><span class="linenos"> 363</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-364"><a href="#ValveTestWindow-364"><span class="linenos"> 364</span></a>
</span><span id="ValveTestWindow-365"><a href="#ValveTestWindow-365"><span class="linenos"> 365</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-366"><a href="#ValveTestWindow-366"><span class="linenos"> 366</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-367"><a href="#ValveTestWindow-367"><span class="linenos"> 367</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-368"><a href="#ValveTestWindow-368"><span class="linenos"> 368</span></a>
</span><span id="ValveTestWindow-369"><a href="#ValveTestWindow-369"><span class="linenos"> 369</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="ValveTestWindow-370"><a href="#ValveTestWindow-370"><span class="linenos"> 370</span></a>            <span class="n">frame</span><span class="p">,</span>
</span><span id="ValveTestWindow-371"><a href="#ValveTestWindow-371"><span class="linenos"> 371</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;How Many Times Should the Valve Actuate?&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-372"><a href="#ValveTestWindow-372"><span class="linenos"> 372</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-373"><a href="#ValveTestWindow-373"><span class="linenos"> 373</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span><span id="ValveTestWindow-374"><a href="#ValveTestWindow-374"><span class="linenos"> 374</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow-375"><a href="#ValveTestWindow-375"><span class="linenos"> 375</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;dark blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-376"><a href="#ValveTestWindow-376"><span class="linenos"> 376</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ValveTestWindow-377"><a href="#ValveTestWindow-377"><span class="linenos"> 377</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="ValveTestWindow-378"><a href="#ValveTestWindow-378"><span class="linenos"> 378</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-379"><a href="#ValveTestWindow-379"><span class="linenos"> 379</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="ValveTestWindow-380"><a href="#ValveTestWindow-380"><span class="linenos"> 380</span></a>
</span><span id="ValveTestWindow-381"><a href="#ValveTestWindow-381"><span class="linenos"> 381</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span>
</span><span id="ValveTestWindow-382"><a href="#ValveTestWindow-382"><span class="linenos"> 382</span></a>            <span class="n">frame</span><span class="p">,</span>
</span><span id="ValveTestWindow-383"><a href="#ValveTestWindow-383"><span class="linenos"> 383</span></a>            <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="p">,</span>
</span><span id="ValveTestWindow-384"><a href="#ValveTestWindow-384"><span class="linenos"> 384</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
</span><span id="ValveTestWindow-385"><a href="#ValveTestWindow-385"><span class="linenos"> 385</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow-386"><a href="#ValveTestWindow-386"><span class="linenos"> 386</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-387"><a href="#ValveTestWindow-387"><span class="linenos"> 387</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-388"><a href="#ValveTestWindow-388"><span class="linenos"> 388</span></a>        <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="ValveTestWindow-389"><a href="#ValveTestWindow-389"><span class="linenos"> 389</span></a>
</span><span id="ValveTestWindow-390"><a href="#ValveTestWindow-390"><span class="linenos"> 390</span></a>        <span class="c1">### ROW 3 ###</span>
</span><span id="ValveTestWindow-391"><a href="#ValveTestWindow-391"><span class="linenos"> 391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_valve_test_table</span><span class="p">()</span>
</span><span id="ValveTestWindow-392"><a href="#ValveTestWindow-392"><span class="linenos"> 392</span></a>
</span><span id="ValveTestWindow-393"><a href="#ValveTestWindow-393"><span class="linenos"> 393</span></a>        <span class="c1"># setup frames for valve buttons</span>
</span><span id="ValveTestWindow-394"><a href="#ValveTestWindow-394"><span class="linenos"> 394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow-395"><a href="#ValveTestWindow-395"><span class="linenos"> 395</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow-396"><a href="#ValveTestWindow-396"><span class="linenos"> 396</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-397"><a href="#ValveTestWindow-397"><span class="linenos"> 397</span></a>        <span class="c1">### ROW 4 ###</span>
</span><span id="ValveTestWindow-398"><a href="#ValveTestWindow-398"><span class="linenos"> 398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-399"><a href="#ValveTestWindow-399"><span class="linenos"> 399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-400"><a href="#ValveTestWindow-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-401"><a href="#ValveTestWindow-401"><span class="linenos"> 401</span></a>
</span><span id="ValveTestWindow-402"><a href="#ValveTestWindow-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow-403"><a href="#ValveTestWindow-403"><span class="linenos"> 403</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow-404"><a href="#ValveTestWindow-404"><span class="linenos"> 404</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-405"><a href="#ValveTestWindow-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-406"><a href="#ValveTestWindow-406"><span class="linenos"> 406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-407"><a href="#ValveTestWindow-407"><span class="linenos"> 407</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="ValveTestWindow-408"><a href="#ValveTestWindow-408"><span class="linenos"> 408</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-409"><a href="#ValveTestWindow-409"><span class="linenos"> 409</span></a>
</span><span id="ValveTestWindow-410"><a href="#ValveTestWindow-410"><span class="linenos"> 410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow-411"><a href="#ValveTestWindow-411"><span class="linenos"> 411</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow-412"><a href="#ValveTestWindow-412"><span class="linenos"> 412</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-413"><a href="#ValveTestWindow-413"><span class="linenos"> 413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-414"><a href="#ValveTestWindow-414"><span class="linenos"> 414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-415"><a href="#ValveTestWindow-415"><span class="linenos"> 415</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="ValveTestWindow-416"><a href="#ValveTestWindow-416"><span class="linenos"> 416</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-417"><a href="#ValveTestWindow-417"><span class="linenos"> 417</span></a>
</span><span id="ValveTestWindow-418"><a href="#ValveTestWindow-418"><span class="linenos"> 418</span></a>        <span class="c1">### ROW 5 ###</span>
</span><span id="ValveTestWindow-419"><a href="#ValveTestWindow-419"><span class="linenos"> 419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_buttons</span><span class="p">()</span>
</span><span id="ValveTestWindow-420"><a href="#ValveTestWindow-420"><span class="linenos"> 420</span></a>
</span><span id="ValveTestWindow-421"><a href="#ValveTestWindow-421"><span class="linenos"> 421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
</span><span id="ValveTestWindow-422"><a href="#ValveTestWindow-422"><span class="linenos"> 422</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">center_window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="ValveTestWindow-423"><a href="#ValveTestWindow-423"><span class="linenos"> 423</span></a>
</span><span id="ValveTestWindow-424"><a href="#ValveTestWindow-424"><span class="linenos"> 424</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_testing_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-425"><a href="#ValveTestWindow-425"><span class="linenos"> 425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-426"><a href="#ValveTestWindow-426"><span class="linenos"> 426</span></a><span class="sd">        Handles the action of the main button when in Testing mode.</span>
</span><span id="ValveTestWindow-427"><a href="#ValveTestWindow-427"><span class="linenos"> 427</span></a>
</span><span id="ValveTestWindow-428"><a href="#ValveTestWindow-428"><span class="linenos"> 428</span></a><span class="sd">        If a test is running, it calls `abort_test()` and updates the button appearance.</span>
</span><span id="ValveTestWindow-429"><a href="#ValveTestWindow-429"><span class="linenos"> 429</span></a><span class="sd">        If no test is running, it calls `send_schedules()` to initiate a new test.</span>
</span><span id="ValveTestWindow-430"><a href="#ValveTestWindow-430"><span class="linenos"> 430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-431"><a href="#ValveTestWindow-431"><span class="linenos"> 431</span></a>
</span><span id="ValveTestWindow-432"><a href="#ValveTestWindow-432"><span class="linenos"> 432</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="ValveTestWindow-433"><a href="#ValveTestWindow-433"><span class="linenos"> 433</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-434"><a href="#ValveTestWindow-434"><span class="linenos"> 434</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-435"><a href="#ValveTestWindow-435"><span class="linenos"> 435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="ValveTestWindow-436"><a href="#ValveTestWindow-436"><span class="linenos"> 436</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-437"><a href="#ValveTestWindow-437"><span class="linenos"> 437</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">()</span>
</span><span id="ValveTestWindow-438"><a href="#ValveTestWindow-438"><span class="linenos"> 438</span></a>
</span><span id="ValveTestWindow-439"><a href="#ValveTestWindow-439"><span class="linenos"> 439</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-440"><a href="#ValveTestWindow-440"><span class="linenos"> 440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-441"><a href="#ValveTestWindow-441"><span class="linenos"> 441</span></a><span class="sd">        Creates and places the individual valve selection buttons and the main action button.</span>
</span><span id="ValveTestWindow-442"><a href="#ValveTestWindow-442"><span class="linenos"> 442</span></a>
</span><span id="ValveTestWindow-443"><a href="#ValveTestWindow-443"><span class="linenos"> 443</span></a><span class="sd">        Generates buttons for each valve (1 to TOTAL_VALVES), arranging them</span>
</span><span id="ValveTestWindow-444"><a href="#ValveTestWindow-444"><span class="linenos"> 444</span></a><span class="sd">        into side-one and side-two frames using `GUIUtils.create_button`.</span>
</span><span id="ValveTestWindow-445"><a href="#ValveTestWindow-445"><span class="linenos"> 445</span></a><span class="sd">        Assigns the `toggle_valve_button` command to each valve button.</span>
</span><span id="ValveTestWindow-446"><a href="#ValveTestWindow-446"><span class="linenos"> 446</span></a>
</span><span id="ValveTestWindow-447"><a href="#ValveTestWindow-447"><span class="linenos"> 447</span></a><span class="sd">        Creates the main &#39;Start Testing&#39; / &#39;Start Priming&#39; / &#39;Abort&#39; button.</span>
</span><span id="ValveTestWindow-448"><a href="#ValveTestWindow-448"><span class="linenos"> 448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-449"><a href="#ValveTestWindow-449"><span class="linenos"> 449</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">):</span>
</span><span id="ValveTestWindow-450"><a href="#ValveTestWindow-450"><span class="linenos"> 450</span></a>            <span class="c1"># GUIUtils.create_button returns both the buttons frame and button object in a tuple. using [1] on the</span>
</span><span id="ValveTestWindow-451"><a href="#ValveTestWindow-451"><span class="linenos"> 451</span></a>            <span class="c1"># return item yields the button object.</span>
</span><span id="ValveTestWindow-452"><a href="#ValveTestWindow-452"><span class="linenos"> 452</span></a>
</span><span id="ValveTestWindow-453"><a href="#ValveTestWindow-453"><span class="linenos"> 453</span></a>            <span class="c1"># return the side one button and put it on the side one &#39;side&#39;</span>
</span><span id="ValveTestWindow-454"><a href="#ValveTestWindow-454"><span class="linenos"> 454</span></a>            <span class="c1"># of the list (0-4)</span>
</span><span id="ValveTestWindow-455"><a href="#ValveTestWindow-455"><span class="linenos"> 455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow-456"><a href="#ValveTestWindow-456"><span class="linenos"> 456</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow-457"><a href="#ValveTestWindow-457"><span class="linenos"> 457</span></a>                <span class="sa">f</span><span class="s2">&quot;Valve </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-458"><a href="#ValveTestWindow-458"><span class="linenos"> 458</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_valve_button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span>
</span><span id="ValveTestWindow-459"><a href="#ValveTestWindow-459"><span class="linenos"> 459</span></a>                <span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-460"><a href="#ValveTestWindow-460"><span class="linenos"> 460</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="ValveTestWindow-461"><a href="#ValveTestWindow-461"><span class="linenos"> 461</span></a>                <span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow-462"><a href="#ValveTestWindow-462"><span class="linenos"> 462</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ValveTestWindow-463"><a href="#ValveTestWindow-463"><span class="linenos"> 463</span></a>
</span><span id="ValveTestWindow-464"><a href="#ValveTestWindow-464"><span class="linenos"> 464</span></a>            <span class="c1"># return the side two button and put it on the side two &#39;side&#39;</span>
</span><span id="ValveTestWindow-465"><a href="#ValveTestWindow-465"><span class="linenos"> 465</span></a>            <span class="c1"># of the list (5-8)</span>
</span><span id="ValveTestWindow-466"><a href="#ValveTestWindow-466"><span class="linenos"> 466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow-467"><a href="#ValveTestWindow-467"><span class="linenos"> 467</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow-468"><a href="#ValveTestWindow-468"><span class="linenos"> 468</span></a>                <span class="sa">f</span><span class="s2">&quot;Valve </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-469"><a href="#ValveTestWindow-469"><span class="linenos"> 469</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_valve_button</span><span class="p">(</span>
</span><span id="ValveTestWindow-470"><a href="#ValveTestWindow-470"><span class="linenos"> 470</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)],</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)</span>
</span><span id="ValveTestWindow-471"><a href="#ValveTestWindow-471"><span class="linenos"> 471</span></a>                <span class="p">),</span>
</span><span id="ValveTestWindow-472"><a href="#ValveTestWindow-472"><span class="linenos"> 472</span></a>                <span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-473"><a href="#ValveTestWindow-473"><span class="linenos"> 473</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="ValveTestWindow-474"><a href="#ValveTestWindow-474"><span class="linenos"> 474</span></a>                <span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow-475"><a href="#ValveTestWindow-475"><span class="linenos"> 475</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ValveTestWindow-476"><a href="#ValveTestWindow-476"><span class="linenos"> 476</span></a>
</span><span id="ValveTestWindow-477"><a href="#ValveTestWindow-477"><span class="linenos"> 477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow-478"><a href="#ValveTestWindow-478"><span class="linenos"> 478</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_testing_toggle</span><span class="p">(),</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="ValveTestWindow-479"><a href="#ValveTestWindow-479"><span class="linenos"> 479</span></a>        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ValveTestWindow-480"><a href="#ValveTestWindow-480"><span class="linenos"> 480</span></a>
</span><span id="ValveTestWindow-481"><a href="#ValveTestWindow-481"><span class="linenos"> 481</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_valve_test_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-482"><a href="#ValveTestWindow-482"><span class="linenos"> 482</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-483"><a href="#ValveTestWindow-483"><span class="linenos"> 483</span></a><span class="sd">        Creates, configures, and populates the initial state of the ttk.Treeview table.</span>
</span><span id="ValveTestWindow-484"><a href="#ValveTestWindow-484"><span class="linenos"> 484</span></a>
</span><span id="ValveTestWindow-485"><a href="#ValveTestWindow-485"><span class="linenos"> 485</span></a><span class="sd">        Sets up the table columns (&quot;Valve&quot;, &quot;Amount Dispensed...&quot;, &quot;Testing Opening Time...&quot;).</span>
</span><span id="ValveTestWindow-486"><a href="#ValveTestWindow-486"><span class="linenos"> 486</span></a><span class="sd">        Adds a button above the table to open the `ManualTimeAdjustment` window.</span>
</span><span id="ValveTestWindow-487"><a href="#ValveTestWindow-487"><span class="linenos"> 487</span></a>
</span><span id="ValveTestWindow-488"><a href="#ValveTestWindow-488"><span class="linenos"> 488</span></a><span class="sd">        Loads the currently selected valve durations from `models.arduino_data.ArduinoData`.</span>
</span><span id="ValveTestWindow-489"><a href="#ValveTestWindow-489"><span class="linenos"> 489</span></a><span class="sd">        Inserts initial rows for all possible valves, marking them as &quot;Test Not Complete&quot;</span>
</span><span id="ValveTestWindow-490"><a href="#ValveTestWindow-490"><span class="linenos"> 490</span></a><span class="sd">        and displaying their current duration. Stores row IDs in `self.table_entries` for later access.</span>
</span><span id="ValveTestWindow-491"><a href="#ValveTestWindow-491"><span class="linenos"> 491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-492"><a href="#ValveTestWindow-492"><span class="linenos"> 492</span></a>
</span><span id="ValveTestWindow-493"><a href="#ValveTestWindow-493"><span class="linenos"> 493</span></a>        <span class="c1"># this function creates and labels the testing window table that displays the information recieved from the arduino reguarding the results of the tes</span>
</span><span id="ValveTestWindow-494"><a href="#ValveTestWindow-494"><span class="linenos"> 494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow-495"><a href="#ValveTestWindow-495"><span class="linenos"> 495</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow-496"><a href="#ValveTestWindow-496"><span class="linenos"> 496</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-497"><a href="#ValveTestWindow-497"><span class="linenos"> 497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="ValveTestWindow-498"><a href="#ValveTestWindow-498"><span class="linenos"> 498</span></a>        <span class="c1"># tell the frame to fill the available width</span>
</span><span id="ValveTestWindow-499"><a href="#ValveTestWindow-499"><span class="linenos"> 499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow-500"><a href="#ValveTestWindow-500"><span class="linenos"> 500</span></a>
</span><span id="ValveTestWindow-501"><a href="#ValveTestWindow-501"><span class="linenos"> 501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Treeview</span><span class="p">(</span>
</span><span id="ValveTestWindow-502"><a href="#ValveTestWindow-502"><span class="linenos"> 502</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;headings&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">12</span>
</span><span id="ValveTestWindow-503"><a href="#ValveTestWindow-503"><span class="linenos"> 503</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-504"><a href="#ValveTestWindow-504"><span class="linenos"> 504</span></a>
</span><span id="ValveTestWindow-505"><a href="#ValveTestWindow-505"><span class="linenos"> 505</span></a>        <span class="n">headings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow-506"><a href="#ValveTestWindow-506"><span class="linenos"> 506</span></a>            <span class="s2">&quot;Valve&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-507"><a href="#ValveTestWindow-507"><span class="linenos"> 507</span></a>            <span class="s2">&quot;Amount Dispensed Per Lick (ul)&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-508"><a href="#ValveTestWindow-508"><span class="linenos"> 508</span></a>            <span class="s2">&quot;Testing Opening Time of (ms)&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-509"><a href="#ValveTestWindow-509"><span class="linenos"> 509</span></a>        <span class="p">]</span>
</span><span id="ValveTestWindow-510"><a href="#ValveTestWindow-510"><span class="linenos"> 510</span></a>
</span><span id="ValveTestWindow-511"><a href="#ValveTestWindow-511"><span class="linenos"> 511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headings</span>
</span><span id="ValveTestWindow-512"><a href="#ValveTestWindow-512"><span class="linenos"> 512</span></a>
</span><span id="ValveTestWindow-513"><a href="#ValveTestWindow-513"><span class="linenos"> 513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;ew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-514"><a href="#ValveTestWindow-514"><span class="linenos"> 514</span></a>
</span><span id="ValveTestWindow-515"><a href="#ValveTestWindow-515"><span class="linenos"> 515</span></a>        <span class="n">button</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="ValveTestWindow-516"><a href="#ValveTestWindow-516"><span class="linenos"> 516</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow-517"><a href="#ValveTestWindow-517"><span class="linenos"> 517</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Manual Valve Duration Override&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-518"><a href="#ValveTestWindow-518"><span class="linenos"> 518</span></a>            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span><span class="o">.</span><span class="n">show</span><span class="p">(),</span>
</span><span id="ValveTestWindow-519"><a href="#ValveTestWindow-519"><span class="linenos"> 519</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-520"><a href="#ValveTestWindow-520"><span class="linenos"> 520</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-521"><a href="#ValveTestWindow-521"><span class="linenos"> 521</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow-522"><a href="#ValveTestWindow-522"><span class="linenos"> 522</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-523"><a href="#ValveTestWindow-523"><span class="linenos"> 523</span></a>
</span><span id="ValveTestWindow-524"><a href="#ValveTestWindow-524"><span class="linenos"> 524</span></a>        <span class="n">button</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-525"><a href="#ValveTestWindow-525"><span class="linenos"> 525</span></a>
</span><span id="ValveTestWindow-526"><a href="#ValveTestWindow-526"><span class="linenos"> 526</span></a>        <span class="c1"># Configure the columns</span>
</span><span id="ValveTestWindow-527"><a href="#ValveTestWindow-527"><span class="linenos"> 527</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]:</span>
</span><span id="ValveTestWindow-528"><a href="#ValveTestWindow-528"><span class="linenos"> 528</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="ValveTestWindow-529"><a href="#ValveTestWindow-529"><span class="linenos"> 529</span></a>
</span><span id="ValveTestWindow-530"><a href="#ValveTestWindow-530"><span class="linenos"> 530</span></a>        <span class="n">arduino_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="ValveTestWindow-531"><a href="#ValveTestWindow-531"><span class="linenos"> 531</span></a>
</span><span id="ValveTestWindow-532"><a href="#ValveTestWindow-532"><span class="linenos"> 532</span></a>        <span class="n">side_one_durations</span><span class="p">,</span> <span class="n">side_two_durations</span><span class="p">,</span> <span class="n">date_used</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ValveTestWindow-533"><a href="#ValveTestWindow-533"><span class="linenos"> 533</span></a>            <span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow-534"><a href="#ValveTestWindow-534"><span class="linenos"> 534</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-535"><a href="#ValveTestWindow-535"><span class="linenos"> 535</span></a>
</span><span id="ValveTestWindow-536"><a href="#ValveTestWindow-536"><span class="linenos"> 536</span></a>        <span class="c1"># insert default entries for each total valve until user selects how many</span>
</span><span id="ValveTestWindow-537"><a href="#ValveTestWindow-537"><span class="linenos"> 537</span></a>        <span class="c1"># they want to test</span>
</span><span id="ValveTestWindow-538"><a href="#ValveTestWindow-538"><span class="linenos"> 538</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">):</span>
</span><span id="ValveTestWindow-539"><a href="#ValveTestWindow-539"><span class="linenos"> 539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="ValveTestWindow-540"><a href="#ValveTestWindow-540"><span class="linenos"> 540</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-541"><a href="#ValveTestWindow-541"><span class="linenos"> 541</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="ValveTestWindow-542"><a href="#ValveTestWindow-542"><span class="linenos"> 542</span></a>                <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="ValveTestWindow-543"><a href="#ValveTestWindow-543"><span class="linenos"> 543</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-544"><a href="#ValveTestWindow-544"><span class="linenos"> 544</span></a>                    <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-545"><a href="#ValveTestWindow-545"><span class="linenos"> 545</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">side_one_durations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-546"><a href="#ValveTestWindow-546"><span class="linenos"> 546</span></a>                <span class="p">),</span>
</span><span id="ValveTestWindow-547"><a href="#ValveTestWindow-547"><span class="linenos"> 547</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-548"><a href="#ValveTestWindow-548"><span class="linenos"> 548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="ValveTestWindow-549"><a href="#ValveTestWindow-549"><span class="linenos"> 549</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-550"><a href="#ValveTestWindow-550"><span class="linenos"> 550</span></a>                <span class="n">i</span> <span class="o">+</span> <span class="n">VALVES_PER_SIDE</span><span class="p">,</span>
</span><span id="ValveTestWindow-551"><a href="#ValveTestWindow-551"><span class="linenos"> 551</span></a>                <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="ValveTestWindow-552"><a href="#ValveTestWindow-552"><span class="linenos"> 552</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">VALVES_PER_SIDE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-553"><a href="#ValveTestWindow-553"><span class="linenos"> 553</span></a>                    <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-554"><a href="#ValveTestWindow-554"><span class="linenos"> 554</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">side_two_durations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-555"><a href="#ValveTestWindow-555"><span class="linenos"> 555</span></a>                <span class="p">),</span>
</span><span id="ValveTestWindow-556"><a href="#ValveTestWindow-556"><span class="linenos"> 556</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-557"><a href="#ValveTestWindow-557"><span class="linenos"> 557</span></a>
</span><span id="ValveTestWindow-558"><a href="#ValveTestWindow-558"><span class="linenos"> 558</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_table_entry_test_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valve</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">l_per_lick</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-559"><a href="#ValveTestWindow-559"><span class="linenos"> 559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-560"><a href="#ValveTestWindow-560"><span class="linenos"> 560</span></a><span class="sd">        Updates the &#39;Amount Dispensed Per Lick (ul)&#39; column for a specific valve row.</span>
</span><span id="ValveTestWindow-561"><a href="#ValveTestWindow-561"><span class="linenos"> 561</span></a>
</span><span id="ValveTestWindow-562"><a href="#ValveTestWindow-562"><span class="linenos"> 562</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-563"><a href="#ValveTestWindow-563"><span class="linenos"> 563</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-564"><a href="#ValveTestWindow-564"><span class="linenos"> 564</span></a><span class="sd">        - **valve** (*int*): The 1-indexed valve number whose row needs updating.</span>
</span><span id="ValveTestWindow-565"><a href="#ValveTestWindow-565"><span class="linenos"> 565</span></a><span class="sd">        - **l_per_lick** (*float*): The calculated volume dispensed per lick in milliliters (mL).</span>
</span><span id="ValveTestWindow-566"><a href="#ValveTestWindow-566"><span class="linenos"> 566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-567"><a href="#ValveTestWindow-567"><span class="linenos"> 567</span></a>
</span><span id="ValveTestWindow-568"><a href="#ValveTestWindow-568"><span class="linenos"> 568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
</span><span id="ValveTestWindow-569"><a href="#ValveTestWindow-569"><span class="linenos"> 569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l_per_lick</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2"> uL&quot;</span>
</span><span id="ValveTestWindow-570"><a href="#ValveTestWindow-570"><span class="linenos"> 570</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-571"><a href="#ValveTestWindow-571"><span class="linenos"> 571</span></a>
</span><span id="ValveTestWindow-572"><a href="#ValveTestWindow-572"><span class="linenos"> 572</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_table_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-573"><a href="#ValveTestWindow-573"><span class="linenos"> 573</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-574"><a href="#ValveTestWindow-574"><span class="linenos"> 574</span></a><span class="sd">        Refreshes the entire valve test table based on current selections and durations.</span>
</span><span id="ValveTestWindow-575"><a href="#ValveTestWindow-575"><span class="linenos"> 575</span></a>
</span><span id="ValveTestWindow-576"><a href="#ValveTestWindow-576"><span class="linenos"> 576</span></a><span class="sd">        Hides rows for unselected valves and shows rows for selected valves.</span>
</span><span id="ValveTestWindow-577"><a href="#ValveTestWindow-577"><span class="linenos"> 577</span></a><span class="sd">        Reloads the latest durations from `ArduinoData` and updates the</span>
</span><span id="ValveTestWindow-578"><a href="#ValveTestWindow-578"><span class="linenos"> 578</span></a><span class="sd">        &#39;Testing Opening Time&#39; column for all visible rows. Resets the</span>
</span><span id="ValveTestWindow-579"><a href="#ValveTestWindow-579"><span class="linenos"> 579</span></a><span class="sd">        &#39;Amount Dispensed&#39; column to &quot;Test Not Complete&quot; for visible rows.</span>
</span><span id="ValveTestWindow-580"><a href="#ValveTestWindow-580"><span class="linenos"> 580</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-581"><a href="#ValveTestWindow-581"><span class="linenos"> 581</span></a>        <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow-582"><a href="#ValveTestWindow-582"><span class="linenos"> 582</span></a>        <span class="c1"># np array where the entry is not zero but the valve number itself</span>
</span><span id="ValveTestWindow-583"><a href="#ValveTestWindow-583"><span class="linenos"> 583</span></a>        <span class="n">selected_valves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="ValveTestWindow-584"><a href="#ValveTestWindow-584"><span class="linenos"> 584</span></a>
</span><span id="ValveTestWindow-585"><a href="#ValveTestWindow-585"><span class="linenos"> 585</span></a>        <span class="c1"># for all valve numbers, if that number is in selected_valves -1 (the entire array</span>
</span><span id="ValveTestWindow-586"><a href="#ValveTestWindow-586"><span class="linenos"> 586</span></a>        <span class="c1"># decremented by one) place it in the table and ensure its duration is up-to-date</span>
</span><span id="ValveTestWindow-587"><a href="#ValveTestWindow-587"><span class="linenos"> 587</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TOTAL_VALVES</span><span class="p">):</span>
</span><span id="ValveTestWindow-588"><a href="#ValveTestWindow-588"><span class="linenos"> 588</span></a>            <span class="c1"># if the iter number is also contained in the selected valves arr</span>
</span><span id="ValveTestWindow-589"><a href="#ValveTestWindow-589"><span class="linenos"> 589</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">selected_valves</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="ValveTestWindow-590"><a href="#ValveTestWindow-590"><span class="linenos"> 590</span></a>                <span class="c1"># check if it&#39;s side two or side one</span>
</span><span id="ValveTestWindow-591"><a href="#ValveTestWindow-591"><span class="linenos"> 591</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">VALVES_PER_SIDE</span><span class="p">:</span>
</span><span id="ValveTestWindow-592"><a href="#ValveTestWindow-592"><span class="linenos"> 592</span></a>                    <span class="n">duration</span> <span class="o">=</span> <span class="n">side_two</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">VALVES_PER_SIDE</span><span class="p">]</span>
</span><span id="ValveTestWindow-593"><a href="#ValveTestWindow-593"><span class="linenos"> 593</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-594"><a href="#ValveTestWindow-594"><span class="linenos"> 594</span></a>                    <span class="n">duration</span> <span class="o">=</span> <span class="n">side_one</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ValveTestWindow-595"><a href="#ValveTestWindow-595"><span class="linenos"> 595</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
</span><span id="ValveTestWindow-596"><a href="#ValveTestWindow-596"><span class="linenos"> 596</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="ValveTestWindow-597"><a href="#ValveTestWindow-597"><span class="linenos"> 597</span></a>                    <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="ValveTestWindow-598"><a href="#ValveTestWindow-598"><span class="linenos"> 598</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-599"><a href="#ValveTestWindow-599"><span class="linenos"> 599</span></a>                        <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-600"><a href="#ValveTestWindow-600"><span class="linenos"> 600</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-601"><a href="#ValveTestWindow-601"><span class="linenos"> 601</span></a>                    <span class="p">),</span>
</span><span id="ValveTestWindow-602"><a href="#ValveTestWindow-602"><span class="linenos"> 602</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow-603"><a href="#ValveTestWindow-603"><span class="linenos"> 603</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">reattach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ValveTestWindow-604"><a href="#ValveTestWindow-604"><span class="linenos"> 604</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-605"><a href="#ValveTestWindow-605"><span class="linenos"> 605</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="ValveTestWindow-606"><a href="#ValveTestWindow-606"><span class="linenos"> 606</span></a>
</span><span id="ValveTestWindow-607"><a href="#ValveTestWindow-607"><span class="linenos"> 607</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Valve test table updated.&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-608"><a href="#ValveTestWindow-608"><span class="linenos"> 608</span></a>
</span><span id="ValveTestWindow-609"><a href="#ValveTestWindow-609"><span class="linenos"> 609</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_valve_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span> <span class="n">valve_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-610"><a href="#ValveTestWindow-610"><span class="linenos"> 610</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-611"><a href="#ValveTestWindow-611"><span class="linenos"> 611</span></a><span class="sd">        Handles the click event for a valve selection button.</span>
</span><span id="ValveTestWindow-612"><a href="#ValveTestWindow-612"><span class="linenos"> 612</span></a>
</span><span id="ValveTestWindow-613"><a href="#ValveTestWindow-613"><span class="linenos"> 613</span></a><span class="sd">        Toggles the button&#39;s visual state (raised/sunken). Updates the</span>
</span><span id="ValveTestWindow-614"><a href="#ValveTestWindow-614"><span class="linenos"> 614</span></a><span class="sd">        corresponding entry in the `self.valve_selections` numpy array (0 for</span>
</span><span id="ValveTestWindow-615"><a href="#ValveTestWindow-615"><span class="linenos"> 615</span></a><span class="sd">        deselected, valve_number + 1 for selected). Calls `update_table_entries`</span>
</span><span id="ValveTestWindow-616"><a href="#ValveTestWindow-616"><span class="linenos"> 616</span></a><span class="sd">        to refresh the table display. Filling arrays this way allows us to tell</span>
</span><span id="ValveTestWindow-617"><a href="#ValveTestWindow-617"><span class="linenos"> 617</span></a><span class="sd">        the arduino exactly which valves should be toggled (1, 4, 7) as long as</span>
</span><span id="ValveTestWindow-618"><a href="#ValveTestWindow-618"><span class="linenos"> 618</span></a><span class="sd">        their value in the array is not 0.</span>
</span><span id="ValveTestWindow-619"><a href="#ValveTestWindow-619"><span class="linenos"> 619</span></a>
</span><span id="ValveTestWindow-620"><a href="#ValveTestWindow-620"><span class="linenos"> 620</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-621"><a href="#ValveTestWindow-621"><span class="linenos"> 621</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-622"><a href="#ValveTestWindow-622"><span class="linenos"> 622</span></a><span class="sd">        - **button** (*tk.Button*): The specific valve button widget that was clicked.</span>
</span><span id="ValveTestWindow-623"><a href="#ValveTestWindow-623"><span class="linenos"> 623</span></a><span class="sd">        - **valve_num** (*int*): The 0-indexed number of the valve corresponding to the button.</span>
</span><span id="ValveTestWindow-624"><a href="#ValveTestWindow-624"><span class="linenos"> 624</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-625"><a href="#ValveTestWindow-625"><span class="linenos"> 625</span></a>        <span class="c1"># Attempt to get the value to ensure it&#39;s a valid float as expected</span>
</span><span id="ValveTestWindow-626"><a href="#ValveTestWindow-626"><span class="linenos"> 626</span></a>        <span class="c1"># If successful, call the function to update/create the valve test table</span>
</span><span id="ValveTestWindow-627"><a href="#ValveTestWindow-627"><span class="linenos"> 627</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ValveTestWindow-628"><a href="#ValveTestWindow-628"><span class="linenos"> 628</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-629"><a href="#ValveTestWindow-629"><span class="linenos"> 629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">valve_num</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ValveTestWindow-630"><a href="#ValveTestWindow-630"><span class="linenos"> 630</span></a>
</span><span id="ValveTestWindow-631"><a href="#ValveTestWindow-631"><span class="linenos"> 631</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-632"><a href="#ValveTestWindow-632"><span class="linenos"> 632</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-633"><a href="#ValveTestWindow-633"><span class="linenos"> 633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ValveTestWindow-634"><a href="#ValveTestWindow-634"><span class="linenos"> 634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_table_entries</span><span class="p">()</span>
</span><span id="ValveTestWindow-635"><a href="#ValveTestWindow-635"><span class="linenos"> 635</span></a>
</span><span id="ValveTestWindow-636"><a href="#ValveTestWindow-636"><span class="linenos"> 636</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ValveTestWindow-637"><a href="#ValveTestWindow-637"><span class="linenos"> 637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-638"><a href="#ValveTestWindow-638"><span class="linenos"> 638</span></a><span class="sd">        Verifies that the Arduino correctly received the test/prime parameters.</span>
</span><span id="ValveTestWindow-639"><a href="#ValveTestWindow-639"><span class="linenos"> 639</span></a>
</span><span id="ValveTestWindow-640"><a href="#ValveTestWindow-640"><span class="linenos"> 640</span></a><span class="sd">        Waits for and reads back the schedule lengths and actuation count echoed</span>
</span><span id="ValveTestWindow-641"><a href="#ValveTestWindow-641"><span class="linenos"> 641</span></a><span class="sd">        by the Arduino. Compares the received bytes with the originally sent data.</span>
</span><span id="ValveTestWindow-642"><a href="#ValveTestWindow-642"><span class="linenos"> 642</span></a>
</span><span id="ValveTestWindow-643"><a href="#ValveTestWindow-643"><span class="linenos"> 643</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-644"><a href="#ValveTestWindow-644"><span class="linenos"> 644</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-645"><a href="#ValveTestWindow-645"><span class="linenos"> 645</span></a><span class="sd">        - **original_data** (*bytes*): The byte string containing schedule lengths and actuation count originally sent to the Arduino.</span>
</span><span id="ValveTestWindow-646"><a href="#ValveTestWindow-646"><span class="linenos"> 646</span></a>
</span><span id="ValveTestWindow-647"><a href="#ValveTestWindow-647"><span class="linenos"> 647</span></a><span class="sd">        Returns</span>
</span><span id="ValveTestWindow-648"><a href="#ValveTestWindow-648"><span class="linenos"> 648</span></a><span class="sd">        -------</span>
</span><span id="ValveTestWindow-649"><a href="#ValveTestWindow-649"><span class="linenos"> 649</span></a><span class="sd">        - *bool*: `True` if the received data matches the original data, `False` otherwise (logs error and shows message box on mismatch).</span>
</span><span id="ValveTestWindow-650"><a href="#ValveTestWindow-650"><span class="linenos"> 650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-651"><a href="#ValveTestWindow-651"><span class="linenos"> 651</span></a>        <span class="c1"># wait until all data is on the wire ready to be read (4 bytes),</span>
</span><span id="ValveTestWindow-652"><a href="#ValveTestWindow-652"><span class="linenos"> 652</span></a>        <span class="c1"># then read it all in quick succession</span>
</span><span id="ValveTestWindow-653"><a href="#ValveTestWindow-653"><span class="linenos"> 653</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-654"><a href="#ValveTestWindow-654"><span class="linenos"> 654</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow-655"><a href="#ValveTestWindow-655"><span class="linenos"> 655</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-656"><a href="#ValveTestWindow-656"><span class="linenos"> 656</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-657"><a href="#ValveTestWindow-657"><span class="linenos"> 657</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-658"><a href="#ValveTestWindow-658"><span class="linenos"> 658</span></a>
</span><span id="ValveTestWindow-659"><a href="#ValveTestWindow-659"><span class="linenos"> 659</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="ValveTestWindow-660"><a href="#ValveTestWindow-660"><span class="linenos"> 660</span></a>            <span class="k">pass</span>
</span><span id="ValveTestWindow-661"><a href="#ValveTestWindow-661"><span class="linenos"> 661</span></a>
</span><span id="ValveTestWindow-662"><a href="#ValveTestWindow-662"><span class="linenos"> 662</span></a>        <span class="n">ver_len_sched_sd_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ValveTestWindow-663"><a href="#ValveTestWindow-663"><span class="linenos"> 663</span></a>        <span class="n">ver_len_sched_sd_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ValveTestWindow-664"><a href="#ValveTestWindow-664"><span class="linenos"> 664</span></a>
</span><span id="ValveTestWindow-665"><a href="#ValveTestWindow-665"><span class="linenos"> 665</span></a>        <span class="n">ver_valve_act_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ValveTestWindow-666"><a href="#ValveTestWindow-666"><span class="linenos"> 666</span></a>
</span><span id="ValveTestWindow-667"><a href="#ValveTestWindow-667"><span class="linenos"> 667</span></a>        <span class="n">verification_data</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ValveTestWindow-668"><a href="#ValveTestWindow-668"><span class="linenos"> 668</span></a>            <span class="n">ver_len_sched_sd_one</span> <span class="o">+</span> <span class="n">ver_len_sched_sd_two</span> <span class="o">+</span> <span class="n">ver_valve_act_time</span>
</span><span id="ValveTestWindow-669"><a href="#ValveTestWindow-669"><span class="linenos"> 669</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-670"><a href="#ValveTestWindow-670"><span class="linenos"> 670</span></a>        <span class="k">if</span> <span class="n">verification_data</span> <span class="o">==</span> <span class="n">original_data</span><span class="p">:</span>
</span><span id="ValveTestWindow-671"><a href="#ValveTestWindow-671"><span class="linenos"> 671</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====VERIFIED TEST VARIABLES====&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-672"><a href="#ValveTestWindow-672"><span class="linenos"> 672</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ValveTestWindow-673"><a href="#ValveTestWindow-673"><span class="linenos"> 673</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-674"><a href="#ValveTestWindow-674"><span class="linenos"> 674</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT VARIABLES DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow-675"><a href="#ValveTestWindow-675"><span class="linenos"> 675</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-676"><a href="#ValveTestWindow-676"><span class="linenos"> 676</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-677"><a href="#ValveTestWindow-677"><span class="linenos"> 677</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-678"><a href="#ValveTestWindow-678"><span class="linenos"> 678</span></a>
</span><span id="ValveTestWindow-679"><a href="#ValveTestWindow-679"><span class="linenos"> 679</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_schedule</span><span class="p">(</span>
</span><span id="ValveTestWindow-680"><a href="#ValveTestWindow-680"><span class="linenos"> 680</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">len_sched</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sent_schedule</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span>
</span><span id="ValveTestWindow-681"><a href="#ValveTestWindow-681"><span class="linenos"> 681</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ValveTestWindow-682"><a href="#ValveTestWindow-682"><span class="linenos"> 682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-683"><a href="#ValveTestWindow-683"><span class="linenos"> 683</span></a><span class="sd">        Verifies that the Arduino correctly received the valve schedule.</span>
</span><span id="ValveTestWindow-684"><a href="#ValveTestWindow-684"><span class="linenos"> 684</span></a>
</span><span id="ValveTestWindow-685"><a href="#ValveTestWindow-685"><span class="linenos"> 685</span></a><span class="sd">        Waits for and reads back the valve numbers (0-indexed) echoed byte-by-byte</span>
</span><span id="ValveTestWindow-686"><a href="#ValveTestWindow-686"><span class="linenos"> 686</span></a><span class="sd">        by the Arduino. Compares the reconstructed numpy array with the schedule</span>
</span><span id="ValveTestWindow-687"><a href="#ValveTestWindow-687"><span class="linenos"> 687</span></a><span class="sd">        that was originally sent.</span>
</span><span id="ValveTestWindow-688"><a href="#ValveTestWindow-688"><span class="linenos"> 688</span></a>
</span><span id="ValveTestWindow-689"><a href="#ValveTestWindow-689"><span class="linenos"> 689</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-690"><a href="#ValveTestWindow-690"><span class="linenos"> 690</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-691"><a href="#ValveTestWindow-691"><span class="linenos"> 691</span></a><span class="sd">        - **len_sched** (*int*): The total number of valves in the schedule being sent.</span>
</span><span id="ValveTestWindow-692"><a href="#ValveTestWindow-692"><span class="linenos"> 692</span></a><span class="sd">        - **sent_schedule** (*npt.NDArray[np.int8]*): The numpy array (0-indexed valve numbers) representing the schedule originally sent.</span>
</span><span id="ValveTestWindow-693"><a href="#ValveTestWindow-693"><span class="linenos"> 693</span></a>
</span><span id="ValveTestWindow-694"><a href="#ValveTestWindow-694"><span class="linenos"> 694</span></a><span class="sd">        Returns</span>
</span><span id="ValveTestWindow-695"><a href="#ValveTestWindow-695"><span class="linenos"> 695</span></a><span class="sd">        -------</span>
</span><span id="ValveTestWindow-696"><a href="#ValveTestWindow-696"><span class="linenos"> 696</span></a><span class="sd">        - *bool*: `True` if the received schedule matches the sent schedule, `False` otherwise (logs error and shows message box on mismatch).</span>
</span><span id="ValveTestWindow-697"><a href="#ValveTestWindow-697"><span class="linenos"> 697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-698"><a href="#ValveTestWindow-698"><span class="linenos"> 698</span></a>        <span class="c1"># np array used for verification later</span>
</span><span id="ValveTestWindow-699"><a href="#ValveTestWindow-699"><span class="linenos"> 699</span></a>        <span class="n">received_sched</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">len_sched</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
</span><span id="ValveTestWindow-700"><a href="#ValveTestWindow-700"><span class="linenos"> 700</span></a>
</span><span id="ValveTestWindow-701"><a href="#ValveTestWindow-701"><span class="linenos"> 701</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-702"><a href="#ValveTestWindow-702"><span class="linenos"> 702</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow-703"><a href="#ValveTestWindow-703"><span class="linenos"> 703</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-704"><a href="#ValveTestWindow-704"><span class="linenos"> 704</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-705"><a href="#ValveTestWindow-705"><span class="linenos"> 705</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-706"><a href="#ValveTestWindow-706"><span class="linenos"> 706</span></a>
</span><span id="ValveTestWindow-707"><a href="#ValveTestWindow-707"><span class="linenos"> 707</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&lt;</span> <span class="n">len_sched</span><span class="p">:</span>
</span><span id="ValveTestWindow-708"><a href="#ValveTestWindow-708"><span class="linenos"> 708</span></a>            <span class="k">pass</span>
</span><span id="ValveTestWindow-709"><a href="#ValveTestWindow-709"><span class="linenos"> 709</span></a>
</span><span id="ValveTestWindow-710"><a href="#ValveTestWindow-710"><span class="linenos"> 710</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_sched</span><span class="p">):</span>
</span><span id="ValveTestWindow-711"><a href="#ValveTestWindow-711"><span class="linenos"> 711</span></a>            <span class="n">received_sched</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
</span><span id="ValveTestWindow-712"><a href="#ValveTestWindow-712"><span class="linenos"> 712</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span>
</span><span id="ValveTestWindow-713"><a href="#ValveTestWindow-713"><span class="linenos"> 713</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-714"><a href="#ValveTestWindow-714"><span class="linenos"> 714</span></a>
</span><span id="ValveTestWindow-715"><a href="#ValveTestWindow-715"><span class="linenos"> 715</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">received_sched</span><span class="p">,</span> <span class="n">sent_schedule</span><span class="p">):</span>
</span><span id="ValveTestWindow-716"><a href="#ValveTestWindow-716"><span class="linenos"> 716</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;===TESTING SCHEDULE VERIFIED as ==&gt; </span><span class="si">{</span><span class="n">received_sched</span><span class="si">}</span><span class="s2">===&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-717"><a href="#ValveTestWindow-717"><span class="linenos"> 717</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====================BEGIN TESTING NOW====================&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-718"><a href="#ValveTestWindow-718"><span class="linenos"> 718</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ValveTestWindow-719"><a href="#ValveTestWindow-719"><span class="linenos"> 719</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-720"><a href="#ValveTestWindow-720"><span class="linenos"> 720</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow-721"><a href="#ValveTestWindow-721"><span class="linenos"> 721</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-722"><a href="#ValveTestWindow-722"><span class="linenos"> 722</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow-723"><a href="#ValveTestWindow-723"><span class="linenos"> 723</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-724"><a href="#ValveTestWindow-724"><span class="linenos"> 724</span></a>
</span><span id="ValveTestWindow-725"><a href="#ValveTestWindow-725"><span class="linenos"> 725</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_schedules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-726"><a href="#ValveTestWindow-726"><span class="linenos"> 726</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-727"><a href="#ValveTestWindow-727"><span class="linenos"> 727</span></a><span class="sd">        Performs the process of sending test or prime configuration to the Arduino.</span>
</span><span id="ValveTestWindow-728"><a href="#ValveTestWindow-728"><span class="linenos"> 728</span></a>
</span><span id="ValveTestWindow-729"><a href="#ValveTestWindow-729"><span class="linenos"> 729</span></a><span class="sd">        Determines selected valves and schedule lengths for each side. Sends current</span>
</span><span id="ValveTestWindow-730"><a href="#ValveTestWindow-730"><span class="linenos"> 730</span></a><span class="sd">        valve durations to Arduino. Then sends the appropriate command (&#39;TEST VOL&#39; or &#39;PRIME VALVES&#39;).</span>
</span><span id="ValveTestWindow-731"><a href="#ValveTestWindow-731"><span class="linenos"> 731</span></a>
</span><span id="ValveTestWindow-732"><a href="#ValveTestWindow-732"><span class="linenos"> 732</span></a><span class="sd">        Sends test parameters (schedule lengths, actuations) and verifies them using `verify_variables`.</span>
</span><span id="ValveTestWindow-733"><a href="#ValveTestWindow-733"><span class="linenos"> 733</span></a><span class="sd">        Sends the actual valve schedule (0-indexed) and verifies it using `verify_schedule`.</span>
</span><span id="ValveTestWindow-734"><a href="#ValveTestWindow-734"><span class="linenos"> 734</span></a>
</span><span id="ValveTestWindow-735"><a href="#ValveTestWindow-735"><span class="linenos"> 735</span></a><span class="sd">        User is then prompted to confirm before proceeding.</span>
</span><span id="ValveTestWindow-736"><a href="#ValveTestWindow-736"><span class="linenos"> 736</span></a><span class="sd">        If confirmed, initiates the test/prime sequence on the Arduino</span>
</span><span id="ValveTestWindow-737"><a href="#ValveTestWindow-737"><span class="linenos"> 737</span></a><span class="sd">        and starts the listener thread (`run_test`) if Testing, or sends start command if Priming.</span>
</span><span id="ValveTestWindow-738"><a href="#ValveTestWindow-738"><span class="linenos"> 738</span></a><span class="sd">        Updates button states accordingly.</span>
</span><span id="ValveTestWindow-739"><a href="#ValveTestWindow-739"><span class="linenos"> 739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-740"><a href="#ValveTestWindow-740"><span class="linenos"> 740</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[:</span><span class="n">VALVES_PER_SIDE</span><span class="p">])</span>
</span><span id="ValveTestWindow-741"><a href="#ValveTestWindow-741"><span class="linenos"> 741</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">VALVES_PER_SIDE</span><span class="p">:])</span>
</span><span id="ValveTestWindow-742"><a href="#ValveTestWindow-742"><span class="linenos"> 742</span></a>
</span><span id="ValveTestWindow-743"><a href="#ValveTestWindow-743"><span class="linenos"> 743</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="n">len_sched_one</span><span class="p">)</span>
</span><span id="ValveTestWindow-744"><a href="#ValveTestWindow-744"><span class="linenos"> 744</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="n">len_sched_two</span><span class="p">)</span>
</span><span id="ValveTestWindow-745"><a href="#ValveTestWindow-745"><span class="linenos"> 745</span></a>        <span class="n">len_sched</span> <span class="o">=</span> <span class="n">len_sched_one</span> <span class="o">+</span> <span class="n">len_sched_two</span>
</span><span id="ValveTestWindow-746"><a href="#ValveTestWindow-746"><span class="linenos"> 746</span></a>
</span><span id="ValveTestWindow-747"><a href="#ValveTestWindow-747"><span class="linenos"> 747</span></a>        <span class="c1"># because self.actuations is a IntVar, we use .get() method to get its value</span>
</span><span id="ValveTestWindow-748"><a href="#ValveTestWindow-748"><span class="linenos"> 748</span></a>        <span class="n">valve_acuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</span><span id="ValveTestWindow-749"><a href="#ValveTestWindow-749"><span class="linenos"> 749</span></a>
</span><span id="ValveTestWindow-750"><a href="#ValveTestWindow-750"><span class="linenos"> 750</span></a>        <span class="c1"># schedule is TOTAL_VALVES long to accomodate testing of up to all valves at one time.</span>
</span><span id="ValveTestWindow-751"><a href="#ValveTestWindow-751"><span class="linenos"> 751</span></a>        <span class="c1"># if we are not testing them all, filter out the zero entries (valves we are not testing)</span>
</span><span id="ValveTestWindow-752"><a href="#ValveTestWindow-752"><span class="linenos"> 752</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="ValveTestWindow-753"><a href="#ValveTestWindow-753"><span class="linenos"> 753</span></a>
</span><span id="ValveTestWindow-754"><a href="#ValveTestWindow-754"><span class="linenos"> 754</span></a>        <span class="c1"># decrement each element in the array by one to move to zero-indexing. We moved to 1</span>
</span><span id="ValveTestWindow-755"><a href="#ValveTestWindow-755"><span class="linenos"> 755</span></a>        <span class="c1"># indexing becuase using zero indexing does not work with the method of toggling valves</span>
</span><span id="ValveTestWindow-756"><a href="#ValveTestWindow-756"><span class="linenos"> 756</span></a>        <span class="c1"># defined above</span>
</span><span id="ValveTestWindow-757"><a href="#ValveTestWindow-757"><span class="linenos"> 757</span></a>        <span class="n">schedule</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ValveTestWindow-758"><a href="#ValveTestWindow-758"><span class="linenos"> 758</span></a>
</span><span id="ValveTestWindow-759"><a href="#ValveTestWindow-759"><span class="linenos"> 759</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[:</span><span class="n">len_sched_one</span><span class="p">]</span>
</span><span id="ValveTestWindow-760"><a href="#ValveTestWindow-760"><span class="linenos"> 760</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="n">len_sched_one</span><span class="p">:]</span>
</span><span id="ValveTestWindow-761"><a href="#ValveTestWindow-761"><span class="linenos"> 761</span></a>
</span><span id="ValveTestWindow-762"><a href="#ValveTestWindow-762"><span class="linenos"> 762</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">len_sched_one</span>
</span><span id="ValveTestWindow-763"><a href="#ValveTestWindow-763"><span class="linenos"> 763</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">len_sched_two</span>
</span><span id="ValveTestWindow-764"><a href="#ValveTestWindow-764"><span class="linenos"> 764</span></a>        <span class="n">valve_acuations</span> <span class="o">=</span> <span class="n">valve_acuations</span>
</span><span id="ValveTestWindow-765"><a href="#ValveTestWindow-765"><span class="linenos"> 765</span></a>
</span><span id="ValveTestWindow-766"><a href="#ValveTestWindow-766"><span class="linenos"> 766</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_valve_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow-767"><a href="#ValveTestWindow-767"><span class="linenos"> 767</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="ValveTestWindow-768"><a href="#ValveTestWindow-768"><span class="linenos"> 768</span></a>            <span class="c1">###====SENDING TEST COMMAND====###</span>
</span><span id="ValveTestWindow-769"><a href="#ValveTestWindow-769"><span class="linenos"> 769</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TEST VOL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-770"><a href="#ValveTestWindow-770"><span class="linenos"> 770</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="ValveTestWindow-771"><a href="#ValveTestWindow-771"><span class="linenos"> 771</span></a>
</span><span id="ValveTestWindow-772"><a href="#ValveTestWindow-772"><span class="linenos"> 772</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span><span class="p">:</span>
</span><span id="ValveTestWindow-773"><a href="#ValveTestWindow-773"><span class="linenos"> 773</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ValveTestWindow-774"><a href="#ValveTestWindow-774"><span class="linenos"> 774</span></a>
</span><span id="ValveTestWindow-775"><a href="#ValveTestWindow-775"><span class="linenos"> 775</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;PRIME VALVES</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-776"><a href="#ValveTestWindow-776"><span class="linenos"> 776</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="ValveTestWindow-777"><a href="#ValveTestWindow-777"><span class="linenos"> 777</span></a>
</span><span id="ValveTestWindow-778"><a href="#ValveTestWindow-778"><span class="linenos"> 778</span></a>        <span class="c1">###====SENDING TEST VARIABLES (len side one, two, num_actuations per test)====###</span>
</span><span id="ValveTestWindow-779"><a href="#ValveTestWindow-779"><span class="linenos"> 779</span></a>        <span class="n">data_bytes</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ValveTestWindow-780"><a href="#ValveTestWindow-780"><span class="linenos"> 780</span></a>            <span class="n">len_sched_one</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-781"><a href="#ValveTestWindow-781"><span class="linenos"> 781</span></a>            <span class="o">+</span> <span class="n">len_sched_two</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-782"><a href="#ValveTestWindow-782"><span class="linenos"> 782</span></a>            <span class="o">+</span> <span class="n">valve_acuations</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-783"><a href="#ValveTestWindow-783"><span class="linenos"> 783</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-784"><a href="#ValveTestWindow-784"><span class="linenos"> 784</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">)</span>
</span><span id="ValveTestWindow-785"><a href="#ValveTestWindow-785"><span class="linenos"> 785</span></a>
</span><span id="ValveTestWindow-786"><a href="#ValveTestWindow-786"><span class="linenos"> 786</span></a>        <span class="c1"># verify the data</span>
</span><span id="ValveTestWindow-787"><a href="#ValveTestWindow-787"><span class="linenos"> 787</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_variables</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">):</span>
</span><span id="ValveTestWindow-788"><a href="#ValveTestWindow-788"><span class="linenos"> 788</span></a>            <span class="k">return</span>
</span><span id="ValveTestWindow-789"><a href="#ValveTestWindow-789"><span class="linenos"> 789</span></a>
</span><span id="ValveTestWindow-790"><a href="#ValveTestWindow-790"><span class="linenos"> 790</span></a>        <span class="c1">###====SENDING SCHEDULE====###</span>
</span><span id="ValveTestWindow-791"><a href="#ValveTestWindow-791"><span class="linenos"> 791</span></a>        <span class="n">sched_data_bytes</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-792"><a href="#ValveTestWindow-792"><span class="linenos"> 792</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">sched_data_bytes</span><span class="p">)</span>
</span><span id="ValveTestWindow-793"><a href="#ValveTestWindow-793"><span class="linenos"> 793</span></a>
</span><span id="ValveTestWindow-794"><a href="#ValveTestWindow-794"><span class="linenos"> 794</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_schedule</span><span class="p">(</span><span class="n">len_sched</span><span class="p">,</span> <span class="n">schedule</span><span class="p">):</span>
</span><span id="ValveTestWindow-795"><a href="#ValveTestWindow-795"><span class="linenos"> 795</span></a>            <span class="k">return</span>
</span><span id="ValveTestWindow-796"><a href="#ValveTestWindow-796"><span class="linenos"> 796</span></a>
</span><span id="ValveTestWindow-797"><a href="#ValveTestWindow-797"><span class="linenos"> 797</span></a>        <span class="n">schedule</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ValveTestWindow-798"><a href="#ValveTestWindow-798"><span class="linenos"> 798</span></a>
</span><span id="ValveTestWindow-799"><a href="#ValveTestWindow-799"><span class="linenos"> 799</span></a>        <span class="n">valves</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valve</span><span class="p">)</span> <span class="k">for</span> <span class="n">valve</span> <span class="ow">in</span> <span class="n">schedule</span><span class="p">)</span>
</span><span id="ValveTestWindow-800"><a href="#ValveTestWindow-800"><span class="linenos"> 800</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="ValveTestWindow-801"><a href="#ValveTestWindow-801"><span class="linenos"> 801</span></a>            <span class="c1">####### ARDUINO HALTS HERE UNTIL THE GO-AHEAD IS GIVEN #######</span>
</span><span id="ValveTestWindow-802"><a href="#ValveTestWindow-802"><span class="linenos"> 802</span></a>            <span class="c1"># inc each sched element by one so that it is 1-indexes and matches the valve labels</span>
</span><span id="ValveTestWindow-803"><a href="#ValveTestWindow-803"><span class="linenos"> 803</span></a>            <span class="n">test_confirmed</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span>
</span><span id="ValveTestWindow-804"><a href="#ValveTestWindow-804"><span class="linenos"> 804</span></a>                <span class="s2">&quot;CONFIRM THE TEST SCHEDULE&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-805"><a href="#ValveTestWindow-805"><span class="linenos"> 805</span></a>                <span class="sa">f</span><span class="s2">&quot;Valves </span><span class="si">{</span><span class="n">valves</span><span class="si">}</span><span class="s2">, will be tested. Review the test table to confirm schedule and timings. Each valve will be actuated </span><span class="si">{</span><span class="n">valve_acuations</span><span class="si">}</span><span class="s2"> times. Ok to begin?&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-806"><a href="#ValveTestWindow-806"><span class="linenos"> 806</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-807"><a href="#ValveTestWindow-807"><span class="linenos"> 807</span></a>
</span><span id="ValveTestWindow-808"><a href="#ValveTestWindow-808"><span class="linenos"> 808</span></a>            <span class="c1">### include section to manually modify timings</span>
</span><span id="ValveTestWindow-809"><a href="#ValveTestWindow-809"><span class="linenos"> 809</span></a>            <span class="k">if</span> <span class="n">test_confirmed</span><span class="p">:</span>
</span><span id="ValveTestWindow-810"><a href="#ValveTestWindow-810"><span class="linenos"> 810</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event0&gt;&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testing_complete</span><span class="p">)</span>
</span><span id="ValveTestWindow-811"><a href="#ValveTestWindow-811"><span class="linenos"> 811</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event1&gt;&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_input</span><span class="p">)</span>
</span><span id="ValveTestWindow-812"><a href="#ValveTestWindow-812"><span class="linenos"> 812</span></a>                <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_test</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="ValveTestWindow-813"><a href="#ValveTestWindow-813"><span class="linenos"> 813</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-814"><a href="#ValveTestWindow-814"><span class="linenos"> 814</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="ValveTestWindow-815"><a href="#ValveTestWindow-815"><span class="linenos"> 815</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span><span class="p">:</span>
</span><span id="ValveTestWindow-816"><a href="#ValveTestWindow-816"><span class="linenos"> 816</span></a>            <span class="n">priming_confirmed</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span>
</span><span id="ValveTestWindow-817"><a href="#ValveTestWindow-817"><span class="linenos"> 817</span></a>                <span class="s2">&quot;CONFIRM THE ACTION&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-818"><a href="#ValveTestWindow-818"><span class="linenos"> 818</span></a>                <span class="sa">f</span><span class="s2">&quot;Valves </span><span class="si">{</span><span class="n">valves</span><span class="si">}</span><span class="s2">, will be primed (opened and closed) </span><span class="si">{</span><span class="n">valve_acuations</span><span class="si">}</span><span class="s2"> times. Ok to begin?&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-819"><a href="#ValveTestWindow-819"><span class="linenos"> 819</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-820"><a href="#ValveTestWindow-820"><span class="linenos"> 820</span></a>            <span class="k">if</span> <span class="n">priming_confirmed</span><span class="p">:</span>
</span><span id="ValveTestWindow-821"><a href="#ValveTestWindow-821"><span class="linenos"> 821</span></a>                <span class="c1"># in case of prime, we send 0 to mean continue or start</span>
</span><span id="ValveTestWindow-822"><a href="#ValveTestWindow-822"><span class="linenos"> 822</span></a>                <span class="c1"># and we send a 1 at any point to abort or cancel the prime</span>
</span><span id="ValveTestWindow-823"><a href="#ValveTestWindow-823"><span class="linenos"> 823</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-824"><a href="#ValveTestWindow-824"><span class="linenos"> 824</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
</span><span id="ValveTestWindow-825"><a href="#ValveTestWindow-825"><span class="linenos"> 825</span></a>
</span><span id="ValveTestWindow-826"><a href="#ValveTestWindow-826"><span class="linenos"> 826</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-827"><a href="#ValveTestWindow-827"><span class="linenos"> 827</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow-828"><a href="#ValveTestWindow-828"><span class="linenos"> 828</span></a>                        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;STOP Priming&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-829"><a href="#ValveTestWindow-829"><span class="linenos"> 829</span></a>                        <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-830"><a href="#ValveTestWindow-830"><span class="linenos"> 830</span></a>                        <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_priming</span><span class="p">(),</span>
</span><span id="ValveTestWindow-831"><a href="#ValveTestWindow-831"><span class="linenos"> 831</span></a>                    <span class="p">)</span>
</span><span id="ValveTestWindow-832"><a href="#ValveTestWindow-832"><span class="linenos"> 832</span></a>
</span><span id="ValveTestWindow-833"><a href="#ValveTestWindow-833"><span class="linenos"> 833</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop_priming</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-834"><a href="#ValveTestWindow-834"><span class="linenos"> 834</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-835"><a href="#ValveTestWindow-835"><span class="linenos"> 835</span></a><span class="sd">        Sends the stop command to the Arduino during a priming sequence.</span>
</span><span id="ValveTestWindow-836"><a href="#ValveTestWindow-836"><span class="linenos"> 836</span></a>
</span><span id="ValveTestWindow-837"><a href="#ValveTestWindow-837"><span class="linenos"> 837</span></a><span class="sd">        Sets the `prime_running` flag to False. Updates the prime button state.</span>
</span><span id="ValveTestWindow-838"><a href="#ValveTestWindow-838"><span class="linenos"> 838</span></a><span class="sd">        Sends a byte representation of 1 (`np.int8(1).tobytes()`) to signal abort to the Arduino.</span>
</span><span id="ValveTestWindow-839"><a href="#ValveTestWindow-839"><span class="linenos"> 839</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-840"><a href="#ValveTestWindow-840"><span class="linenos"> 840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-841"><a href="#ValveTestWindow-841"><span class="linenos"> 841</span></a>
</span><span id="ValveTestWindow-842"><a href="#ValveTestWindow-842"><span class="linenos"> 842</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-843"><a href="#ValveTestWindow-843"><span class="linenos"> 843</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow-844"><a href="#ValveTestWindow-844"><span class="linenos"> 844</span></a>                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Priming&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-845"><a href="#ValveTestWindow-845"><span class="linenos"> 845</span></a>                <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-846"><a href="#ValveTestWindow-846"><span class="linenos"> 846</span></a>                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">(),</span>
</span><span id="ValveTestWindow-847"><a href="#ValveTestWindow-847"><span class="linenos"> 847</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-848"><a href="#ValveTestWindow-848"><span class="linenos"> 848</span></a>
</span><span id="ValveTestWindow-849"><a href="#ValveTestWindow-849"><span class="linenos"> 849</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-850"><a href="#ValveTestWindow-850"><span class="linenos"> 850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
</span><span id="ValveTestWindow-851"><a href="#ValveTestWindow-851"><span class="linenos"> 851</span></a>
</span><span id="ValveTestWindow-852"><a href="#ValveTestWindow-852"><span class="linenos"> 852</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">take_input</span><span class="p">(</span>
</span><span id="ValveTestWindow-853"><a href="#ValveTestWindow-853"><span class="linenos"> 853</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pair_num_override</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow-854"><a href="#ValveTestWindow-854"><span class="linenos"> 854</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-855"><a href="#ValveTestWindow-855"><span class="linenos"> 855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-856"><a href="#ValveTestWindow-856"><span class="linenos"> 856</span></a><span class="sd">        Prompts the user to enter the dispensed volume for a completed test pair.</span>
</span><span id="ValveTestWindow-857"><a href="#ValveTestWindow-857"><span class="linenos"> 857</span></a>
</span><span id="ValveTestWindow-858"><a href="#ValveTestWindow-858"><span class="linenos"> 858</span></a><span class="sd">        Determines which valve(s) were just tested based on the pair number received</span>
</span><span id="ValveTestWindow-859"><a href="#ValveTestWindow-859"><span class="linenos"> 859</span></a><span class="sd">        from the Arduino (via the event state or override). Uses `simpledialog.askfloat`</span>
</span><span id="ValveTestWindow-860"><a href="#ValveTestWindow-860"><span class="linenos"> 860</span></a><span class="sd">        to get the dispensed volume (in mL) for each valve in the pair. Stores the</span>
</span><span id="ValveTestWindow-861"><a href="#ValveTestWindow-861"><span class="linenos"> 861</span></a><span class="sd">        results in `self.ml_dispensed`.</span>
</span><span id="ValveTestWindow-862"><a href="#ValveTestWindow-862"><span class="linenos"> 862</span></a>
</span><span id="ValveTestWindow-863"><a href="#ValveTestWindow-863"><span class="linenos"> 863</span></a><span class="sd">        Sends a byte back to the Arduino to instruct if further pairs will be tested or if this is the final iteration,</span>
</span><span id="ValveTestWindow-864"><a href="#ValveTestWindow-864"><span class="linenos"> 864</span></a><span class="sd">        (1 if via event, 0 if via override/final pair).</span>
</span><span id="ValveTestWindow-865"><a href="#ValveTestWindow-865"><span class="linenos"> 865</span></a><span class="sd">        Handles potential abort if the user cancels the dialog window.</span>
</span><span id="ValveTestWindow-866"><a href="#ValveTestWindow-866"><span class="linenos"> 866</span></a>
</span><span id="ValveTestWindow-867"><a href="#ValveTestWindow-867"><span class="linenos"> 867</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-868"><a href="#ValveTestWindow-868"><span class="linenos"> 868</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-869"><a href="#ValveTestWindow-869"><span class="linenos"> 869</span></a><span class="sd">        - **event** (*tk.Event | None*): Uses custom thread-safe event (`&lt;&lt;event1&gt;&gt;`) generated by `run_test`, carrying the pair number in `event.state`</span>
</span><span id="ValveTestWindow-870"><a href="#ValveTestWindow-870"><span class="linenos"> 870</span></a><span class="sd">        attribute. This is None if called directly by `testing_complete`, which indicated procedure is now finished.</span>
</span><span id="ValveTestWindow-871"><a href="#ValveTestWindow-871"><span class="linenos"> 871</span></a><span class="sd">        - **pair_num_override** (*int | None, optional*): Allows manually specifying the pair number, used when called from `testing_complete` for the</span>
</span><span id="ValveTestWindow-872"><a href="#ValveTestWindow-872"><span class="linenos"> 872</span></a><span class="sd">        final pair. Defaults to None.</span>
</span><span id="ValveTestWindow-873"><a href="#ValveTestWindow-873"><span class="linenos"> 873</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-874"><a href="#ValveTestWindow-874"><span class="linenos"> 874</span></a>        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-875"><a href="#ValveTestWindow-875"><span class="linenos"> 875</span></a>            <span class="n">pair_number</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">state</span>
</span><span id="ValveTestWindow-876"><a href="#ValveTestWindow-876"><span class="linenos"> 876</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-877"><a href="#ValveTestWindow-877"><span class="linenos"> 877</span></a>            <span class="n">pair_number</span> <span class="o">=</span> <span class="n">pair_num_override</span>
</span><span id="ValveTestWindow-878"><a href="#ValveTestWindow-878"><span class="linenos"> 878</span></a>
</span><span id="ValveTestWindow-879"><a href="#ValveTestWindow-879"><span class="linenos"> 879</span></a>        <span class="c1"># decide how many valves were tested last. if 0 we will not arrive</span>
</span><span id="ValveTestWindow-880"><a href="#ValveTestWindow-880"><span class="linenos"> 880</span></a>        <span class="c1"># here so we need not test for this.</span>
</span><span id="ValveTestWindow-881"><a href="#ValveTestWindow-881"><span class="linenos"> 881</span></a>        <span class="k">if</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="ValveTestWindow-882"><a href="#ValveTestWindow-882"><span class="linenos"> 882</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span>
</span><span id="ValveTestWindow-883"><a href="#ValveTestWindow-883"><span class="linenos"> 883</span></a>        <span class="p">):</span>
</span><span id="ValveTestWindow-884"><a href="#ValveTestWindow-884"><span class="linenos"> 884</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow-885"><a href="#ValveTestWindow-885"><span class="linenos"> 885</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow-886"><a href="#ValveTestWindow-886"><span class="linenos"> 886</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow-887"><a href="#ValveTestWindow-887"><span class="linenos"> 887</span></a>            <span class="p">]</span>
</span><span id="ValveTestWindow-888"><a href="#ValveTestWindow-888"><span class="linenos"> 888</span></a>        <span class="k">elif</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">):</span>
</span><span id="ValveTestWindow-889"><a href="#ValveTestWindow-889"><span class="linenos"> 889</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow-890"><a href="#ValveTestWindow-890"><span class="linenos"> 890</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow-891"><a href="#ValveTestWindow-891"><span class="linenos"> 891</span></a>            <span class="p">]</span>
</span><span id="ValveTestWindow-892"><a href="#ValveTestWindow-892"><span class="linenos"> 892</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-893"><a href="#ValveTestWindow-893"><span class="linenos"> 893</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow-894"><a href="#ValveTestWindow-894"><span class="linenos"> 894</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow-895"><a href="#ValveTestWindow-895"><span class="linenos"> 895</span></a>            <span class="p">]</span>
</span><span id="ValveTestWindow-896"><a href="#ValveTestWindow-896"><span class="linenos"> 896</span></a>
</span><span id="ValveTestWindow-897"><a href="#ValveTestWindow-897"><span class="linenos"> 897</span></a>        <span class="c1"># for each test that we ran store the amount dispensed or abort</span>
</span><span id="ValveTestWindow-898"><a href="#ValveTestWindow-898"><span class="linenos"> 898</span></a>        <span class="k">for</span> <span class="n">valve</span> <span class="ow">in</span> <span class="n">valves_tested</span><span class="p">:</span>
</span><span id="ValveTestWindow-899"><a href="#ValveTestWindow-899"><span class="linenos"> 899</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">simpledialog</span><span class="o">.</span><span class="n">askfloat</span><span class="p">(</span>
</span><span id="ValveTestWindow-900"><a href="#ValveTestWindow-900"><span class="linenos"> 900</span></a>                <span class="s2">&quot;INPUT AMOUNT DISPENSED&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-901"><a href="#ValveTestWindow-901"><span class="linenos"> 901</span></a>                <span class="sa">f</span><span class="s2">&quot;Please input the amount of liquid dispensed for the test of valve </span><span class="si">{</span><span class="n">valve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-902"><a href="#ValveTestWindow-902"><span class="linenos"> 902</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-903"><a href="#ValveTestWindow-903"><span class="linenos"> 903</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-904"><a href="#ValveTestWindow-904"><span class="linenos"> 904</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="ValveTestWindow-905"><a href="#ValveTestWindow-905"><span class="linenos"> 905</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-906"><a href="#ValveTestWindow-906"><span class="linenos"> 906</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">valve</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
</span><span id="ValveTestWindow-907"><a href="#ValveTestWindow-907"><span class="linenos"> 907</span></a>        <span class="k">if</span> <span class="n">pair_num_override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-908"><a href="#ValveTestWindow-908"><span class="linenos"> 908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
</span><span id="ValveTestWindow-909"><a href="#ValveTestWindow-909"><span class="linenos"> 909</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-910"><a href="#ValveTestWindow-910"><span class="linenos"> 910</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
</span><span id="ValveTestWindow-911"><a href="#ValveTestWindow-911"><span class="linenos"> 911</span></a>
</span><span id="ValveTestWindow-912"><a href="#ValveTestWindow-912"><span class="linenos"> 912</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-913"><a href="#ValveTestWindow-913"><span class="linenos"> 913</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-914"><a href="#ValveTestWindow-914"><span class="linenos"> 914</span></a><span class="sd">        Listens for messages from the Arduino during an active test sequence (runs in a background thread).</span>
</span><span id="ValveTestWindow-915"><a href="#ValveTestWindow-915"><span class="linenos"> 915</span></a>
</span><span id="ValveTestWindow-916"><a href="#ValveTestWindow-916"><span class="linenos"> 916</span></a><span class="sd">        Sends the initial &#39;start test&#39; command byte to the Arduino. Enters a loop</span>
</span><span id="ValveTestWindow-917"><a href="#ValveTestWindow-917"><span class="linenos"> 917</span></a><span class="sd">        that continues as long as `self.test_running` is True and `self.stop_event`</span>
</span><span id="ValveTestWindow-918"><a href="#ValveTestWindow-918"><span class="linenos"> 918</span></a><span class="sd">        is not set. Checks for incoming data from the Arduino. Reads bytes indicating</span>
</span><span id="ValveTestWindow-919"><a href="#ValveTestWindow-919"><span class="linenos"> 919</span></a><span class="sd">        if more tests remain and the number of the just-completed pair. Generates</span>
</span><span id="ValveTestWindow-920"><a href="#ValveTestWindow-920"><span class="linenos"> 920</span></a><span class="sd">        custom Tkinter events (`&lt;&lt;event1&gt;&gt;` for input dispensed liquid prompt, `&lt;&lt;event0&gt;&gt;` for test completion)</span>
</span><span id="ValveTestWindow-921"><a href="#ValveTestWindow-921"><span class="linenos"> 921</span></a><span class="sd">        to communicate back to the main GUI thread safely. Updates the main button state to &#39;ABORT TESTING&#39;.</span>
</span><span id="ValveTestWindow-922"><a href="#ValveTestWindow-922"><span class="linenos"> 922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-923"><a href="#ValveTestWindow-923"><span class="linenos"> 923</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="ValveTestWindow-924"><a href="#ValveTestWindow-924"><span class="linenos"> 924</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ValveTestWindow-925"><a href="#ValveTestWindow-925"><span class="linenos"> 925</span></a>
</span><span id="ValveTestWindow-926"><a href="#ValveTestWindow-926"><span class="linenos"> 926</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-927"><a href="#ValveTestWindow-927"><span class="linenos"> 927</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;ABORT TESTING&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-928"><a href="#ValveTestWindow-928"><span class="linenos"> 928</span></a>
</span><span id="ValveTestWindow-929"><a href="#ValveTestWindow-929"><span class="linenos"> 929</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ValveTestWindow-930"><a href="#ValveTestWindow-930"><span class="linenos"> 930</span></a>        <span class="c1">###====SENDING BEGIN TEST COMMAND====###</span>
</span><span id="ValveTestWindow-931"><a href="#ValveTestWindow-931"><span class="linenos"> 931</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-932"><a href="#ValveTestWindow-932"><span class="linenos"> 932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="ValveTestWindow-933"><a href="#ValveTestWindow-933"><span class="linenos"> 933</span></a>
</span><span id="ValveTestWindow-934"><a href="#ValveTestWindow-934"><span class="linenos"> 934</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="ValveTestWindow-935"><a href="#ValveTestWindow-935"><span class="linenos"> 935</span></a>            <span class="c1"># if stop event, shut down the thread</span>
</span><span id="ValveTestWindow-936"><a href="#ValveTestWindow-936"><span class="linenos"> 936</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="ValveTestWindow-937"><a href="#ValveTestWindow-937"><span class="linenos"> 937</span></a>                <span class="k">break</span>
</span><span id="ValveTestWindow-938"><a href="#ValveTestWindow-938"><span class="linenos"> 938</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ValveTestWindow-939"><a href="#ValveTestWindow-939"><span class="linenos"> 939</span></a>                <span class="n">remaining_tests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ValveTestWindow-940"><a href="#ValveTestWindow-940"><span class="linenos"> 940</span></a>                <span class="n">pair_number</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
</span><span id="ValveTestWindow-941"><a href="#ValveTestWindow-941"><span class="linenos"> 941</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
</span><span id="ValveTestWindow-942"><a href="#ValveTestWindow-942"><span class="linenos"> 942</span></a>                    <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow-943"><a href="#ValveTestWindow-943"><span class="linenos"> 943</span></a>                    <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ValveTestWindow-944"><a href="#ValveTestWindow-944"><span class="linenos"> 944</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow-945"><a href="#ValveTestWindow-945"><span class="linenos"> 945</span></a>
</span><span id="ValveTestWindow-946"><a href="#ValveTestWindow-946"><span class="linenos"> 946</span></a>                <span class="k">if</span> <span class="n">remaining_tests</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">():</span>
</span><span id="ValveTestWindow-947"><a href="#ValveTestWindow-947"><span class="linenos"> 947</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event1&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">pair_number</span><span class="p">)</span>
</span><span id="ValveTestWindow-948"><a href="#ValveTestWindow-948"><span class="linenos"> 948</span></a>                <span class="k">if</span> <span class="n">remaining_tests</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">():</span>
</span><span id="ValveTestWindow-949"><a href="#ValveTestWindow-949"><span class="linenos"> 949</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event0&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">pair_number</span><span class="p">)</span>
</span><span id="ValveTestWindow-950"><a href="#ValveTestWindow-950"><span class="linenos"> 950</span></a>
</span><span id="ValveTestWindow-951"><a href="#ValveTestWindow-951"><span class="linenos"> 951</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">abort_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-952"><a href="#ValveTestWindow-952"><span class="linenos"> 952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-953"><a href="#ValveTestWindow-953"><span class="linenos"> 953</span></a><span class="sd">        Aborts an ongoing test sequence.</span>
</span><span id="ValveTestWindow-954"><a href="#ValveTestWindow-954"><span class="linenos"> 954</span></a>
</span><span id="ValveTestWindow-955"><a href="#ValveTestWindow-955"><span class="linenos"> 955</span></a><span class="sd">        Sets the `self.stop_event` to signal the `run_test` listener thread to exit.</span>
</span><span id="ValveTestWindow-956"><a href="#ValveTestWindow-956"><span class="linenos"> 956</span></a><span class="sd">        Sets `self.test_running` to False. Sends the abort *testing* command byte</span>
</span><span id="ValveTestWindow-957"><a href="#ValveTestWindow-957"><span class="linenos"> 957</span></a><span class="sd">        (`np.int8(0).tobytes()`) to the Arduino. Resets the main button state to &#39;Start Testing&#39;.</span>
</span><span id="ValveTestWindow-958"><a href="#ValveTestWindow-958"><span class="linenos"> 958</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-959"><a href="#ValveTestWindow-959"><span class="linenos"> 959</span></a>        <span class="c1"># if test is aborted, stop the test listener thread</span>
</span><span id="ValveTestWindow-960"><a href="#ValveTestWindow-960"><span class="linenos"> 960</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-961"><a href="#ValveTestWindow-961"><span class="linenos"> 961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-962"><a href="#ValveTestWindow-962"><span class="linenos"> 962</span></a>
</span><span id="ValveTestWindow-963"><a href="#ValveTestWindow-963"><span class="linenos"> 963</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="ValveTestWindow-964"><a href="#ValveTestWindow-964"><span class="linenos"> 964</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-965"><a href="#ValveTestWindow-965"><span class="linenos"> 965</span></a>        <span class="c1">###====SENDING ABORT TEST COMMAND====###</span>
</span><span id="ValveTestWindow-966"><a href="#ValveTestWindow-966"><span class="linenos"> 966</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow-967"><a href="#ValveTestWindow-967"><span class="linenos"> 967</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="ValveTestWindow-968"><a href="#ValveTestWindow-968"><span class="linenos"> 968</span></a>
</span><span id="ValveTestWindow-969"><a href="#ValveTestWindow-969"><span class="linenos"> 969</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">testing_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow-970"><a href="#ValveTestWindow-970"><span class="linenos"> 970</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-971"><a href="#ValveTestWindow-971"><span class="linenos"> 971</span></a><span class="sd">        Handles the final steps after the Arduino signals test completion.</span>
</span><span id="ValveTestWindow-972"><a href="#ValveTestWindow-972"><span class="linenos"> 972</span></a>
</span><span id="ValveTestWindow-973"><a href="#ValveTestWindow-973"><span class="linenos"> 973</span></a><span class="sd">        Calls `take_input` one last time for the final test pair (using `pair_num_override`).</span>
</span><span id="ValveTestWindow-974"><a href="#ValveTestWindow-974"><span class="linenos"> 974</span></a>
</span><span id="ValveTestWindow-975"><a href="#ValveTestWindow-975"><span class="linenos"> 975</span></a><span class="sd">        Resets the main button state and `self.test_running` flag. Sets the</span>
</span><span id="ValveTestWindow-976"><a href="#ValveTestWindow-976"><span class="linenos"> 976</span></a><span class="sd">        `self.stop_event` to ensure the listener thread terminates cleanly.</span>
</span><span id="ValveTestWindow-977"><a href="#ValveTestWindow-977"><span class="linenos"> 977</span></a><span class="sd">        Calls `auto_update_durations` to process the collected data and suggest timing changes.</span>
</span><span id="ValveTestWindow-978"><a href="#ValveTestWindow-978"><span class="linenos"> 978</span></a>
</span><span id="ValveTestWindow-979"><a href="#ValveTestWindow-979"><span class="linenos"> 979</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-980"><a href="#ValveTestWindow-980"><span class="linenos"> 980</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-981"><a href="#ValveTestWindow-981"><span class="linenos"> 981</span></a><span class="sd">        - **event** (*tk.Event*): The custom event (`&lt;&lt;event0&gt;&gt;`) generated by `run_test`, carrying the final pair number in `event.state`.</span>
</span><span id="ValveTestWindow-982"><a href="#ValveTestWindow-982"><span class="linenos"> 982</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-983"><a href="#ValveTestWindow-983"><span class="linenos"> 983</span></a>        <span class="c1"># take input from last pair/valve</span>
</span><span id="ValveTestWindow-984"><a href="#ValveTestWindow-984"><span class="linenos"> 984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">take_input</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair_num_override</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="ValveTestWindow-985"><a href="#ValveTestWindow-985"><span class="linenos"> 985</span></a>        <span class="c1"># reconfigure the testing button and testing state</span>
</span><span id="ValveTestWindow-986"><a href="#ValveTestWindow-986"><span class="linenos"> 986</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow-987"><a href="#ValveTestWindow-987"><span class="linenos"> 987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-988"><a href="#ValveTestWindow-988"><span class="linenos"> 988</span></a>
</span><span id="ValveTestWindow-989"><a href="#ValveTestWindow-989"><span class="linenos"> 989</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow-990"><a href="#ValveTestWindow-990"><span class="linenos"> 990</span></a>        <span class="c1"># stop the arduino testing listener thread</span>
</span><span id="ValveTestWindow-991"><a href="#ValveTestWindow-991"><span class="linenos"> 991</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="ValveTestWindow-992"><a href="#ValveTestWindow-992"><span class="linenos"> 992</span></a>
</span><span id="ValveTestWindow-993"><a href="#ValveTestWindow-993"><span class="linenos"> 993</span></a>        <span class="c1"># update valves and such</span>
</span><span id="ValveTestWindow-994"><a href="#ValveTestWindow-994"><span class="linenos"> 994</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_update_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow-995"><a href="#ValveTestWindow-995"><span class="linenos"> 995</span></a>
</span><span id="ValveTestWindow-996"><a href="#ValveTestWindow-996"><span class="linenos"> 996</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">auto_update_durations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ValveTestWindow-997"><a href="#ValveTestWindow-997"><span class="linenos"> 997</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-998"><a href="#ValveTestWindow-998"><span class="linenos"> 998</span></a><span class="sd">        This function is similar to the `views.valve_testing.manual_time_adjustment_window.ManualTimeAdjustment.write_timing_changes` function, it</span>
</span><span id="ValveTestWindow-999"><a href="#ValveTestWindow-999"><span class="linenos"> 999</span></a><span class="sd">        calculates new valve durations based on test results and desired volume.</span>
</span><span id="ValveTestWindow-1000"><a href="#ValveTestWindow-1000"><span class="linenos">1000</span></a>
</span><span id="ValveTestWindow-1001"><a href="#ValveTestWindow-1001"><span class="linenos">1001</span></a><span class="sd">        Loads the current &#39;selected&#39; durations. Iterates through the collected</span>
</span><span id="ValveTestWindow-1002"><a href="#ValveTestWindow-1002"><span class="linenos">1002</span></a><span class="sd">        `self.ml_dispensed` data. For each tested valve, it calculates the actual</span>
</span><span id="ValveTestWindow-1003"><a href="#ValveTestWindow-1003"><span class="linenos">1003</span></a><span class="sd">        volume dispensed per actuation and compares it to the desired volume per actuation.</span>
</span><span id="ValveTestWindow-1004"><a href="#ValveTestWindow-1004"><span class="linenos">1004</span></a><span class="sd">        It computes a new duration using a ratio (`new_duration = old_duration * (desired_vol / actual_vol)`).</span>
</span><span id="ValveTestWindow-1005"><a href="#ValveTestWindow-1005"><span class="linenos">1005</span></a>
</span><span id="ValveTestWindow-1006"><a href="#ValveTestWindow-1006"><span class="linenos">1006</span></a><span class="sd">        Updates the corresponding duration in the local copies of the side_one/side_two arrays.</span>
</span><span id="ValveTestWindow-1007"><a href="#ValveTestWindow-1007"><span class="linenos">1007</span></a><span class="sd">        Updates the table display for the valve using `update_table_entry_test_status`.</span>
</span><span id="ValveTestWindow-1008"><a href="#ValveTestWindow-1008"><span class="linenos">1008</span></a><span class="sd">        Compiles a list of changes (`changed_durations`) and opens the `ValveChanges`</span>
</span><span id="ValveTestWindow-1009"><a href="#ValveTestWindow-1009"><span class="linenos">1009</span></a><span class="sd">        confirmation window, passing the changes and the `confirm_valve_changes` callback.</span>
</span><span id="ValveTestWindow-1010"><a href="#ValveTestWindow-1010"><span class="linenos">1010</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-1011"><a href="#ValveTestWindow-1011"><span class="linenos">1011</span></a>        <span class="c1"># list of tuples of tuples ==&gt; [(valve, (old_dur, new_dur))] sent to ChangesWindow instance, so that</span>
</span><span id="ValveTestWindow-1012"><a href="#ValveTestWindow-1012"><span class="linenos">1012</span></a>        <span class="c1"># user can confirm duration changes</span>
</span><span id="ValveTestWindow-1013"><a href="#ValveTestWindow-1013"><span class="linenos">1013</span></a>        <span class="n">changed_durations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ValveTestWindow-1014"><a href="#ValveTestWindow-1014"><span class="linenos">1014</span></a>
</span><span id="ValveTestWindow-1015"><a href="#ValveTestWindow-1015"><span class="linenos">1015</span></a>        <span class="c1">## save current durations in the oldest valve duration archival location</span>
</span><span id="ValveTestWindow-1016"><a href="#ValveTestWindow-1016"><span class="linenos">1016</span></a>        <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">date_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow-1017"><a href="#ValveTestWindow-1017"><span class="linenos">1017</span></a>
</span><span id="ValveTestWindow-1018"><a href="#ValveTestWindow-1018"><span class="linenos">1018</span></a>        <span class="n">side_one_old</span> <span class="o">=</span> <span class="n">side_one</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ValveTestWindow-1019"><a href="#ValveTestWindow-1019"><span class="linenos">1019</span></a>        <span class="n">side_two_old</span> <span class="o">=</span> <span class="n">side_two</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ValveTestWindow-1020"><a href="#ValveTestWindow-1020"><span class="linenos">1020</span></a>
</span><span id="ValveTestWindow-1021"><a href="#ValveTestWindow-1021"><span class="linenos">1021</span></a>        <span class="k">for</span> <span class="n">valve</span><span class="p">,</span> <span class="n">dispensed_amt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="p">:</span>
</span><span id="ValveTestWindow-1022"><a href="#ValveTestWindow-1022"><span class="linenos">1022</span></a>            <span class="n">logical_valve</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow-1023"><a href="#ValveTestWindow-1023"><span class="linenos">1023</span></a>            <span class="n">tested_duration</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow-1024"><a href="#ValveTestWindow-1024"><span class="linenos">1024</span></a>            <span class="n">side_durations</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow-1025"><a href="#ValveTestWindow-1025"><span class="linenos">1025</span></a>
</span><span id="ValveTestWindow-1026"><a href="#ValveTestWindow-1026"><span class="linenos">1026</span></a>            <span class="k">if</span> <span class="n">valve</span> <span class="o">&gt;</span> <span class="n">VALVES_PER_SIDE</span><span class="p">:</span>
</span><span id="ValveTestWindow-1027"><a href="#ValveTestWindow-1027"><span class="linenos">1027</span></a>                <span class="n">logical_valve</span> <span class="o">=</span> <span class="p">(</span><span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">VALVES_PER_SIDE</span>
</span><span id="ValveTestWindow-1028"><a href="#ValveTestWindow-1028"><span class="linenos">1028</span></a>
</span><span id="ValveTestWindow-1029"><a href="#ValveTestWindow-1029"><span class="linenos">1029</span></a>                <span class="n">tested_duration</span> <span class="o">=</span> <span class="n">side_two</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span>
</span><span id="ValveTestWindow-1030"><a href="#ValveTestWindow-1030"><span class="linenos">1030</span></a>                <span class="n">side_durations</span> <span class="o">=</span> <span class="n">side_two</span>
</span><span id="ValveTestWindow-1031"><a href="#ValveTestWindow-1031"><span class="linenos">1031</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow-1032"><a href="#ValveTestWindow-1032"><span class="linenos">1032</span></a>                <span class="n">logical_valve</span> <span class="o">=</span> <span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ValveTestWindow-1033"><a href="#ValveTestWindow-1033"><span class="linenos">1033</span></a>
</span><span id="ValveTestWindow-1034"><a href="#ValveTestWindow-1034"><span class="linenos">1034</span></a>                <span class="n">tested_duration</span> <span class="o">=</span> <span class="n">side_one</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span>
</span><span id="ValveTestWindow-1035"><a href="#ValveTestWindow-1035"><span class="linenos">1035</span></a>                <span class="n">side_durations</span> <span class="o">=</span> <span class="n">side_one</span>
</span><span id="ValveTestWindow-1036"><a href="#ValveTestWindow-1036"><span class="linenos">1036</span></a>
</span><span id="ValveTestWindow-1037"><a href="#ValveTestWindow-1037"><span class="linenos">1037</span></a>            <span class="c1"># divide by 1000 to get to mL from ul</span>
</span><span id="ValveTestWindow-1038"><a href="#ValveTestWindow-1038"><span class="linenos">1038</span></a>            <span class="n">desired_per_open_vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="ValveTestWindow-1039"><a href="#ValveTestWindow-1039"><span class="linenos">1039</span></a>
</span><span id="ValveTestWindow-1040"><a href="#ValveTestWindow-1040"><span class="linenos">1040</span></a>            <span class="c1"># divide by 1000 to get amount per opening, NOT changing units</span>
</span><span id="ValveTestWindow-1041"><a href="#ValveTestWindow-1041"><span class="linenos">1041</span></a>            <span class="n">actual_per_open_vol</span> <span class="o">=</span> <span class="n">dispensed_amt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="ValveTestWindow-1042"><a href="#ValveTestWindow-1042"><span class="linenos">1042</span></a>
</span><span id="ValveTestWindow-1043"><a href="#ValveTestWindow-1043"><span class="linenos">1043</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_table_entry_test_status</span><span class="p">(</span><span class="n">valve</span><span class="p">,</span> <span class="n">actual_per_open_vol</span><span class="p">)</span>
</span><span id="ValveTestWindow-1044"><a href="#ValveTestWindow-1044"><span class="linenos">1044</span></a>
</span><span id="ValveTestWindow-1045"><a href="#ValveTestWindow-1045"><span class="linenos">1045</span></a>            <span class="n">new_duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="ValveTestWindow-1046"><a href="#ValveTestWindow-1046"><span class="linenos">1046</span></a>                <span class="n">tested_duration</span> <span class="o">*</span> <span class="p">(</span><span class="n">desired_per_open_vol</span> <span class="o">/</span> <span class="n">actual_per_open_vol</span><span class="p">)</span>
</span><span id="ValveTestWindow-1047"><a href="#ValveTestWindow-1047"><span class="linenos">1047</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow-1048"><a href="#ValveTestWindow-1048"><span class="linenos">1048</span></a>
</span><span id="ValveTestWindow-1049"><a href="#ValveTestWindow-1049"><span class="linenos">1049</span></a>            <span class="n">side_durations</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_duration</span>
</span><span id="ValveTestWindow-1050"><a href="#ValveTestWindow-1050"><span class="linenos">1050</span></a>
</span><span id="ValveTestWindow-1051"><a href="#ValveTestWindow-1051"><span class="linenos">1051</span></a>            <span class="n">changed_durations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">valve</span><span class="p">,</span> <span class="p">(</span><span class="n">tested_duration</span><span class="p">,</span> <span class="n">new_duration</span><span class="p">)))</span>
</span><span id="ValveTestWindow-1052"><a href="#ValveTestWindow-1052"><span class="linenos">1052</span></a>
</span><span id="ValveTestWindow-1053"><a href="#ValveTestWindow-1053"><span class="linenos">1053</span></a>        <span class="n">ValveChanges</span><span class="p">(</span>
</span><span id="ValveTestWindow-1054"><a href="#ValveTestWindow-1054"><span class="linenos">1054</span></a>            <span class="n">changed_durations</span><span class="p">,</span>
</span><span id="ValveTestWindow-1055"><a href="#ValveTestWindow-1055"><span class="linenos">1055</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_valve_changes</span><span class="p">(</span>
</span><span id="ValveTestWindow-1056"><a href="#ValveTestWindow-1056"><span class="linenos">1056</span></a>                <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">side_one_old</span><span class="p">,</span> <span class="n">side_two_old</span>
</span><span id="ValveTestWindow-1057"><a href="#ValveTestWindow-1057"><span class="linenos">1057</span></a>            <span class="p">),</span>
</span><span id="ValveTestWindow-1058"><a href="#ValveTestWindow-1058"><span class="linenos">1058</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow-1059"><a href="#ValveTestWindow-1059"><span class="linenos">1059</span></a>
</span><span id="ValveTestWindow-1060"><a href="#ValveTestWindow-1060"><span class="linenos">1060</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">confirm_valve_changes</span><span class="p">(</span>
</span><span id="ValveTestWindow-1061"><a href="#ValveTestWindow-1061"><span class="linenos">1061</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ValveTestWindow-1062"><a href="#ValveTestWindow-1062"><span class="linenos">1062</span></a>        <span class="n">side_one</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow-1063"><a href="#ValveTestWindow-1063"><span class="linenos">1063</span></a>        <span class="n">side_two</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow-1064"><a href="#ValveTestWindow-1064"><span class="linenos">1064</span></a>        <span class="n">side_one_old</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow-1065"><a href="#ValveTestWindow-1065"><span class="linenos">1065</span></a>        <span class="n">side_two_old</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow-1066"><a href="#ValveTestWindow-1066"><span class="linenos">1066</span></a>    <span class="p">):</span>
</span><span id="ValveTestWindow-1067"><a href="#ValveTestWindow-1067"><span class="linenos">1067</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-1068"><a href="#ValveTestWindow-1068"><span class="linenos">1068</span></a><span class="sd">        Callback function executed when changes are confirmed in the ValveChanges window.</span>
</span><span id="ValveTestWindow-1069"><a href="#ValveTestWindow-1069"><span class="linenos">1069</span></a>
</span><span id="ValveTestWindow-1070"><a href="#ValveTestWindow-1070"><span class="linenos">1070</span></a><span class="sd">        Instructs `self.arduino_data` to first save the `side_one_old` and `side_two_old`</span>
</span><span id="ValveTestWindow-1071"><a href="#ValveTestWindow-1071"><span class="linenos">1071</span></a><span class="sd">        arrays to an archive slot, and then save the newly calculated `side_one` and `side_two`</span>
</span><span id="ValveTestWindow-1072"><a href="#ValveTestWindow-1072"><span class="linenos">1072</span></a><span class="sd">        arrays as the &#39;selected&#39; durations.</span>
</span><span id="ValveTestWindow-1073"><a href="#ValveTestWindow-1073"><span class="linenos">1073</span></a>
</span><span id="ValveTestWindow-1074"><a href="#ValveTestWindow-1074"><span class="linenos">1074</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow-1075"><a href="#ValveTestWindow-1075"><span class="linenos">1075</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow-1076"><a href="#ValveTestWindow-1076"><span class="linenos">1076</span></a><span class="sd">        - **side_one** (*npt.NDArray[np.int32]*): The numpy array containing the newly calculated durations for side one valves.</span>
</span><span id="ValveTestWindow-1077"><a href="#ValveTestWindow-1077"><span class="linenos">1077</span></a><span class="sd">        - **side_two** (*npt.NDArray[np.int32]*): The numpy array containing the newly calculated durations for side two valves.</span>
</span><span id="ValveTestWindow-1078"><a href="#ValveTestWindow-1078"><span class="linenos">1078</span></a><span class="sd">        - **side_one_old** (*npt.NDArray[np.int32]*): The numpy array containing the durations for side one valves *before* the test.</span>
</span><span id="ValveTestWindow-1079"><a href="#ValveTestWindow-1079"><span class="linenos">1079</span></a><span class="sd">        - **side_two_old** (*npt.NDArray[np.int32]*): The numpy array containing the durations for side two valves *before* the test.</span>
</span><span id="ValveTestWindow-1080"><a href="#ValveTestWindow-1080"><span class="linenos">1080</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow-1081"><a href="#ValveTestWindow-1081"><span class="linenos">1081</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">save_durations</span><span class="p">(</span><span class="n">side_one_old</span><span class="p">,</span> <span class="n">side_two_old</span><span class="p">,</span> <span class="s2">&quot;archive&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow-1082"><a href="#ValveTestWindow-1082"><span class="linenos">1082</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">save_durations</span><span class="p">(</span><span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="s2">&quot;selected&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p><em>This is a bit of a god class and should likely be refactored... but for now... it works!</em></p>

<p>Implements the main Tkinter Toplevel window for valve testing and priming operations.</p>

<p>This window provides an interface to interact with the Arduino
controller for calibrating valve open times based on dispensed volume or
for running priming sequences. It features modes for testing and
priming, manages valve selections, displays test progress and results,
and handles communication with the Arduino.</p>

<h2 id="attributes">Attributes</h2>

<ul>
<li><strong><code><a href="#ValveTestWindow.arduino_controller">arduino_controller</a></code></strong> (<em>ArduinoManager</em>): Reference to the main Arduino controller instance, used for sending commands and data.</li>
<li><strong><code><a href="#ValveTestWindow.arduino_data">arduino_data</a></code></strong> (<em>ArduinoData</em>): Reference to the data model holding valve duration configurations.</li>
<li><strong><code><a href="#ValveTestWindow.window_mode">window_mode</a></code></strong> (<em>WindowMode</em>): Enum indicating the current operational mode (Testing or Priming).</li>
<li><strong><code><a href="#ValveTestWindow.test_running">test_running</a></code></strong> (<em>bool</em>): Flag indicating if an automated test sequence is currently active.</li>
<li><strong><code><a href="#ValveTestWindow.prime_running">prime_running</a></code></strong> (<em>bool</em>): Flag indicating if a priming sequence is currently active.</li>
<li><strong><code><a href="#ValveTestWindow.desired_volume">desired_volume</a></code></strong> (<em>tk.DoubleVar</em>): Tkinter variable storing the target volume (in microliters) per actuation for automatic duration calculation.</li>
<li><strong><code><a href="#ValveTestWindow.actuations">actuations</a></code></strong> (<em>tk.IntVar</em>): Tkinter variable storing the number of times each valve should be actuated during a test or prime sequence.</li>
<li><strong><code><a href="#ValveTestWindow.ml_dispensed">ml_dispensed</a></code></strong> (<em>list[tuple[int, float]]</em>): Stores tuples of (valve_number, dispensed_volume_ml) entered by the user during a test.</li>
<li><strong><code><a href="#ValveTestWindow.valve_buttons">valve_buttons</a></code></strong> (<em>list[tk.Button | None]</em>): List holding the Tkinter Button widgets for each valve selection.</li>
<li><strong><code><a href="#ValveTestWindow.valve_test_button">valve_test_button</a></code></strong> (<em>tk.Button | None</em>): The main button used to start/abort tests or start/stop priming.</li>
<li><strong><code><a href="#ValveTestWindow.table_entries">table_entries</a></code></strong> (<em>list[str | None]</em>): List holding the item IDs for each row in the ttk.Treeview table, used for modifying/hiding/showing specific rows.</li>
<li><strong><code><a href="#ValveTestWindow.valve_selections">valve_selections</a></code></strong> (<em>npt.NDArray[np.int8]</em>): Numpy array representing the selection state of each valve (0 if not selected, valve_number if selected).</li>
<li><strong><code><a href="#ValveTestWindow.side_one_tests">side_one_tests</a></code></strong> (<em>npt.NDArray[np.int8] | None</em>): Numpy array holding the valve numbers (0-indexed) selected for testing/priming on side one.</li>
<li><strong><code><a href="#ValveTestWindow.side_two_tests">side_two_tests</a></code></strong> (<em>npt.NDArray[np.int8] | None</em>): Numpy array holding the valve numbers (0-indexed) selected for testing/priming on side two.</li>
<li><strong><code><a href="#ValveTestWindow.stop_event">stop_event</a></code></strong> (<em>threading.Event</em>): Event flag used to signal the Arduino listener thread (<code><a href="#ValveTestWindow.run_test">run_test</a></code>) to stop.</li>
<li><strong><code>mode_button</code></strong> (<em>tk.Button</em>): Button to switch between Testing and Priming modes.</li>
<li><strong><code>dispensed_vol_frame</code></strong> (<em>tk.Frame</em>): Container frame for the desired volume input elements (visible in Testing mode).</li>
<li><strong><code>valve_table_frame</code></strong> (<em>tk.Frame</em>): Container frame for the valve test results table (visible in Testing mode).</li>
<li><strong><code>valve_table</code></strong> (<em>ttk.Treeview</em>): The table widget displaying valve numbers, test status, and timings.</li>
<li><strong><code>valve_buttons_frame</code></strong> (<em>tk.Frame</em>): Main container frame for the side-by-side valve selection buttons.</li>
<li><strong><code>side_one_valves_frame</code></strong> (<em>tk.Frame</em>): Frame holding valve selection buttons for the first side.</li>
<li><strong><code>side_two_valves_frame</code></strong> (<em>tk.Frame</em>): Frame holding valve selection buttons for the second side.</li>
<li><strong><code><a href="#ValveTestWindow.manual_adjust_window">manual_adjust_window</a></code></strong> (<em>ManualTimeAdjustment</em>): Instance of the separate window for manual timing adjustments.</li>
</ul>

<h2 id="methods">Methods</h2>

<ul>
<li><code><a href="#ValveTestWindow.setup_basic_window_attr">setup_basic_window_attr</a></code>()
Configures basic window properties like title, key bindings, and icon.</li>
<li><code><a href="#ValveTestWindow.show">show</a></code>()
Makes the window visible (deiconifies).</li>
<li><code><a href="#ValveTestWindow.switch_window_mode">switch_window_mode</a></code>()
Toggles the window between Testing and Priming modes, adjusting UI elements accordingly.</li>
<li><code><a href="#ValveTestWindow.create_interface">create_interface</a></code>()
Builds the entire GUI layout, placing widgets and frames.</li>
<li><code><a href="#ValveTestWindow.start_testing_toggle">start_testing_toggle</a></code>()
Handles the press of the main test/prime button in Testing mode (starts or aborts test).</li>
<li><code><a href="#ValveTestWindow.create_buttons">create_buttons</a></code>()
Creates and places the valve selection buttons and the main start/abort button.</li>
<li><code><a href="#ValveTestWindow.create_valve_test_table">create_valve_test_table</a></code>()
Creates the ttk.Treeview table for displaying valve test results and timings.</li>
<li><code><a href="#ValveTestWindow.update_table_entry_test_status">update_table_entry_test_status</a></code>(...)
Updates the 'Amount Dispensed' column for a specific valve in the table.</li>
<li><code><a href="#ValveTestWindow.update_table_entries">update_table_entries</a></code>(...)
Updates the entire valve table, showing/hiding rows based on selections and refreshing currently loaded durations.</li>
<li><code><a href="#ValveTestWindow.toggle_valve_button">toggle_valve_button</a></code>(...)
Handles clicks on valve selection buttons, updating their appearance and the <code><a href="#ValveTestWindow.valve_selections">valve_selections</a></code> array.</li>
<li><code><a href="#ValveTestWindow.verify_variables">verify_variables</a></code>(...)
Reads verification data back from Arduino to confirm test parameters were received correctly.</li>
<li><code><a href="#ValveTestWindow.verify_schedule">verify_schedule</a></code>(...)
Reads verification data back from Arduino to confirm the valve test/prime schedule was received correctly.</li>
<li><code><a href="#ValveTestWindow.send_schedules">send_schedules</a></code>()
Sends the command, parameters (schedule lengths, actuations), and valve schedule to the Arduino. Handles mode-specific commands and confirmations.</li>
<li><code><a href="#ValveTestWindow.stop_priming">stop_priming</a></code>()
Sends a command to the Arduino to stop an ongoing priming sequence.</li>
<li><code><a href="#ValveTestWindow.take_input">take_input</a></code>(...)
Prompts the user (via simpledialog) to enter the dispensed volume for a completed valve test pair. Sends confirmation back to Arduino.</li>
<li><code><a href="#ValveTestWindow.run_test">run_test</a></code>()
Runs in a separate thread to listen for messages from the Arduino during a test, triggering events for input prompts or completion.</li>
<li><code><a href="#ValveTestWindow.abort_test">abort_test</a></code>()
Sends a command to the Arduino to abort the current test and stops the listener thread.</li>
<li><code><a href="#ValveTestWindow.testing_complete">testing_complete</a></code>(...)
Handles the event triggered when the Arduino signals the end of the entire test sequence. Initiates duration updates.</li>
<li><code><a href="#ValveTestWindow.auto_update_durations">auto_update_durations</a></code>()
Calculates new valve durations based on test results (<code><a href="#ValveTestWindow.ml_dispensed">ml_dispensed</a></code>) and opens the <code>ValveChanges</code> confirmation window.</li>
<li><code><a href="#ValveTestWindow.confirm_valve_changes">confirm_valve_changes</a></code>(...)
Callback function executed if the user confirms changes in the <code>ValveChanges</code> window. Saves new durations and archives old ones via <code>ArduinoData</code>.</li>
</ul>
</div>


                            <div id="ValveTestWindow.__init__" class="classattr">
                                        <input id="ValveTestWindow.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ValveTestWindow</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">arduino_controller</span><span class="p">:</span> <span class="n">controllers</span><span class="o">.</span><span class="n">arduino_control</span><span class="o">.</span><span class="n">ArduinoManager</span></span>)</span>

                <label class="view-source-button" for="ValveTestWindow.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.__init__-153"><a href="#ValveTestWindow.__init__-153"><span class="linenos">153</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arduino_controller</span><span class="p">:</span> <span class="n">ArduinoManager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.__init__-154"><a href="#ValveTestWindow.__init__-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.__init__-155"><a href="#ValveTestWindow.__init__-155"><span class="linenos">155</span></a><span class="sd">        Initializes the ValveTestWindow.</span>
</span><span id="ValveTestWindow.__init__-156"><a href="#ValveTestWindow.__init__-156"><span class="linenos">156</span></a>
</span><span id="ValveTestWindow.__init__-157"><a href="#ValveTestWindow.__init__-157"><span class="linenos">157</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.__init__-158"><a href="#ValveTestWindow.__init__-158"><span class="linenos">158</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.__init__-159"><a href="#ValveTestWindow.__init__-159"><span class="linenos">159</span></a><span class="sd">        - **arduino_controller** (*ArduinoManager*): The application&#39;s instance of the Arduino controller.</span>
</span><span id="ValveTestWindow.__init__-160"><a href="#ValveTestWindow.__init__-160"><span class="linenos">160</span></a>
</span><span id="ValveTestWindow.__init__-161"><a href="#ValveTestWindow.__init__-161"><span class="linenos">161</span></a><span class="sd">        Raises</span>
</span><span id="ValveTestWindow.__init__-162"><a href="#ValveTestWindow.__init__-162"><span class="linenos">162</span></a><span class="sd">        ------</span>
</span><span id="ValveTestWindow.__init__-163"><a href="#ValveTestWindow.__init__-163"><span class="linenos">163</span></a><span class="sd">        - Propagates exceptions from `GUIUtils` methods during icon setting.</span>
</span><span id="ValveTestWindow.__init__-164"><a href="#ValveTestWindow.__init__-164"><span class="linenos">164</span></a><span class="sd">        - Propagates exceptions from `arduino_data.load_durations()`.</span>
</span><span id="ValveTestWindow.__init__-165"><a href="#ValveTestWindow.__init__-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.__init__-166"><a href="#ValveTestWindow.__init__-166"><span class="linenos">166</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="ValveTestWindow.__init__-167"><a href="#ValveTestWindow.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="p">:</span> <span class="n">ArduinoManager</span> <span class="o">=</span> <span class="n">arduino_controller</span>
</span><span id="ValveTestWindow.__init__-168"><a href="#ValveTestWindow.__init__-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="p">:</span> <span class="n">ArduinoData</span> <span class="o">=</span> <span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="ValveTestWindow.__init__-169"><a href="#ValveTestWindow.__init__-169"><span class="linenos">169</span></a>
</span><span id="ValveTestWindow.__init__-170"><a href="#ValveTestWindow.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">setup_basic_window_attr</span><span class="p">()</span>
</span><span id="ValveTestWindow.__init__-171"><a href="#ValveTestWindow.__init__-171"><span class="linenos">171</span></a>
</span><span id="ValveTestWindow.__init__-172"><a href="#ValveTestWindow.__init__-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span><span class="p">:</span> <span class="n">WindowMode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span>
</span><span id="ValveTestWindow.__init__-173"><a href="#ValveTestWindow.__init__-173"><span class="linenos">173</span></a>
</span><span id="ValveTestWindow.__init__-174"><a href="#ValveTestWindow.__init__-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow.__init__-175"><a href="#ValveTestWindow.__init__-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow.__init__-176"><a href="#ValveTestWindow.__init__-176"><span class="linenos">176</span></a>
</span><span id="ValveTestWindow.__init__-177"><a href="#ValveTestWindow.__init__-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">DoubleVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="ValveTestWindow.__init__-178"><a href="#ValveTestWindow.__init__-178"><span class="linenos">178</span></a>
</span><span id="ValveTestWindow.__init__-179"><a href="#ValveTestWindow.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ValveTestWindow.__init__-180"><a href="#ValveTestWindow.__init__-180"><span class="linenos">180</span></a>
</span><span id="ValveTestWindow.__init__-181"><a href="#ValveTestWindow.__init__-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ValveTestWindow.__init__-182"><a href="#ValveTestWindow.__init__-182"><span class="linenos">182</span></a>
</span><span id="ValveTestWindow.__init__-183"><a href="#ValveTestWindow.__init__-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">Button</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">TOTAL_VALVES</span>
</span><span id="ValveTestWindow.__init__-184"><a href="#ValveTestWindow.__init__-184"><span class="linenos">184</span></a>
</span><span id="ValveTestWindow.__init__-185"><a href="#ValveTestWindow.__init__-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow.__init__-186"><a href="#ValveTestWindow.__init__-186"><span class="linenos">186</span></a>
</span><span id="ValveTestWindow.__init__-187"><a href="#ValveTestWindow.__init__-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">TOTAL_VALVES</span>
</span><span id="ValveTestWindow.__init__-188"><a href="#ValveTestWindow.__init__-188"><span class="linenos">188</span></a>
</span><span id="ValveTestWindow.__init__-189"><a href="#ValveTestWindow.__init__-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="ValveTestWindow.__init__-190"><a href="#ValveTestWindow.__init__-190"><span class="linenos">190</span></a>            <span class="p">(</span><span class="n">TOTAL_VALVES</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span>
</span><span id="ValveTestWindow.__init__-191"><a href="#ValveTestWindow.__init__-191"><span class="linenos">191</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.__init__-192"><a href="#ValveTestWindow.__init__-192"><span class="linenos">192</span></a>
</span><span id="ValveTestWindow.__init__-193"><a href="#ValveTestWindow.__init__-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow.__init__-194"><a href="#ValveTestWindow.__init__-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow.__init__-195"><a href="#ValveTestWindow.__init__-195"><span class="linenos">195</span></a>
</span><span id="ValveTestWindow.__init__-196"><a href="#ValveTestWindow.__init__-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="ValveTestWindow.__init__-197"><a href="#ValveTestWindow.__init__-197"><span class="linenos">197</span></a>
</span><span id="ValveTestWindow.__init__-198"><a href="#ValveTestWindow.__init__-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_interface</span><span class="p">()</span>
</span><span id="ValveTestWindow.__init__-199"><a href="#ValveTestWindow.__init__-199"><span class="linenos">199</span></a>
</span><span id="ValveTestWindow.__init__-200"><a href="#ValveTestWindow.__init__-200"><span class="linenos">200</span></a>        <span class="c1"># hide main window for now until we deliberately enter this window.</span>
</span><span id="ValveTestWindow.__init__-201"><a href="#ValveTestWindow.__init__-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
</span><span id="ValveTestWindow.__init__-202"><a href="#ValveTestWindow.__init__-202"><span class="linenos">202</span></a>
</span><span id="ValveTestWindow.__init__-203"><a href="#ValveTestWindow.__init__-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span> <span class="o">=</span> <span class="n">ManualTimeAdjustment</span><span class="p">(</span>
</span><span id="ValveTestWindow.__init__-204"><a href="#ValveTestWindow.__init__-204"><span class="linenos">204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="ValveTestWindow.__init__-205"><a href="#ValveTestWindow.__init__-205"><span class="linenos">205</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.__init__-206"><a href="#ValveTestWindow.__init__-206"><span class="linenos">206</span></a>        <span class="c1"># hide the adjustment window until we need it.</span>
</span><span id="ValveTestWindow.__init__-207"><a href="#ValveTestWindow.__init__-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
</span><span id="ValveTestWindow.__init__-208"><a href="#ValveTestWindow.__init__-208"><span class="linenos">208</span></a>
</span><span id="ValveTestWindow.__init__-209"><a href="#ValveTestWindow.__init__-209"><span class="linenos">209</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Valve Test Window initialized.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the ValveTestWindow.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>arduino_controller</strong> (<em>ArduinoManager</em>): The application's instance of the Arduino controller.</li>
</ul>

<h2 id="raises">Raises</h2>

<ul>
<li>Propagates exceptions from <code>GUIUtils</code> methods during icon setting.</li>
<li>Propagates exceptions from <code>arduino_data.load_durations()</code>.</li>
</ul>
</div>


                            </div>
                            <div id="ValveTestWindow.arduino_controller" class="classattr">
                                <div class="attr variable">
            <span class="name">arduino_controller</span><span class="annotation">: controllers.arduino_control.ArduinoManager</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.arduino_controller"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.arduino_data" class="classattr">
                                <div class="attr variable">
            <span class="name">arduino_data</span><span class="annotation">: models.arduino_data.ArduinoData</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.arduino_data"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.window_mode" class="classattr">
                                <div class="attr variable">
            <span class="name">window_mode</span><span class="annotation">: <a href="#WindowMode">WindowMode</a></span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.window_mode"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.test_running" class="classattr">
                                <div class="attr variable">
            <span class="name">test_running</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.test_running"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.prime_running" class="classattr">
                                <div class="attr variable">
            <span class="name">prime_running</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.prime_running"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.desired_volume" class="classattr">
                                <div class="attr variable">
            <span class="name">desired_volume</span><span class="annotation">: tkinter.DoubleVar</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.desired_volume"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.actuations" class="classattr">
                                <div class="attr variable">
            <span class="name">actuations</span><span class="annotation">: tkinter.IntVar</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.actuations"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.ml_dispensed" class="classattr">
                                <div class="attr variable">
            <span class="name">ml_dispensed</span><span class="annotation">: list[tuple[int, float]]</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.ml_dispensed"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.valve_buttons" class="classattr">
                                <div class="attr variable">
            <span class="name">valve_buttons</span><span class="annotation">: list[tkinter.Button | None]</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.valve_buttons"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.valve_test_button" class="classattr">
                                <div class="attr variable">
            <span class="name">valve_test_button</span><span class="annotation">: tkinter.Button | None</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.valve_test_button"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.table_entries" class="classattr">
                                <div class="attr variable">
            <span class="name">table_entries</span><span class="annotation">: list[str | None]</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.table_entries"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.valve_selections" class="classattr">
                                <div class="attr variable">
            <span class="name">valve_selections</span><span class="annotation">: numpy.ndarray[tuple[int, ...], numpy.dtype[numpy.int8]]</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.valve_selections"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.side_one_tests" class="classattr">
                                <div class="attr variable">
            <span class="name">side_one_tests</span><span class="annotation">: None | numpy.ndarray[tuple[int, ...], numpy.dtype[numpy.int8]]</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.side_one_tests"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.side_two_tests" class="classattr">
                                <div class="attr variable">
            <span class="name">side_two_tests</span><span class="annotation">: None | numpy.ndarray[tuple[int, ...], numpy.dtype[numpy.int8]]</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.side_two_tests"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.stop_event" class="classattr">
                                <div class="attr variable">
            <span class="name">stop_event</span><span class="annotation">: threading.Event</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.stop_event"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.manual_adjust_window" class="classattr">
                                <div class="attr variable">
            <span class="name">manual_adjust_window</span>

        
    </div>
    <a class="headerlink" href="#ValveTestWindow.manual_adjust_window"></a>
    
    

                            </div>
                            <div id="ValveTestWindow.setup_basic_window_attr" class="classattr">
                                        <input id="ValveTestWindow.setup_basic_window_attr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_basic_window_attr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.setup_basic_window_attr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.setup_basic_window_attr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.setup_basic_window_attr-211"><a href="#ValveTestWindow.setup_basic_window_attr-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_basic_window_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-212"><a href="#ValveTestWindow.setup_basic_window_attr-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-213"><a href="#ValveTestWindow.setup_basic_window_attr-213"><span class="linenos">213</span></a><span class="sd">        Sets up fundamental window properties.</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-214"><a href="#ValveTestWindow.setup_basic_window_attr-214"><span class="linenos">214</span></a>
</span><span id="ValveTestWindow.setup_basic_window_attr-215"><a href="#ValveTestWindow.setup_basic_window_attr-215"><span class="linenos">215</span></a><span class="sd">        Configures the window title, binds Ctrl+W and the close button (&#39;X&#39;)</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-216"><a href="#ValveTestWindow.setup_basic_window_attr-216"><span class="linenos">216</span></a><span class="sd">        to hide the window, sets grid column/row weights for resizing behavior,</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-217"><a href="#ValveTestWindow.setup_basic_window_attr-217"><span class="linenos">217</span></a><span class="sd">        and applies the application icon using `GUIUtils`.</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-218"><a href="#ValveTestWindow.setup_basic_window_attr-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-219"><a href="#ValveTestWindow.setup_basic_window_attr-219"><span class="linenos">219</span></a>
</span><span id="ValveTestWindow.setup_basic_window_attr-220"><a href="#ValveTestWindow.setup_basic_window_attr-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Testing&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-221"><a href="#ValveTestWindow.setup_basic_window_attr-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Control-w&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">())</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-222"><a href="#ValveTestWindow.setup_basic_window_attr-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span><span class="s2">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">withdraw</span><span class="p">())</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-223"><a href="#ValveTestWindow.setup_basic_window_attr-223"><span class="linenos">223</span></a>
</span><span id="ValveTestWindow.setup_basic_window_attr-224"><a href="#ValveTestWindow.setup_basic_window_attr-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-225"><a href="#ValveTestWindow.setup_basic_window_attr-225"><span class="linenos">225</span></a>
</span><span id="ValveTestWindow.setup_basic_window_attr-226"><a href="#ValveTestWindow.setup_basic_window_attr-226"><span class="linenos">226</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-227"><a href="#ValveTestWindow.setup_basic_window_attr-227"><span class="linenos">227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-228"><a href="#ValveTestWindow.setup_basic_window_attr-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-229"><a href="#ValveTestWindow.setup_basic_window_attr-229"><span class="linenos">229</span></a>
</span><span id="ValveTestWindow.setup_basic_window_attr-230"><a href="#ValveTestWindow.setup_basic_window_attr-230"><span class="linenos">230</span></a>        <span class="n">window_icon_path</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">get_window_icon_path</span><span class="p">()</span>
</span><span id="ValveTestWindow.setup_basic_window_attr-231"><a href="#ValveTestWindow.setup_basic_window_attr-231"><span class="linenos">231</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">set_program_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon_path</span><span class="o">=</span><span class="n">window_icon_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets up fundamental window properties.</p>

<p>Configures the window title, binds Ctrl+W and the close button ('X')
to hide the window, sets grid column/row weights for resizing behavior,
and applies the application icon using <code>GUIUtils</code>.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.show" class="classattr">
                                        <input id="ValveTestWindow.show-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.show-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.show"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.show-233"><a href="#ValveTestWindow.show-233"><span class="linenos">233</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.show-234"><a href="#ValveTestWindow.show-234"><span class="linenos">234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.show-235"><a href="#ValveTestWindow.show-235"><span class="linenos">235</span></a><span class="sd">        Makes the ValveTestWindow visible.</span>
</span><span id="ValveTestWindow.show-236"><a href="#ValveTestWindow.show-236"><span class="linenos">236</span></a>
</span><span id="ValveTestWindow.show-237"><a href="#ValveTestWindow.show-237"><span class="linenos">237</span></a><span class="sd">        Calls `deiconify()` to show the window if it was previously hidden (withdrawn).</span>
</span><span id="ValveTestWindow.show-238"><a href="#ValveTestWindow.show-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.show-239"><a href="#ValveTestWindow.show-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Makes the ValveTestWindow visible.</p>

<p>Calls <code><a href="#ValveTestWindow.deiconify">deiconify()</a></code> to show the window if it was previously hidden (withdrawn).</p>
</div>


                            </div>
                            <div id="ValveTestWindow.switch_window_mode" class="classattr">
                                        <input id="ValveTestWindow.switch_window_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">switch_window_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.switch_window_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.switch_window_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.switch_window_mode-241"><a href="#ValveTestWindow.switch_window_mode-241"><span class="linenos">241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">switch_window_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.switch_window_mode-242"><a href="#ValveTestWindow.switch_window_mode-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.switch_window_mode-243"><a href="#ValveTestWindow.switch_window_mode-243"><span class="linenos">243</span></a><span class="sd">        Toggles the window&#39;s operational mode between Testing and Priming.</span>
</span><span id="ValveTestWindow.switch_window_mode-244"><a href="#ValveTestWindow.switch_window_mode-244"><span class="linenos">244</span></a>
</span><span id="ValveTestWindow.switch_window_mode-245"><a href="#ValveTestWindow.switch_window_mode-245"><span class="linenos">245</span></a><span class="sd">        Updates the window title and mode button text/color. Hides or shows</span>
</span><span id="ValveTestWindow.switch_window_mode-246"><a href="#ValveTestWindow.switch_window_mode-246"><span class="linenos">246</span></a><span class="sd">        mode-specific UI elements (desired volume input, test results table).</span>
</span><span id="ValveTestWindow.switch_window_mode-247"><a href="#ValveTestWindow.switch_window_mode-247"><span class="linenos">247</span></a><span class="sd">        Changes the command associated with the main start/stop button.</span>
</span><span id="ValveTestWindow.switch_window_mode-248"><a href="#ValveTestWindow.switch_window_mode-248"><span class="linenos">248</span></a><span class="sd">        Prevents mode switching if a test or prime sequence is currently running to avoid Arduino</span>
</span><span id="ValveTestWindow.switch_window_mode-249"><a href="#ValveTestWindow.switch_window_mode-249"><span class="linenos">249</span></a><span class="sd">        Communications errors. Resizes and centers the window after GUI changes.</span>
</span><span id="ValveTestWindow.switch_window_mode-250"><a href="#ValveTestWindow.switch_window_mode-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.switch_window_mode-251"><a href="#ValveTestWindow.switch_window_mode-251"><span class="linenos">251</span></a>
</span><span id="ValveTestWindow.switch_window_mode-252"><a href="#ValveTestWindow.switch_window_mode-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="ValveTestWindow.switch_window_mode-253"><a href="#ValveTestWindow.switch_window_mode-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="ValveTestWindow.switch_window_mode-254"><a href="#ValveTestWindow.switch_window_mode-254"><span class="linenos">254</span></a>                <span class="c1"># if the test is currently running we do not want to switch modes. Stop testing to switch modes</span>
</span><span id="ValveTestWindow.switch_window_mode-255"><a href="#ValveTestWindow.switch_window_mode-255"><span class="linenos">255</span></a>                <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span>
</span><span id="ValveTestWindow.switch_window_mode-256"><a href="#ValveTestWindow.switch_window_mode-256"><span class="linenos">256</span></a>                    <span class="s2">&quot;ACTION PROHIBITED&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-257"><a href="#ValveTestWindow.switch_window_mode-257"><span class="linenos">257</span></a>                    <span class="s2">&quot;You cannot switch modes while a test is running. If you&#39;d like to switch modes, please abort the test and try again.&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-258"><a href="#ValveTestWindow.switch_window_mode-258"><span class="linenos">258</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-259"><a href="#ValveTestWindow.switch_window_mode-259"><span class="linenos">259</span></a>                <span class="k">return</span>
</span><span id="ValveTestWindow.switch_window_mode-260"><a href="#ValveTestWindow.switch_window_mode-260"><span class="linenos">260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Priming&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-261"><a href="#ValveTestWindow.switch_window_mode-261"><span class="linenos">261</span></a>
</span><span id="ValveTestWindow.switch_window_mode-262"><a href="#ValveTestWindow.switch_window_mode-262"><span class="linenos">262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span>
</span><span id="ValveTestWindow.switch_window_mode-263"><a href="#ValveTestWindow.switch_window_mode-263"><span class="linenos">263</span></a>
</span><span id="ValveTestWindow.switch_window_mode-264"><a href="#ValveTestWindow.switch_window_mode-264"><span class="linenos">264</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Switch to Testing Mode&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;DeepSkyBlue3&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-265"><a href="#ValveTestWindow.switch_window_mode-265"><span class="linenos">265</span></a>
</span><span id="ValveTestWindow.switch_window_mode-266"><a href="#ValveTestWindow.switch_window_mode-266"><span class="linenos">266</span></a>            <span class="c1"># orig. row 1</span>
</span><span id="ValveTestWindow.switch_window_mode-267"><a href="#ValveTestWindow.switch_window_mode-267"><span class="linenos">267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
</span><span id="ValveTestWindow.switch_window_mode-268"><a href="#ValveTestWindow.switch_window_mode-268"><span class="linenos">268</span></a>            <span class="c1"># orig. row 3</span>
</span><span id="ValveTestWindow.switch_window_mode-269"><a href="#ValveTestWindow.switch_window_mode-269"><span class="linenos">269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
</span><span id="ValveTestWindow.switch_window_mode-270"><a href="#ValveTestWindow.switch_window_mode-270"><span class="linenos">270</span></a>
</span><span id="ValveTestWindow.switch_window_mode-271"><a href="#ValveTestWindow.switch_window_mode-271"><span class="linenos">271</span></a>            <span class="c1"># start testing button -&gt; start priming button / command</span>
</span><span id="ValveTestWindow.switch_window_mode-272"><a href="#ValveTestWindow.switch_window_mode-272"><span class="linenos">272</span></a>
</span><span id="ValveTestWindow.switch_window_mode-273"><a href="#ValveTestWindow.switch_window_mode-273"><span class="linenos">273</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.switch_window_mode-274"><a href="#ValveTestWindow.switch_window_mode-274"><span class="linenos">274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow.switch_window_mode-275"><a href="#ValveTestWindow.switch_window_mode-275"><span class="linenos">275</span></a>                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Priming&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-276"><a href="#ValveTestWindow.switch_window_mode-276"><span class="linenos">276</span></a>                    <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-277"><a href="#ValveTestWindow.switch_window_mode-277"><span class="linenos">277</span></a>                    <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">(),</span>
</span><span id="ValveTestWindow.switch_window_mode-278"><a href="#ValveTestWindow.switch_window_mode-278"><span class="linenos">278</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-279"><a href="#ValveTestWindow.switch_window_mode-279"><span class="linenos">279</span></a>
</span><span id="ValveTestWindow.switch_window_mode-280"><a href="#ValveTestWindow.switch_window_mode-280"><span class="linenos">280</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.switch_window_mode-281"><a href="#ValveTestWindow.switch_window_mode-281"><span class="linenos">281</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span><span class="p">:</span>
</span><span id="ValveTestWindow.switch_window_mode-282"><a href="#ValveTestWindow.switch_window_mode-282"><span class="linenos">282</span></a>                <span class="c1"># if the test is currently running we do not want to switch modes. Stop testing to switch modes</span>
</span><span id="ValveTestWindow.switch_window_mode-283"><a href="#ValveTestWindow.switch_window_mode-283"><span class="linenos">283</span></a>                <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span>
</span><span id="ValveTestWindow.switch_window_mode-284"><a href="#ValveTestWindow.switch_window_mode-284"><span class="linenos">284</span></a>                    <span class="s2">&quot;ACTION PROHIBITED&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-285"><a href="#ValveTestWindow.switch_window_mode-285"><span class="linenos">285</span></a>                    <span class="s2">&quot;You cannot switch modes while a valve prime operation is running. If you&#39;d like to switch modes, please abort the prime and try again.&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-286"><a href="#ValveTestWindow.switch_window_mode-286"><span class="linenos">286</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-287"><a href="#ValveTestWindow.switch_window_mode-287"><span class="linenos">287</span></a>                <span class="k">return</span>
</span><span id="ValveTestWindow.switch_window_mode-288"><a href="#ValveTestWindow.switch_window_mode-288"><span class="linenos">288</span></a>
</span><span id="ValveTestWindow.switch_window_mode-289"><a href="#ValveTestWindow.switch_window_mode-289"><span class="linenos">289</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Valve Testing&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-290"><a href="#ValveTestWindow.switch_window_mode-290"><span class="linenos">290</span></a>
</span><span id="ValveTestWindow.switch_window_mode-291"><a href="#ValveTestWindow.switch_window_mode-291"><span class="linenos">291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">=</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span>
</span><span id="ValveTestWindow.switch_window_mode-292"><a href="#ValveTestWindow.switch_window_mode-292"><span class="linenos">292</span></a>
</span><span id="ValveTestWindow.switch_window_mode-293"><a href="#ValveTestWindow.switch_window_mode-293"><span class="linenos">293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Switch to Priming Mode&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-294"><a href="#ValveTestWindow.switch_window_mode-294"><span class="linenos">294</span></a>
</span><span id="ValveTestWindow.switch_window_mode-295"><a href="#ValveTestWindow.switch_window_mode-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span>
</span><span id="ValveTestWindow.switch_window_mode-296"><a href="#ValveTestWindow.switch_window_mode-296"><span class="linenos">296</span></a>                <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span>
</span><span id="ValveTestWindow.switch_window_mode-297"><a href="#ValveTestWindow.switch_window_mode-297"><span class="linenos">297</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-298"><a href="#ValveTestWindow.switch_window_mode-298"><span class="linenos">298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-299"><a href="#ValveTestWindow.switch_window_mode-299"><span class="linenos">299</span></a>
</span><span id="ValveTestWindow.switch_window_mode-300"><a href="#ValveTestWindow.switch_window_mode-300"><span class="linenos">300</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.switch_window_mode-301"><a href="#ValveTestWindow.switch_window_mode-301"><span class="linenos">301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow.switch_window_mode-302"><a href="#ValveTestWindow.switch_window_mode-302"><span class="linenos">302</span></a>                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-303"><a href="#ValveTestWindow.switch_window_mode-303"><span class="linenos">303</span></a>                    <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.switch_window_mode-304"><a href="#ValveTestWindow.switch_window_mode-304"><span class="linenos">304</span></a>                    <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_testing_toggle</span><span class="p">(),</span>
</span><span id="ValveTestWindow.switch_window_mode-305"><a href="#ValveTestWindow.switch_window_mode-305"><span class="linenos">305</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow.switch_window_mode-306"><a href="#ValveTestWindow.switch_window_mode-306"><span class="linenos">306</span></a>
</span><span id="ValveTestWindow.switch_window_mode-307"><a href="#ValveTestWindow.switch_window_mode-307"><span class="linenos">307</span></a>        <span class="c1"># resize the window to fit current content</span>
</span><span id="ValveTestWindow.switch_window_mode-308"><a href="#ValveTestWindow.switch_window_mode-308"><span class="linenos">308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
</span><span id="ValveTestWindow.switch_window_mode-309"><a href="#ValveTestWindow.switch_window_mode-309"><span class="linenos">309</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">center_window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Toggles the window's operational mode between Testing and Priming.</p>

<p>Updates the window title and mode button text/color. Hides or shows
mode-specific UI elements (desired volume input, test results table).
Changes the command associated with the main start/stop button.
Prevents mode switching if a test or prime sequence is currently running to avoid Arduino
Communications errors. Resizes and centers the window after GUI changes.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.create_interface" class="classattr">
                                        <input id="ValveTestWindow.create_interface-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_interface</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.create_interface-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.create_interface"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.create_interface-311"><a href="#ValveTestWindow.create_interface-311"><span class="linenos">311</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.create_interface-312"><a href="#ValveTestWindow.create_interface-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.create_interface-313"><a href="#ValveTestWindow.create_interface-313"><span class="linenos">313</span></a><span class="sd">        Constructs and arranges all GUI elements within the window.</span>
</span><span id="ValveTestWindow.create_interface-314"><a href="#ValveTestWindow.create_interface-314"><span class="linenos">314</span></a>
</span><span id="ValveTestWindow.create_interface-315"><a href="#ValveTestWindow.create_interface-315"><span class="linenos">315</span></a><span class="sd">        Creates frames for structure, input fields (desired volume, actuations),</span>
</span><span id="ValveTestWindow.create_interface-316"><a href="#ValveTestWindow.create_interface-316"><span class="linenos">316</span></a><span class="sd">        the mode switch button, the valve selection buttons, the test results table,</span>
</span><span id="ValveTestWindow.create_interface-317"><a href="#ValveTestWindow.create_interface-317"><span class="linenos">317</span></a><span class="sd">        and the main start/abort/prime button. Uses `GUIUtils` for</span>
</span><span id="ValveTestWindow.create_interface-318"><a href="#ValveTestWindow.create_interface-318"><span class="linenos">318</span></a><span class="sd">        widget creation where possible. Calls helper methods `create_valve_test_table`</span>
</span><span id="ValveTestWindow.create_interface-319"><a href="#ValveTestWindow.create_interface-319"><span class="linenos">319</span></a><span class="sd">        and `create_buttons`. Centers the window after creation.</span>
</span><span id="ValveTestWindow.create_interface-320"><a href="#ValveTestWindow.create_interface-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.create_interface-321"><a href="#ValveTestWindow.create_interface-321"><span class="linenos">321</span></a>
</span><span id="ValveTestWindow.create_interface-322"><a href="#ValveTestWindow.create_interface-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_button</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-323"><a href="#ValveTestWindow.create_interface-323"><span class="linenos">323</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-324"><a href="#ValveTestWindow.create_interface-324"><span class="linenos">324</span></a>            <span class="s2">&quot;Switch to Priming Mode&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-325"><a href="#ValveTestWindow.create_interface-325"><span class="linenos">325</span></a>            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_window_mode</span><span class="p">(),</span>
</span><span id="ValveTestWindow.create_interface-326"><a href="#ValveTestWindow.create_interface-326"><span class="linenos">326</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-327"><a href="#ValveTestWindow.create_interface-327"><span class="linenos">327</span></a>            <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-328"><a href="#ValveTestWindow.create_interface-328"><span class="linenos">328</span></a>            <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-329"><a href="#ValveTestWindow.create_interface-329"><span class="linenos">329</span></a>        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ValveTestWindow.create_interface-330"><a href="#ValveTestWindow.create_interface-330"><span class="linenos">330</span></a>
</span><span id="ValveTestWindow.create_interface-331"><a href="#ValveTestWindow.create_interface-331"><span class="linenos">331</span></a>        <span class="c1"># create a new frame to contain the desired dispensed volume label and frame</span>
</span><span id="ValveTestWindow.create_interface-332"><a href="#ValveTestWindow.create_interface-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-333"><a href="#ValveTestWindow.create_interface-333"><span class="linenos">333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-334"><a href="#ValveTestWindow.create_interface-334"><span class="linenos">334</span></a>
</span><span id="ValveTestWindow.create_interface-335"><a href="#ValveTestWindow.create_interface-335"><span class="linenos">335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-336"><a href="#ValveTestWindow.create_interface-336"><span class="linenos">336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-337"><a href="#ValveTestWindow.create_interface-337"><span class="linenos">337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-338"><a href="#ValveTestWindow.create_interface-338"><span class="linenos">338</span></a>
</span><span id="ValveTestWindow.create_interface-339"><a href="#ValveTestWindow.create_interface-339"><span class="linenos">339</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-340"><a href="#ValveTestWindow.create_interface-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-341"><a href="#ValveTestWindow.create_interface-341"><span class="linenos">341</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Desired Dispensed Volume in Microliters (ul)&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-342"><a href="#ValveTestWindow.create_interface-342"><span class="linenos">342</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-343"><a href="#ValveTestWindow.create_interface-343"><span class="linenos">343</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span><span id="ValveTestWindow.create_interface-344"><a href="#ValveTestWindow.create_interface-344"><span class="linenos">344</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-345"><a href="#ValveTestWindow.create_interface-345"><span class="linenos">345</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;dark blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-346"><a href="#ValveTestWindow.create_interface-346"><span class="linenos">346</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-347"><a href="#ValveTestWindow.create_interface-347"><span class="linenos">347</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-348"><a href="#ValveTestWindow.create_interface-348"><span class="linenos">348</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-349"><a href="#ValveTestWindow.create_interface-349"><span class="linenos">349</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-350"><a href="#ValveTestWindow.create_interface-350"><span class="linenos">350</span></a>
</span><span id="ValveTestWindow.create_interface-351"><a href="#ValveTestWindow.create_interface-351"><span class="linenos">351</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-352"><a href="#ValveTestWindow.create_interface-352"><span class="linenos">352</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dispensed_vol_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-353"><a href="#ValveTestWindow.create_interface-353"><span class="linenos">353</span></a>            <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-354"><a href="#ValveTestWindow.create_interface-354"><span class="linenos">354</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
</span><span id="ValveTestWindow.create_interface-355"><a href="#ValveTestWindow.create_interface-355"><span class="linenos">355</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-356"><a href="#ValveTestWindow.create_interface-356"><span class="linenos">356</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-357"><a href="#ValveTestWindow.create_interface-357"><span class="linenos">357</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-358"><a href="#ValveTestWindow.create_interface-358"><span class="linenos">358</span></a>        <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-359"><a href="#ValveTestWindow.create_interface-359"><span class="linenos">359</span></a>
</span><span id="ValveTestWindow.create_interface-360"><a href="#ValveTestWindow.create_interface-360"><span class="linenos">360</span></a>        <span class="c1"># create another new frame to contain the amount of times each</span>
</span><span id="ValveTestWindow.create_interface-361"><a href="#ValveTestWindow.create_interface-361"><span class="linenos">361</span></a>        <span class="c1"># valve should actuate label and frame</span>
</span><span id="ValveTestWindow.create_interface-362"><a href="#ValveTestWindow.create_interface-362"><span class="linenos">362</span></a>        <span class="n">frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-363"><a href="#ValveTestWindow.create_interface-363"><span class="linenos">363</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-364"><a href="#ValveTestWindow.create_interface-364"><span class="linenos">364</span></a>
</span><span id="ValveTestWindow.create_interface-365"><a href="#ValveTestWindow.create_interface-365"><span class="linenos">365</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-366"><a href="#ValveTestWindow.create_interface-366"><span class="linenos">366</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-367"><a href="#ValveTestWindow.create_interface-367"><span class="linenos">367</span></a>        <span class="n">frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-368"><a href="#ValveTestWindow.create_interface-368"><span class="linenos">368</span></a>
</span><span id="ValveTestWindow.create_interface-369"><a href="#ValveTestWindow.create_interface-369"><span class="linenos">369</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-370"><a href="#ValveTestWindow.create_interface-370"><span class="linenos">370</span></a>            <span class="n">frame</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-371"><a href="#ValveTestWindow.create_interface-371"><span class="linenos">371</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;How Many Times Should the Valve Actuate?&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-372"><a href="#ValveTestWindow.create_interface-372"><span class="linenos">372</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-373"><a href="#ValveTestWindow.create_interface-373"><span class="linenos">373</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span><span id="ValveTestWindow.create_interface-374"><a href="#ValveTestWindow.create_interface-374"><span class="linenos">374</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-375"><a href="#ValveTestWindow.create_interface-375"><span class="linenos">375</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;dark blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-376"><a href="#ValveTestWindow.create_interface-376"><span class="linenos">376</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-377"><a href="#ValveTestWindow.create_interface-377"><span class="linenos">377</span></a>            <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-378"><a href="#ValveTestWindow.create_interface-378"><span class="linenos">378</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-379"><a href="#ValveTestWindow.create_interface-379"><span class="linenos">379</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-380"><a href="#ValveTestWindow.create_interface-380"><span class="linenos">380</span></a>
</span><span id="ValveTestWindow.create_interface-381"><a href="#ValveTestWindow.create_interface-381"><span class="linenos">381</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-382"><a href="#ValveTestWindow.create_interface-382"><span class="linenos">382</span></a>            <span class="n">frame</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-383"><a href="#ValveTestWindow.create_interface-383"><span class="linenos">383</span></a>            <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-384"><a href="#ValveTestWindow.create_interface-384"><span class="linenos">384</span></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
</span><span id="ValveTestWindow.create_interface-385"><a href="#ValveTestWindow.create_interface-385"><span class="linenos">385</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-386"><a href="#ValveTestWindow.create_interface-386"><span class="linenos">386</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_interface-387"><a href="#ValveTestWindow.create_interface-387"><span class="linenos">387</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-388"><a href="#ValveTestWindow.create_interface-388"><span class="linenos">388</span></a>        <span class="n">entry</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-389"><a href="#ValveTestWindow.create_interface-389"><span class="linenos">389</span></a>
</span><span id="ValveTestWindow.create_interface-390"><a href="#ValveTestWindow.create_interface-390"><span class="linenos">390</span></a>        <span class="c1">### ROW 3 ###</span>
</span><span id="ValveTestWindow.create_interface-391"><a href="#ValveTestWindow.create_interface-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_valve_test_table</span><span class="p">()</span>
</span><span id="ValveTestWindow.create_interface-392"><a href="#ValveTestWindow.create_interface-392"><span class="linenos">392</span></a>
</span><span id="ValveTestWindow.create_interface-393"><a href="#ValveTestWindow.create_interface-393"><span class="linenos">393</span></a>        <span class="c1"># setup frames for valve buttons</span>
</span><span id="ValveTestWindow.create_interface-394"><a href="#ValveTestWindow.create_interface-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-395"><a href="#ValveTestWindow.create_interface-395"><span class="linenos">395</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow.create_interface-396"><a href="#ValveTestWindow.create_interface-396"><span class="linenos">396</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-397"><a href="#ValveTestWindow.create_interface-397"><span class="linenos">397</span></a>        <span class="c1">### ROW 4 ###</span>
</span><span id="ValveTestWindow.create_interface-398"><a href="#ValveTestWindow.create_interface-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-399"><a href="#ValveTestWindow.create_interface-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-400"><a href="#ValveTestWindow.create_interface-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-401"><a href="#ValveTestWindow.create_interface-401"><span class="linenos">401</span></a>
</span><span id="ValveTestWindow.create_interface-402"><a href="#ValveTestWindow.create_interface-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-403"><a href="#ValveTestWindow.create_interface-403"><span class="linenos">403</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow.create_interface-404"><a href="#ValveTestWindow.create_interface-404"><span class="linenos">404</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-405"><a href="#ValveTestWindow.create_interface-405"><span class="linenos">405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-406"><a href="#ValveTestWindow.create_interface-406"><span class="linenos">406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-407"><a href="#ValveTestWindow.create_interface-407"><span class="linenos">407</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="ValveTestWindow.create_interface-408"><a href="#ValveTestWindow.create_interface-408"><span class="linenos">408</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-409"><a href="#ValveTestWindow.create_interface-409"><span class="linenos">409</span></a>
</span><span id="ValveTestWindow.create_interface-410"><a href="#ValveTestWindow.create_interface-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_interface-411"><a href="#ValveTestWindow.create_interface-411"><span class="linenos">411</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons_frame</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow.create_interface-412"><a href="#ValveTestWindow.create_interface-412"><span class="linenos">412</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-413"><a href="#ValveTestWindow.create_interface-413"><span class="linenos">413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-414"><a href="#ValveTestWindow.create_interface-414"><span class="linenos">414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-415"><a href="#ValveTestWindow.create_interface-415"><span class="linenos">415</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="ValveTestWindow.create_interface-416"><a href="#ValveTestWindow.create_interface-416"><span class="linenos">416</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="o">.</span><span class="n">grid_rowconfigure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_interface-417"><a href="#ValveTestWindow.create_interface-417"><span class="linenos">417</span></a>
</span><span id="ValveTestWindow.create_interface-418"><a href="#ValveTestWindow.create_interface-418"><span class="linenos">418</span></a>        <span class="c1">### ROW 5 ###</span>
</span><span id="ValveTestWindow.create_interface-419"><a href="#ValveTestWindow.create_interface-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_buttons</span><span class="p">()</span>
</span><span id="ValveTestWindow.create_interface-420"><a href="#ValveTestWindow.create_interface-420"><span class="linenos">420</span></a>
</span><span id="ValveTestWindow.create_interface-421"><a href="#ValveTestWindow.create_interface-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
</span><span id="ValveTestWindow.create_interface-422"><a href="#ValveTestWindow.create_interface-422"><span class="linenos">422</span></a>        <span class="n">GUIUtils</span><span class="o">.</span><span class="n">center_window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructs and arranges all GUI elements within the window.</p>

<p>Creates frames for structure, input fields (desired volume, actuations),
the mode switch button, the valve selection buttons, the test results table,
and the main start/abort/prime button. Uses <code>GUIUtils</code> for
widget creation where possible. Calls helper methods <code><a href="#ValveTestWindow.create_valve_test_table">create_valve_test_table</a></code>
and <code><a href="#ValveTestWindow.create_buttons">create_buttons</a></code>. Centers the window after creation.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.start_testing_toggle" class="classattr">
                                        <input id="ValveTestWindow.start_testing_toggle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_testing_toggle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.start_testing_toggle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.start_testing_toggle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.start_testing_toggle-424"><a href="#ValveTestWindow.start_testing_toggle-424"><span class="linenos">424</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_testing_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.start_testing_toggle-425"><a href="#ValveTestWindow.start_testing_toggle-425"><span class="linenos">425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.start_testing_toggle-426"><a href="#ValveTestWindow.start_testing_toggle-426"><span class="linenos">426</span></a><span class="sd">        Handles the action of the main button when in Testing mode.</span>
</span><span id="ValveTestWindow.start_testing_toggle-427"><a href="#ValveTestWindow.start_testing_toggle-427"><span class="linenos">427</span></a>
</span><span id="ValveTestWindow.start_testing_toggle-428"><a href="#ValveTestWindow.start_testing_toggle-428"><span class="linenos">428</span></a><span class="sd">        If a test is running, it calls `abort_test()` and updates the button appearance.</span>
</span><span id="ValveTestWindow.start_testing_toggle-429"><a href="#ValveTestWindow.start_testing_toggle-429"><span class="linenos">429</span></a><span class="sd">        If no test is running, it calls `send_schedules()` to initiate a new test.</span>
</span><span id="ValveTestWindow.start_testing_toggle-430"><a href="#ValveTestWindow.start_testing_toggle-430"><span class="linenos">430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.start_testing_toggle-431"><a href="#ValveTestWindow.start_testing_toggle-431"><span class="linenos">431</span></a>
</span><span id="ValveTestWindow.start_testing_toggle-432"><a href="#ValveTestWindow.start_testing_toggle-432"><span class="linenos">432</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="ValveTestWindow.start_testing_toggle-433"><a href="#ValveTestWindow.start_testing_toggle-433"><span class="linenos">433</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.start_testing_toggle-434"><a href="#ValveTestWindow.start_testing_toggle-434"><span class="linenos">434</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.start_testing_toggle-435"><a href="#ValveTestWindow.start_testing_toggle-435"><span class="linenos">435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="ValveTestWindow.start_testing_toggle-436"><a href="#ValveTestWindow.start_testing_toggle-436"><span class="linenos">436</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.start_testing_toggle-437"><a href="#ValveTestWindow.start_testing_toggle-437"><span class="linenos">437</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Handles the action of the main button when in Testing mode.</p>

<p>If a test is running, it calls <code><a href="#ValveTestWindow.abort_test">abort_test()</a></code> and updates the button appearance.
If no test is running, it calls <code><a href="#ValveTestWindow.send_schedules">send_schedules()</a></code> to initiate a new test.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.create_buttons" class="classattr">
                                        <input id="ValveTestWindow.create_buttons-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_buttons</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.create_buttons-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.create_buttons"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.create_buttons-439"><a href="#ValveTestWindow.create_buttons-439"><span class="linenos">439</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.create_buttons-440"><a href="#ValveTestWindow.create_buttons-440"><span class="linenos">440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.create_buttons-441"><a href="#ValveTestWindow.create_buttons-441"><span class="linenos">441</span></a><span class="sd">        Creates and places the individual valve selection buttons and the main action button.</span>
</span><span id="ValveTestWindow.create_buttons-442"><a href="#ValveTestWindow.create_buttons-442"><span class="linenos">442</span></a>
</span><span id="ValveTestWindow.create_buttons-443"><a href="#ValveTestWindow.create_buttons-443"><span class="linenos">443</span></a><span class="sd">        Generates buttons for each valve (1 to TOTAL_VALVES), arranging them</span>
</span><span id="ValveTestWindow.create_buttons-444"><a href="#ValveTestWindow.create_buttons-444"><span class="linenos">444</span></a><span class="sd">        into side-one and side-two frames using `GUIUtils.create_button`.</span>
</span><span id="ValveTestWindow.create_buttons-445"><a href="#ValveTestWindow.create_buttons-445"><span class="linenos">445</span></a><span class="sd">        Assigns the `toggle_valve_button` command to each valve button.</span>
</span><span id="ValveTestWindow.create_buttons-446"><a href="#ValveTestWindow.create_buttons-446"><span class="linenos">446</span></a>
</span><span id="ValveTestWindow.create_buttons-447"><a href="#ValveTestWindow.create_buttons-447"><span class="linenos">447</span></a><span class="sd">        Creates the main &#39;Start Testing&#39; / &#39;Start Priming&#39; / &#39;Abort&#39; button.</span>
</span><span id="ValveTestWindow.create_buttons-448"><a href="#ValveTestWindow.create_buttons-448"><span class="linenos">448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.create_buttons-449"><a href="#ValveTestWindow.create_buttons-449"><span class="linenos">449</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">):</span>
</span><span id="ValveTestWindow.create_buttons-450"><a href="#ValveTestWindow.create_buttons-450"><span class="linenos">450</span></a>            <span class="c1"># GUIUtils.create_button returns both the buttons frame and button object in a tuple. using [1] on the</span>
</span><span id="ValveTestWindow.create_buttons-451"><a href="#ValveTestWindow.create_buttons-451"><span class="linenos">451</span></a>            <span class="c1"># return item yields the button object.</span>
</span><span id="ValveTestWindow.create_buttons-452"><a href="#ValveTestWindow.create_buttons-452"><span class="linenos">452</span></a>
</span><span id="ValveTestWindow.create_buttons-453"><a href="#ValveTestWindow.create_buttons-453"><span class="linenos">453</span></a>            <span class="c1"># return the side one button and put it on the side one &#39;side&#39;</span>
</span><span id="ValveTestWindow.create_buttons-454"><a href="#ValveTestWindow.create_buttons-454"><span class="linenos">454</span></a>            <span class="c1"># of the list (0-4)</span>
</span><span id="ValveTestWindow.create_buttons-455"><a href="#ValveTestWindow.create_buttons-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_buttons-456"><a href="#ValveTestWindow.create_buttons-456"><span class="linenos">456</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_valves_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-457"><a href="#ValveTestWindow.create_buttons-457"><span class="linenos">457</span></a>                <span class="sa">f</span><span class="s2">&quot;Valve </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-458"><a href="#ValveTestWindow.create_buttons-458"><span class="linenos">458</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_valve_button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span>
</span><span id="ValveTestWindow.create_buttons-459"><a href="#ValveTestWindow.create_buttons-459"><span class="linenos">459</span></a>                <span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-460"><a href="#ValveTestWindow.create_buttons-460"><span class="linenos">460</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-461"><a href="#ValveTestWindow.create_buttons-461"><span class="linenos">461</span></a>                <span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-462"><a href="#ValveTestWindow.create_buttons-462"><span class="linenos">462</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ValveTestWindow.create_buttons-463"><a href="#ValveTestWindow.create_buttons-463"><span class="linenos">463</span></a>
</span><span id="ValveTestWindow.create_buttons-464"><a href="#ValveTestWindow.create_buttons-464"><span class="linenos">464</span></a>            <span class="c1"># return the side two button and put it on the side two &#39;side&#39;</span>
</span><span id="ValveTestWindow.create_buttons-465"><a href="#ValveTestWindow.create_buttons-465"><span class="linenos">465</span></a>            <span class="c1"># of the list (5-8)</span>
</span><span id="ValveTestWindow.create_buttons-466"><a href="#ValveTestWindow.create_buttons-466"><span class="linenos">466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_buttons-467"><a href="#ValveTestWindow.create_buttons-467"><span class="linenos">467</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_valves_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-468"><a href="#ValveTestWindow.create_buttons-468"><span class="linenos">468</span></a>                <span class="sa">f</span><span class="s2">&quot;Valve </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-469"><a href="#ValveTestWindow.create_buttons-469"><span class="linenos">469</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_valve_button</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_buttons-470"><a href="#ValveTestWindow.create_buttons-470"><span class="linenos">470</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">valve_buttons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)],</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_buttons-471"><a href="#ValveTestWindow.create_buttons-471"><span class="linenos">471</span></a>                <span class="p">),</span>
</span><span id="ValveTestWindow.create_buttons-472"><a href="#ValveTestWindow.create_buttons-472"><span class="linenos">472</span></a>                <span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-473"><a href="#ValveTestWindow.create_buttons-473"><span class="linenos">473</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-474"><a href="#ValveTestWindow.create_buttons-474"><span class="linenos">474</span></a>                <span class="mi">0</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_buttons-475"><a href="#ValveTestWindow.create_buttons-475"><span class="linenos">475</span></a>            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ValveTestWindow.create_buttons-476"><a href="#ValveTestWindow.create_buttons-476"><span class="linenos">476</span></a>
</span><span id="ValveTestWindow.create_buttons-477"><a href="#ValveTestWindow.create_buttons-477"><span class="linenos">477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">create_button</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_buttons-478"><a href="#ValveTestWindow.create_buttons-478"><span class="linenos">478</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_testing_toggle</span><span class="p">(),</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="ValveTestWindow.create_buttons-479"><a href="#ValveTestWindow.create_buttons-479"><span class="linenos">479</span></a>        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Creates and places the individual valve selection buttons and the main action button.</p>

<p>Generates buttons for each valve (1 to TOTAL_VALVES), arranging them
into side-one and side-two frames using <code>GUIUtils.create_button</code>.
Assigns the <code><a href="#ValveTestWindow.toggle_valve_button">toggle_valve_button</a></code> command to each valve button.</p>

<p>Creates the main 'Start Testing' / 'Start Priming' / 'Abort' button.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.create_valve_test_table" class="classattr">
                                        <input id="ValveTestWindow.create_valve_test_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_valve_test_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.create_valve_test_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.create_valve_test_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.create_valve_test_table-481"><a href="#ValveTestWindow.create_valve_test_table-481"><span class="linenos">481</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_valve_test_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.create_valve_test_table-482"><a href="#ValveTestWindow.create_valve_test_table-482"><span class="linenos">482</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.create_valve_test_table-483"><a href="#ValveTestWindow.create_valve_test_table-483"><span class="linenos">483</span></a><span class="sd">        Creates, configures, and populates the initial state of the ttk.Treeview table.</span>
</span><span id="ValveTestWindow.create_valve_test_table-484"><a href="#ValveTestWindow.create_valve_test_table-484"><span class="linenos">484</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-485"><a href="#ValveTestWindow.create_valve_test_table-485"><span class="linenos">485</span></a><span class="sd">        Sets up the table columns (&quot;Valve&quot;, &quot;Amount Dispensed...&quot;, &quot;Testing Opening Time...&quot;).</span>
</span><span id="ValveTestWindow.create_valve_test_table-486"><a href="#ValveTestWindow.create_valve_test_table-486"><span class="linenos">486</span></a><span class="sd">        Adds a button above the table to open the `ManualTimeAdjustment` window.</span>
</span><span id="ValveTestWindow.create_valve_test_table-487"><a href="#ValveTestWindow.create_valve_test_table-487"><span class="linenos">487</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-488"><a href="#ValveTestWindow.create_valve_test_table-488"><span class="linenos">488</span></a><span class="sd">        Loads the currently selected valve durations from `models.arduino_data.ArduinoData`.</span>
</span><span id="ValveTestWindow.create_valve_test_table-489"><a href="#ValveTestWindow.create_valve_test_table-489"><span class="linenos">489</span></a><span class="sd">        Inserts initial rows for all possible valves, marking them as &quot;Test Not Complete&quot;</span>
</span><span id="ValveTestWindow.create_valve_test_table-490"><a href="#ValveTestWindow.create_valve_test_table-490"><span class="linenos">490</span></a><span class="sd">        and displaying their current duration. Stores row IDs in `self.table_entries` for later access.</span>
</span><span id="ValveTestWindow.create_valve_test_table-491"><a href="#ValveTestWindow.create_valve_test_table-491"><span class="linenos">491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.create_valve_test_table-492"><a href="#ValveTestWindow.create_valve_test_table-492"><span class="linenos">492</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-493"><a href="#ValveTestWindow.create_valve_test_table-493"><span class="linenos">493</span></a>        <span class="c1"># this function creates and labels the testing window table that displays the information recieved from the arduino reguarding the results of the tes</span>
</span><span id="ValveTestWindow.create_valve_test_table-494"><a href="#ValveTestWindow.create_valve_test_table-494"><span class="linenos">494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-495"><a href="#ValveTestWindow.create_valve_test_table-495"><span class="linenos">495</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span>
</span><span id="ValveTestWindow.create_valve_test_table-496"><a href="#ValveTestWindow.create_valve_test_table-496"><span class="linenos">496</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-497"><a href="#ValveTestWindow.create_valve_test_table-497"><span class="linenos">497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;nsew&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-498"><a href="#ValveTestWindow.create_valve_test_table-498"><span class="linenos">498</span></a>        <span class="c1"># tell the frame to fill the available width</span>
</span><span id="ValveTestWindow.create_valve_test_table-499"><a href="#ValveTestWindow.create_valve_test_table-499"><span class="linenos">499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="o">.</span><span class="n">grid_columnconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-500"><a href="#ValveTestWindow.create_valve_test_table-500"><span class="linenos">500</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-501"><a href="#ValveTestWindow.create_valve_test_table-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Treeview</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-502"><a href="#ValveTestWindow.create_valve_test_table-502"><span class="linenos">502</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;headings&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">12</span>
</span><span id="ValveTestWindow.create_valve_test_table-503"><a href="#ValveTestWindow.create_valve_test_table-503"><span class="linenos">503</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-504"><a href="#ValveTestWindow.create_valve_test_table-504"><span class="linenos">504</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-505"><a href="#ValveTestWindow.create_valve_test_table-505"><span class="linenos">505</span></a>        <span class="n">headings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow.create_valve_test_table-506"><a href="#ValveTestWindow.create_valve_test_table-506"><span class="linenos">506</span></a>            <span class="s2">&quot;Valve&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-507"><a href="#ValveTestWindow.create_valve_test_table-507"><span class="linenos">507</span></a>            <span class="s2">&quot;Amount Dispensed Per Lick (ul)&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-508"><a href="#ValveTestWindow.create_valve_test_table-508"><span class="linenos">508</span></a>            <span class="s2">&quot;Testing Opening Time of (ms)&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-509"><a href="#ValveTestWindow.create_valve_test_table-509"><span class="linenos">509</span></a>        <span class="p">]</span>
</span><span id="ValveTestWindow.create_valve_test_table-510"><a href="#ValveTestWindow.create_valve_test_table-510"><span class="linenos">510</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-511"><a href="#ValveTestWindow.create_valve_test_table-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headings</span>
</span><span id="ValveTestWindow.create_valve_test_table-512"><a href="#ValveTestWindow.create_valve_test_table-512"><span class="linenos">512</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-513"><a href="#ValveTestWindow.create_valve_test_table-513"><span class="linenos">513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;ew&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-514"><a href="#ValveTestWindow.create_valve_test_table-514"><span class="linenos">514</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-515"><a href="#ValveTestWindow.create_valve_test_table-515"><span class="linenos">515</span></a>        <span class="n">button</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-516"><a href="#ValveTestWindow.create_valve_test_table-516"><span class="linenos">516</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table_frame</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-517"><a href="#ValveTestWindow.create_valve_test_table-517"><span class="linenos">517</span></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Manual Valve Duration Override&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-518"><a href="#ValveTestWindow.create_valve_test_table-518"><span class="linenos">518</span></a>            <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_adjust_window</span><span class="o">.</span><span class="n">show</span><span class="p">(),</span>
</span><span id="ValveTestWindow.create_valve_test_table-519"><a href="#ValveTestWindow.create_valve_test_table-519"><span class="linenos">519</span></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;light blue&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-520"><a href="#ValveTestWindow.create_valve_test_table-520"><span class="linenos">520</span></a>            <span class="n">highlightbackground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-521"><a href="#ValveTestWindow.create_valve_test_table-521"><span class="linenos">521</span></a>            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-522"><a href="#ValveTestWindow.create_valve_test_table-522"><span class="linenos">522</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-523"><a href="#ValveTestWindow.create_valve_test_table-523"><span class="linenos">523</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-524"><a href="#ValveTestWindow.create_valve_test_table-524"><span class="linenos">524</span></a>        <span class="n">button</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-525"><a href="#ValveTestWindow.create_valve_test_table-525"><span class="linenos">525</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-526"><a href="#ValveTestWindow.create_valve_test_table-526"><span class="linenos">526</span></a>        <span class="c1"># Configure the columns</span>
</span><span id="ValveTestWindow.create_valve_test_table-527"><a href="#ValveTestWindow.create_valve_test_table-527"><span class="linenos">527</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]:</span>
</span><span id="ValveTestWindow.create_valve_test_table-528"><a href="#ValveTestWindow.create_valve_test_table-528"><span class="linenos">528</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-529"><a href="#ValveTestWindow.create_valve_test_table-529"><span class="linenos">529</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-530"><a href="#ValveTestWindow.create_valve_test_table-530"><span class="linenos">530</span></a>        <span class="n">arduino_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino_data</span>
</span><span id="ValveTestWindow.create_valve_test_table-531"><a href="#ValveTestWindow.create_valve_test_table-531"><span class="linenos">531</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-532"><a href="#ValveTestWindow.create_valve_test_table-532"><span class="linenos">532</span></a>        <span class="n">side_one_durations</span><span class="p">,</span> <span class="n">side_two_durations</span><span class="p">,</span> <span class="n">date_used</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-533"><a href="#ValveTestWindow.create_valve_test_table-533"><span class="linenos">533</span></a>            <span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow.create_valve_test_table-534"><a href="#ValveTestWindow.create_valve_test_table-534"><span class="linenos">534</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-535"><a href="#ValveTestWindow.create_valve_test_table-535"><span class="linenos">535</span></a>
</span><span id="ValveTestWindow.create_valve_test_table-536"><a href="#ValveTestWindow.create_valve_test_table-536"><span class="linenos">536</span></a>        <span class="c1"># insert default entries for each total valve until user selects how many</span>
</span><span id="ValveTestWindow.create_valve_test_table-537"><a href="#ValveTestWindow.create_valve_test_table-537"><span class="linenos">537</span></a>        <span class="c1"># they want to test</span>
</span><span id="ValveTestWindow.create_valve_test_table-538"><a href="#ValveTestWindow.create_valve_test_table-538"><span class="linenos">538</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VALVES_PER_SIDE</span><span class="p">):</span>
</span><span id="ValveTestWindow.create_valve_test_table-539"><a href="#ValveTestWindow.create_valve_test_table-539"><span class="linenos">539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-540"><a href="#ValveTestWindow.create_valve_test_table-540"><span class="linenos">540</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-541"><a href="#ValveTestWindow.create_valve_test_table-541"><span class="linenos">541</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-542"><a href="#ValveTestWindow.create_valve_test_table-542"><span class="linenos">542</span></a>                <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-543"><a href="#ValveTestWindow.create_valve_test_table-543"><span class="linenos">543</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-544"><a href="#ValveTestWindow.create_valve_test_table-544"><span class="linenos">544</span></a>                    <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-545"><a href="#ValveTestWindow.create_valve_test_table-545"><span class="linenos">545</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">side_one_durations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-546"><a href="#ValveTestWindow.create_valve_test_table-546"><span class="linenos">546</span></a>                <span class="p">),</span>
</span><span id="ValveTestWindow.create_valve_test_table-547"><a href="#ValveTestWindow.create_valve_test_table-547"><span class="linenos">547</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.create_valve_test_table-548"><a href="#ValveTestWindow.create_valve_test_table-548"><span class="linenos">548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-549"><a href="#ValveTestWindow.create_valve_test_table-549"><span class="linenos">549</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-550"><a href="#ValveTestWindow.create_valve_test_table-550"><span class="linenos">550</span></a>                <span class="n">i</span> <span class="o">+</span> <span class="n">VALVES_PER_SIDE</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-551"><a href="#ValveTestWindow.create_valve_test_table-551"><span class="linenos">551</span></a>                <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="ValveTestWindow.create_valve_test_table-552"><a href="#ValveTestWindow.create_valve_test_table-552"><span class="linenos">552</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">VALVES_PER_SIDE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-553"><a href="#ValveTestWindow.create_valve_test_table-553"><span class="linenos">553</span></a>                    <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-554"><a href="#ValveTestWindow.create_valve_test_table-554"><span class="linenos">554</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">side_two_durations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.create_valve_test_table-555"><a href="#ValveTestWindow.create_valve_test_table-555"><span class="linenos">555</span></a>                <span class="p">),</span>
</span><span id="ValveTestWindow.create_valve_test_table-556"><a href="#ValveTestWindow.create_valve_test_table-556"><span class="linenos">556</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates, configures, and populates the initial state of the ttk.Treeview table.</p>

<p>Sets up the table columns ("Valve", "Amount Dispensed...", "Testing Opening Time...").
Adds a button above the table to open the <code>ManualTimeAdjustment</code> window.</p>

<p>Loads the currently selected valve durations from <code>models.arduino_data.ArduinoData</code>.
Inserts initial rows for all possible valves, marking them as "Test Not Complete"
and displaying their current duration. Stores row IDs in <code>self.table_entries</code> for later access.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.update_table_entry_test_status" class="classattr">
                                        <input id="ValveTestWindow.update_table_entry_test_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_table_entry_test_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">valve</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">l_per_lick</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.update_table_entry_test_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.update_table_entry_test_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.update_table_entry_test_status-558"><a href="#ValveTestWindow.update_table_entry_test_status-558"><span class="linenos">558</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_table_entry_test_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valve</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">l_per_lick</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-559"><a href="#ValveTestWindow.update_table_entry_test_status-559"><span class="linenos">559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-560"><a href="#ValveTestWindow.update_table_entry_test_status-560"><span class="linenos">560</span></a><span class="sd">        Updates the &#39;Amount Dispensed Per Lick (ul)&#39; column for a specific valve row.</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-561"><a href="#ValveTestWindow.update_table_entry_test_status-561"><span class="linenos">561</span></a>
</span><span id="ValveTestWindow.update_table_entry_test_status-562"><a href="#ValveTestWindow.update_table_entry_test_status-562"><span class="linenos">562</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-563"><a href="#ValveTestWindow.update_table_entry_test_status-563"><span class="linenos">563</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-564"><a href="#ValveTestWindow.update_table_entry_test_status-564"><span class="linenos">564</span></a><span class="sd">        - **valve** (*int*): The 1-indexed valve number whose row needs updating.</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-565"><a href="#ValveTestWindow.update_table_entry_test_status-565"><span class="linenos">565</span></a><span class="sd">        - **l_per_lick** (*float*): The calculated volume dispensed per lick in milliliters (mL).</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-566"><a href="#ValveTestWindow.update_table_entry_test_status-566"><span class="linenos">566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-567"><a href="#ValveTestWindow.update_table_entry_test_status-567"><span class="linenos">567</span></a>
</span><span id="ValveTestWindow.update_table_entry_test_status-568"><a href="#ValveTestWindow.update_table_entry_test_status-568"><span class="linenos">568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-569"><a href="#ValveTestWindow.update_table_entry_test_status-569"><span class="linenos">569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l_per_lick</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2"> uL&quot;</span>
</span><span id="ValveTestWindow.update_table_entry_test_status-570"><a href="#ValveTestWindow.update_table_entry_test_status-570"><span class="linenos">570</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Updates the 'Amount Dispensed Per Lick (ul)' column for a specific valve row.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>valve</strong> (<em>int</em>): The 1-indexed valve number whose row needs updating.</li>
<li><strong>l_per_lick</strong> (<em>float</em>): The calculated volume dispensed per lick in milliliters (mL).</li>
</ul>
</div>


                            </div>
                            <div id="ValveTestWindow.update_table_entries" class="classattr">
                                        <input id="ValveTestWindow.update_table_entries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_table_entries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.update_table_entries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.update_table_entries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.update_table_entries-572"><a href="#ValveTestWindow.update_table_entries-572"><span class="linenos">572</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_table_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.update_table_entries-573"><a href="#ValveTestWindow.update_table_entries-573"><span class="linenos">573</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.update_table_entries-574"><a href="#ValveTestWindow.update_table_entries-574"><span class="linenos">574</span></a><span class="sd">        Refreshes the entire valve test table based on current selections and durations.</span>
</span><span id="ValveTestWindow.update_table_entries-575"><a href="#ValveTestWindow.update_table_entries-575"><span class="linenos">575</span></a>
</span><span id="ValveTestWindow.update_table_entries-576"><a href="#ValveTestWindow.update_table_entries-576"><span class="linenos">576</span></a><span class="sd">        Hides rows for unselected valves and shows rows for selected valves.</span>
</span><span id="ValveTestWindow.update_table_entries-577"><a href="#ValveTestWindow.update_table_entries-577"><span class="linenos">577</span></a><span class="sd">        Reloads the latest durations from `ArduinoData` and updates the</span>
</span><span id="ValveTestWindow.update_table_entries-578"><a href="#ValveTestWindow.update_table_entries-578"><span class="linenos">578</span></a><span class="sd">        &#39;Testing Opening Time&#39; column for all visible rows. Resets the</span>
</span><span id="ValveTestWindow.update_table_entries-579"><a href="#ValveTestWindow.update_table_entries-579"><span class="linenos">579</span></a><span class="sd">        &#39;Amount Dispensed&#39; column to &quot;Test Not Complete&quot; for visible rows.</span>
</span><span id="ValveTestWindow.update_table_entries-580"><a href="#ValveTestWindow.update_table_entries-580"><span class="linenos">580</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.update_table_entries-581"><a href="#ValveTestWindow.update_table_entries-581"><span class="linenos">581</span></a>        <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow.update_table_entries-582"><a href="#ValveTestWindow.update_table_entries-582"><span class="linenos">582</span></a>        <span class="c1"># np array where the entry is not zero but the valve number itself</span>
</span><span id="ValveTestWindow.update_table_entries-583"><a href="#ValveTestWindow.update_table_entries-583"><span class="linenos">583</span></a>        <span class="n">selected_valves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="ValveTestWindow.update_table_entries-584"><a href="#ValveTestWindow.update_table_entries-584"><span class="linenos">584</span></a>
</span><span id="ValveTestWindow.update_table_entries-585"><a href="#ValveTestWindow.update_table_entries-585"><span class="linenos">585</span></a>        <span class="c1"># for all valve numbers, if that number is in selected_valves -1 (the entire array</span>
</span><span id="ValveTestWindow.update_table_entries-586"><a href="#ValveTestWindow.update_table_entries-586"><span class="linenos">586</span></a>        <span class="c1"># decremented by one) place it in the table and ensure its duration is up-to-date</span>
</span><span id="ValveTestWindow.update_table_entries-587"><a href="#ValveTestWindow.update_table_entries-587"><span class="linenos">587</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TOTAL_VALVES</span><span class="p">):</span>
</span><span id="ValveTestWindow.update_table_entries-588"><a href="#ValveTestWindow.update_table_entries-588"><span class="linenos">588</span></a>            <span class="c1"># if the iter number is also contained in the selected valves arr</span>
</span><span id="ValveTestWindow.update_table_entries-589"><a href="#ValveTestWindow.update_table_entries-589"><span class="linenos">589</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">selected_valves</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="ValveTestWindow.update_table_entries-590"><a href="#ValveTestWindow.update_table_entries-590"><span class="linenos">590</span></a>                <span class="c1"># check if it&#39;s side two or side one</span>
</span><span id="ValveTestWindow.update_table_entries-591"><a href="#ValveTestWindow.update_table_entries-591"><span class="linenos">591</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">VALVES_PER_SIDE</span><span class="p">:</span>
</span><span id="ValveTestWindow.update_table_entries-592"><a href="#ValveTestWindow.update_table_entries-592"><span class="linenos">592</span></a>                    <span class="n">duration</span> <span class="o">=</span> <span class="n">side_two</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">VALVES_PER_SIDE</span><span class="p">]</span>
</span><span id="ValveTestWindow.update_table_entries-593"><a href="#ValveTestWindow.update_table_entries-593"><span class="linenos">593</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.update_table_entries-594"><a href="#ValveTestWindow.update_table_entries-594"><span class="linenos">594</span></a>                    <span class="n">duration</span> <span class="o">=</span> <span class="n">side_one</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ValveTestWindow.update_table_entries-595"><a href="#ValveTestWindow.update_table_entries-595"><span class="linenos">595</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
</span><span id="ValveTestWindow.update_table_entries-596"><a href="#ValveTestWindow.update_table_entries-596"><span class="linenos">596</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="ValveTestWindow.update_table_entries-597"><a href="#ValveTestWindow.update_table_entries-597"><span class="linenos">597</span></a>                    <span class="n">values</span><span class="o">=</span><span class="p">(</span>
</span><span id="ValveTestWindow.update_table_entries-598"><a href="#ValveTestWindow.update_table_entries-598"><span class="linenos">598</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.update_table_entries-599"><a href="#ValveTestWindow.update_table_entries-599"><span class="linenos">599</span></a>                        <span class="s2">&quot;Test Not Complete&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.update_table_entries-600"><a href="#ValveTestWindow.update_table_entries-600"><span class="linenos">600</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.update_table_entries-601"><a href="#ValveTestWindow.update_table_entries-601"><span class="linenos">601</span></a>                    <span class="p">),</span>
</span><span id="ValveTestWindow.update_table_entries-602"><a href="#ValveTestWindow.update_table_entries-602"><span class="linenos">602</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow.update_table_entries-603"><a href="#ValveTestWindow.update_table_entries-603"><span class="linenos">603</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">reattach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ValveTestWindow.update_table_entries-604"><a href="#ValveTestWindow.update_table_entries-604"><span class="linenos">604</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.update_table_entries-605"><a href="#ValveTestWindow.update_table_entries-605"><span class="linenos">605</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">valve_table</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_entries</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="ValveTestWindow.update_table_entries-606"><a href="#ValveTestWindow.update_table_entries-606"><span class="linenos">606</span></a>
</span><span id="ValveTestWindow.update_table_entries-607"><a href="#ValveTestWindow.update_table_entries-607"><span class="linenos">607</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Valve test table updated.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Refreshes the entire valve test table based on current selections and durations.</p>

<p>Hides rows for unselected valves and shows rows for selected valves.
Reloads the latest durations from <code>ArduinoData</code> and updates the
'Testing Opening Time' column for all visible rows. Resets the
'Amount Dispensed' column to "Test Not Complete" for visible rows.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.toggle_valve_button" class="classattr">
                                        <input id="ValveTestWindow.toggle_valve_button-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">toggle_valve_button</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">button</span><span class="p">:</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Button</span>, </span><span class="param"><span class="n">valve_num</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.toggle_valve_button-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.toggle_valve_button"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.toggle_valve_button-609"><a href="#ValveTestWindow.toggle_valve_button-609"><span class="linenos">609</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_valve_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span> <span class="n">valve_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.toggle_valve_button-610"><a href="#ValveTestWindow.toggle_valve_button-610"><span class="linenos">610</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.toggle_valve_button-611"><a href="#ValveTestWindow.toggle_valve_button-611"><span class="linenos">611</span></a><span class="sd">        Handles the click event for a valve selection button.</span>
</span><span id="ValveTestWindow.toggle_valve_button-612"><a href="#ValveTestWindow.toggle_valve_button-612"><span class="linenos">612</span></a>
</span><span id="ValveTestWindow.toggle_valve_button-613"><a href="#ValveTestWindow.toggle_valve_button-613"><span class="linenos">613</span></a><span class="sd">        Toggles the button&#39;s visual state (raised/sunken). Updates the</span>
</span><span id="ValveTestWindow.toggle_valve_button-614"><a href="#ValveTestWindow.toggle_valve_button-614"><span class="linenos">614</span></a><span class="sd">        corresponding entry in the `self.valve_selections` numpy array (0 for</span>
</span><span id="ValveTestWindow.toggle_valve_button-615"><a href="#ValveTestWindow.toggle_valve_button-615"><span class="linenos">615</span></a><span class="sd">        deselected, valve_number + 1 for selected). Calls `update_table_entries`</span>
</span><span id="ValveTestWindow.toggle_valve_button-616"><a href="#ValveTestWindow.toggle_valve_button-616"><span class="linenos">616</span></a><span class="sd">        to refresh the table display. Filling arrays this way allows us to tell</span>
</span><span id="ValveTestWindow.toggle_valve_button-617"><a href="#ValveTestWindow.toggle_valve_button-617"><span class="linenos">617</span></a><span class="sd">        the arduino exactly which valves should be toggled (1, 4, 7) as long as</span>
</span><span id="ValveTestWindow.toggle_valve_button-618"><a href="#ValveTestWindow.toggle_valve_button-618"><span class="linenos">618</span></a><span class="sd">        their value in the array is not 0.</span>
</span><span id="ValveTestWindow.toggle_valve_button-619"><a href="#ValveTestWindow.toggle_valve_button-619"><span class="linenos">619</span></a>
</span><span id="ValveTestWindow.toggle_valve_button-620"><a href="#ValveTestWindow.toggle_valve_button-620"><span class="linenos">620</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.toggle_valve_button-621"><a href="#ValveTestWindow.toggle_valve_button-621"><span class="linenos">621</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.toggle_valve_button-622"><a href="#ValveTestWindow.toggle_valve_button-622"><span class="linenos">622</span></a><span class="sd">        - **button** (*tk.Button*): The specific valve button widget that was clicked.</span>
</span><span id="ValveTestWindow.toggle_valve_button-623"><a href="#ValveTestWindow.toggle_valve_button-623"><span class="linenos">623</span></a><span class="sd">        - **valve_num** (*int*): The 0-indexed number of the valve corresponding to the button.</span>
</span><span id="ValveTestWindow.toggle_valve_button-624"><a href="#ValveTestWindow.toggle_valve_button-624"><span class="linenos">624</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.toggle_valve_button-625"><a href="#ValveTestWindow.toggle_valve_button-625"><span class="linenos">625</span></a>        <span class="c1"># Attempt to get the value to ensure it&#39;s a valid float as expected</span>
</span><span id="ValveTestWindow.toggle_valve_button-626"><a href="#ValveTestWindow.toggle_valve_button-626"><span class="linenos">626</span></a>        <span class="c1"># If successful, call the function to update/create the valve test table</span>
</span><span id="ValveTestWindow.toggle_valve_button-627"><a href="#ValveTestWindow.toggle_valve_button-627"><span class="linenos">627</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ValveTestWindow.toggle_valve_button-628"><a href="#ValveTestWindow.toggle_valve_button-628"><span class="linenos">628</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;sunken&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.toggle_valve_button-629"><a href="#ValveTestWindow.toggle_valve_button-629"><span class="linenos">629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">valve_num</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ValveTestWindow.toggle_valve_button-630"><a href="#ValveTestWindow.toggle_valve_button-630"><span class="linenos">630</span></a>
</span><span id="ValveTestWindow.toggle_valve_button-631"><a href="#ValveTestWindow.toggle_valve_button-631"><span class="linenos">631</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.toggle_valve_button-632"><a href="#ValveTestWindow.toggle_valve_button-632"><span class="linenos">632</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s2">&quot;raised&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.toggle_valve_button-633"><a href="#ValveTestWindow.toggle_valve_button-633"><span class="linenos">633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">valve_num</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ValveTestWindow.toggle_valve_button-634"><a href="#ValveTestWindow.toggle_valve_button-634"><span class="linenos">634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_table_entries</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Handles the click event for a valve selection button.</p>

<p>Toggles the button's visual state (raised/sunken). Updates the
corresponding entry in the <code>self.valve_selections</code> numpy array (0 for
deselected, valve_number + 1 for selected). Calls <code><a href="#ValveTestWindow.update_table_entries">update_table_entries</a></code>
to refresh the table display. Filling arrays this way allows us to tell
the arduino exactly which valves should be toggled (1, 4, 7) as long as
their value in the array is not 0.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>button</strong> (<em>tk.Button</em>): The specific valve button widget that was clicked.</li>
<li><strong>valve_num</strong> (<em>int</em>): The 0-indexed number of the valve corresponding to the button.</li>
</ul>
</div>


                            </div>
                            <div id="ValveTestWindow.verify_variables" class="classattr">
                                        <input id="ValveTestWindow.verify_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">verify_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">original_data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.verify_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.verify_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.verify_variables-636"><a href="#ValveTestWindow.verify_variables-636"><span class="linenos">636</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_variables-637"><a href="#ValveTestWindow.verify_variables-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.verify_variables-638"><a href="#ValveTestWindow.verify_variables-638"><span class="linenos">638</span></a><span class="sd">        Verifies that the Arduino correctly received the test/prime parameters.</span>
</span><span id="ValveTestWindow.verify_variables-639"><a href="#ValveTestWindow.verify_variables-639"><span class="linenos">639</span></a>
</span><span id="ValveTestWindow.verify_variables-640"><a href="#ValveTestWindow.verify_variables-640"><span class="linenos">640</span></a><span class="sd">        Waits for and reads back the schedule lengths and actuation count echoed</span>
</span><span id="ValveTestWindow.verify_variables-641"><a href="#ValveTestWindow.verify_variables-641"><span class="linenos">641</span></a><span class="sd">        by the Arduino. Compares the received bytes with the originally sent data.</span>
</span><span id="ValveTestWindow.verify_variables-642"><a href="#ValveTestWindow.verify_variables-642"><span class="linenos">642</span></a>
</span><span id="ValveTestWindow.verify_variables-643"><a href="#ValveTestWindow.verify_variables-643"><span class="linenos">643</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.verify_variables-644"><a href="#ValveTestWindow.verify_variables-644"><span class="linenos">644</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.verify_variables-645"><a href="#ValveTestWindow.verify_variables-645"><span class="linenos">645</span></a><span class="sd">        - **original_data** (*bytes*): The byte string containing schedule lengths and actuation count originally sent to the Arduino.</span>
</span><span id="ValveTestWindow.verify_variables-646"><a href="#ValveTestWindow.verify_variables-646"><span class="linenos">646</span></a>
</span><span id="ValveTestWindow.verify_variables-647"><a href="#ValveTestWindow.verify_variables-647"><span class="linenos">647</span></a><span class="sd">        Returns</span>
</span><span id="ValveTestWindow.verify_variables-648"><a href="#ValveTestWindow.verify_variables-648"><span class="linenos">648</span></a><span class="sd">        -------</span>
</span><span id="ValveTestWindow.verify_variables-649"><a href="#ValveTestWindow.verify_variables-649"><span class="linenos">649</span></a><span class="sd">        - *bool*: `True` if the received data matches the original data, `False` otherwise (logs error and shows message box on mismatch).</span>
</span><span id="ValveTestWindow.verify_variables-650"><a href="#ValveTestWindow.verify_variables-650"><span class="linenos">650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.verify_variables-651"><a href="#ValveTestWindow.verify_variables-651"><span class="linenos">651</span></a>        <span class="c1"># wait until all data is on the wire ready to be read (4 bytes),</span>
</span><span id="ValveTestWindow.verify_variables-652"><a href="#ValveTestWindow.verify_variables-652"><span class="linenos">652</span></a>        <span class="c1"># then read it all in quick succession</span>
</span><span id="ValveTestWindow.verify_variables-653"><a href="#ValveTestWindow.verify_variables-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_variables-654"><a href="#ValveTestWindow.verify_variables-654"><span class="linenos">654</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow.verify_variables-655"><a href="#ValveTestWindow.verify_variables-655"><span class="linenos">655</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_variables-656"><a href="#ValveTestWindow.verify_variables-656"><span class="linenos">656</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_variables-657"><a href="#ValveTestWindow.verify_variables-657"><span class="linenos">657</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ValveTestWindow.verify_variables-658"><a href="#ValveTestWindow.verify_variables-658"><span class="linenos">658</span></a>
</span><span id="ValveTestWindow.verify_variables-659"><a href="#ValveTestWindow.verify_variables-659"><span class="linenos">659</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_variables-660"><a href="#ValveTestWindow.verify_variables-660"><span class="linenos">660</span></a>            <span class="k">pass</span>
</span><span id="ValveTestWindow.verify_variables-661"><a href="#ValveTestWindow.verify_variables-661"><span class="linenos">661</span></a>
</span><span id="ValveTestWindow.verify_variables-662"><a href="#ValveTestWindow.verify_variables-662"><span class="linenos">662</span></a>        <span class="n">ver_len_sched_sd_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ValveTestWindow.verify_variables-663"><a href="#ValveTestWindow.verify_variables-663"><span class="linenos">663</span></a>        <span class="n">ver_len_sched_sd_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ValveTestWindow.verify_variables-664"><a href="#ValveTestWindow.verify_variables-664"><span class="linenos">664</span></a>
</span><span id="ValveTestWindow.verify_variables-665"><a href="#ValveTestWindow.verify_variables-665"><span class="linenos">665</span></a>        <span class="n">ver_valve_act_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_variables-666"><a href="#ValveTestWindow.verify_variables-666"><span class="linenos">666</span></a>
</span><span id="ValveTestWindow.verify_variables-667"><a href="#ValveTestWindow.verify_variables-667"><span class="linenos">667</span></a>        <span class="n">verification_data</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ValveTestWindow.verify_variables-668"><a href="#ValveTestWindow.verify_variables-668"><span class="linenos">668</span></a>            <span class="n">ver_len_sched_sd_one</span> <span class="o">+</span> <span class="n">ver_len_sched_sd_two</span> <span class="o">+</span> <span class="n">ver_valve_act_time</span>
</span><span id="ValveTestWindow.verify_variables-669"><a href="#ValveTestWindow.verify_variables-669"><span class="linenos">669</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.verify_variables-670"><a href="#ValveTestWindow.verify_variables-670"><span class="linenos">670</span></a>        <span class="k">if</span> <span class="n">verification_data</span> <span class="o">==</span> <span class="n">original_data</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_variables-671"><a href="#ValveTestWindow.verify_variables-671"><span class="linenos">671</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====VERIFIED TEST VARIABLES====&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_variables-672"><a href="#ValveTestWindow.verify_variables-672"><span class="linenos">672</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ValveTestWindow.verify_variables-673"><a href="#ValveTestWindow.verify_variables-673"><span class="linenos">673</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_variables-674"><a href="#ValveTestWindow.verify_variables-674"><span class="linenos">674</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT VARIABLES DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow.verify_variables-675"><a href="#ValveTestWindow.verify_variables-675"><span class="linenos">675</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_variables-676"><a href="#ValveTestWindow.verify_variables-676"><span class="linenos">676</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_variables-677"><a href="#ValveTestWindow.verify_variables-677"><span class="linenos">677</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Verifies that the Arduino correctly received the test/prime parameters.</p>

<p>Waits for and reads back the schedule lengths and actuation count echoed
by the Arduino. Compares the received bytes with the originally sent data.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>original_data</strong> (<em>bytes</em>): The byte string containing schedule lengths and actuation count originally sent to the Arduino.</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li><em>bool</em>: <code>True</code> if the received data matches the original data, <code>False</code> otherwise (logs error and shows message box on mismatch).</li>
</ul>
</div>


                            </div>
                            <div id="ValveTestWindow.verify_schedule" class="classattr">
                                        <input id="ValveTestWindow.verify_schedule-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">verify_schedule</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">len_sched</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">sent_schedule</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.verify_schedule-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.verify_schedule"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.verify_schedule-679"><a href="#ValveTestWindow.verify_schedule-679"><span class="linenos">679</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_schedule</span><span class="p">(</span>
</span><span id="ValveTestWindow.verify_schedule-680"><a href="#ValveTestWindow.verify_schedule-680"><span class="linenos">680</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">len_sched</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sent_schedule</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">]</span>
</span><span id="ValveTestWindow.verify_schedule-681"><a href="#ValveTestWindow.verify_schedule-681"><span class="linenos">681</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_schedule-682"><a href="#ValveTestWindow.verify_schedule-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.verify_schedule-683"><a href="#ValveTestWindow.verify_schedule-683"><span class="linenos">683</span></a><span class="sd">        Verifies that the Arduino correctly received the valve schedule.</span>
</span><span id="ValveTestWindow.verify_schedule-684"><a href="#ValveTestWindow.verify_schedule-684"><span class="linenos">684</span></a>
</span><span id="ValveTestWindow.verify_schedule-685"><a href="#ValveTestWindow.verify_schedule-685"><span class="linenos">685</span></a><span class="sd">        Waits for and reads back the valve numbers (0-indexed) echoed byte-by-byte</span>
</span><span id="ValveTestWindow.verify_schedule-686"><a href="#ValveTestWindow.verify_schedule-686"><span class="linenos">686</span></a><span class="sd">        by the Arduino. Compares the reconstructed numpy array with the schedule</span>
</span><span id="ValveTestWindow.verify_schedule-687"><a href="#ValveTestWindow.verify_schedule-687"><span class="linenos">687</span></a><span class="sd">        that was originally sent.</span>
</span><span id="ValveTestWindow.verify_schedule-688"><a href="#ValveTestWindow.verify_schedule-688"><span class="linenos">688</span></a>
</span><span id="ValveTestWindow.verify_schedule-689"><a href="#ValveTestWindow.verify_schedule-689"><span class="linenos">689</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.verify_schedule-690"><a href="#ValveTestWindow.verify_schedule-690"><span class="linenos">690</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.verify_schedule-691"><a href="#ValveTestWindow.verify_schedule-691"><span class="linenos">691</span></a><span class="sd">        - **len_sched** (*int*): The total number of valves in the schedule being sent.</span>
</span><span id="ValveTestWindow.verify_schedule-692"><a href="#ValveTestWindow.verify_schedule-692"><span class="linenos">692</span></a><span class="sd">        - **sent_schedule** (*npt.NDArray[np.int8]*): The numpy array (0-indexed valve numbers) representing the schedule originally sent.</span>
</span><span id="ValveTestWindow.verify_schedule-693"><a href="#ValveTestWindow.verify_schedule-693"><span class="linenos">693</span></a>
</span><span id="ValveTestWindow.verify_schedule-694"><a href="#ValveTestWindow.verify_schedule-694"><span class="linenos">694</span></a><span class="sd">        Returns</span>
</span><span id="ValveTestWindow.verify_schedule-695"><a href="#ValveTestWindow.verify_schedule-695"><span class="linenos">695</span></a><span class="sd">        -------</span>
</span><span id="ValveTestWindow.verify_schedule-696"><a href="#ValveTestWindow.verify_schedule-696"><span class="linenos">696</span></a><span class="sd">        - *bool*: `True` if the received schedule matches the sent schedule, `False` otherwise (logs error and shows message box on mismatch).</span>
</span><span id="ValveTestWindow.verify_schedule-697"><a href="#ValveTestWindow.verify_schedule-697"><span class="linenos">697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.verify_schedule-698"><a href="#ValveTestWindow.verify_schedule-698"><span class="linenos">698</span></a>        <span class="c1"># np array used for verification later</span>
</span><span id="ValveTestWindow.verify_schedule-699"><a href="#ValveTestWindow.verify_schedule-699"><span class="linenos">699</span></a>        <span class="n">received_sched</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">len_sched</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-700"><a href="#ValveTestWindow.verify_schedule-700"><span class="linenos">700</span></a>
</span><span id="ValveTestWindow.verify_schedule-701"><a href="#ValveTestWindow.verify_schedule-701"><span class="linenos">701</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_schedule-702"><a href="#ValveTestWindow.verify_schedule-702"><span class="linenos">702</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow.verify_schedule-703"><a href="#ValveTestWindow.verify_schedule-703"><span class="linenos">703</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-704"><a href="#ValveTestWindow.verify_schedule-704"><span class="linenos">704</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-705"><a href="#ValveTestWindow.verify_schedule-705"><span class="linenos">705</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ValveTestWindow.verify_schedule-706"><a href="#ValveTestWindow.verify_schedule-706"><span class="linenos">706</span></a>
</span><span id="ValveTestWindow.verify_schedule-707"><a href="#ValveTestWindow.verify_schedule-707"><span class="linenos">707</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&lt;</span> <span class="n">len_sched</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_schedule-708"><a href="#ValveTestWindow.verify_schedule-708"><span class="linenos">708</span></a>            <span class="k">pass</span>
</span><span id="ValveTestWindow.verify_schedule-709"><a href="#ValveTestWindow.verify_schedule-709"><span class="linenos">709</span></a>
</span><span id="ValveTestWindow.verify_schedule-710"><a href="#ValveTestWindow.verify_schedule-710"><span class="linenos">710</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_sched</span><span class="p">):</span>
</span><span id="ValveTestWindow.verify_schedule-711"><a href="#ValveTestWindow.verify_schedule-711"><span class="linenos">711</span></a>            <span class="n">received_sched</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
</span><span id="ValveTestWindow.verify_schedule-712"><a href="#ValveTestWindow.verify_schedule-712"><span class="linenos">712</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span>
</span><span id="ValveTestWindow.verify_schedule-713"><a href="#ValveTestWindow.verify_schedule-713"><span class="linenos">713</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-714"><a href="#ValveTestWindow.verify_schedule-714"><span class="linenos">714</span></a>
</span><span id="ValveTestWindow.verify_schedule-715"><a href="#ValveTestWindow.verify_schedule-715"><span class="linenos">715</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">received_sched</span><span class="p">,</span> <span class="n">sent_schedule</span><span class="p">):</span>
</span><span id="ValveTestWindow.verify_schedule-716"><a href="#ValveTestWindow.verify_schedule-716"><span class="linenos">716</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;===TESTING SCHEDULE VERIFIED as ==&gt; </span><span class="si">{</span><span class="n">received_sched</span><span class="si">}</span><span class="s2">===&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-717"><a href="#ValveTestWindow.verify_schedule-717"><span class="linenos">717</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====================BEGIN TESTING NOW====================&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-718"><a href="#ValveTestWindow.verify_schedule-718"><span class="linenos">718</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ValveTestWindow.verify_schedule-719"><a href="#ValveTestWindow.verify_schedule-719"><span class="linenos">719</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.verify_schedule-720"><a href="#ValveTestWindow.verify_schedule-720"><span class="linenos">720</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;====INCORRECT SCHEDULE DETECTED, TRY AGAIN====&quot;</span>
</span><span id="ValveTestWindow.verify_schedule-721"><a href="#ValveTestWindow.verify_schedule-721"><span class="linenos">721</span></a>            <span class="n">GUIUtils</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="s2">&quot;TRANSMISSION ERROR&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-722"><a href="#ValveTestWindow.verify_schedule-722"><span class="linenos">722</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="ValveTestWindow.verify_schedule-723"><a href="#ValveTestWindow.verify_schedule-723"><span class="linenos">723</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Verifies that the Arduino correctly received the valve schedule.</p>

<p>Waits for and reads back the valve numbers (0-indexed) echoed byte-by-byte
by the Arduino. Compares the reconstructed numpy array with the schedule
that was originally sent.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>len_sched</strong> (<em>int</em>): The total number of valves in the schedule being sent.</li>
<li><strong>sent_schedule</strong> (<em>npt.NDArray[np.int8]</em>): The numpy array (0-indexed valve numbers) representing the schedule originally sent.</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li><em>bool</em>: <code>True</code> if the received schedule matches the sent schedule, <code>False</code> otherwise (logs error and shows message box on mismatch).</li>
</ul>
</div>


                            </div>
                            <div id="ValveTestWindow.send_schedules" class="classattr">
                                        <input id="ValveTestWindow.send_schedules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send_schedules</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.send_schedules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.send_schedules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.send_schedules-725"><a href="#ValveTestWindow.send_schedules-725"><span class="linenos">725</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">send_schedules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-726"><a href="#ValveTestWindow.send_schedules-726"><span class="linenos">726</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.send_schedules-727"><a href="#ValveTestWindow.send_schedules-727"><span class="linenos">727</span></a><span class="sd">        Performs the process of sending test or prime configuration to the Arduino.</span>
</span><span id="ValveTestWindow.send_schedules-728"><a href="#ValveTestWindow.send_schedules-728"><span class="linenos">728</span></a>
</span><span id="ValveTestWindow.send_schedules-729"><a href="#ValveTestWindow.send_schedules-729"><span class="linenos">729</span></a><span class="sd">        Determines selected valves and schedule lengths for each side. Sends current</span>
</span><span id="ValveTestWindow.send_schedules-730"><a href="#ValveTestWindow.send_schedules-730"><span class="linenos">730</span></a><span class="sd">        valve durations to Arduino. Then sends the appropriate command (&#39;TEST VOL&#39; or &#39;PRIME VALVES&#39;).</span>
</span><span id="ValveTestWindow.send_schedules-731"><a href="#ValveTestWindow.send_schedules-731"><span class="linenos">731</span></a>
</span><span id="ValveTestWindow.send_schedules-732"><a href="#ValveTestWindow.send_schedules-732"><span class="linenos">732</span></a><span class="sd">        Sends test parameters (schedule lengths, actuations) and verifies them using `verify_variables`.</span>
</span><span id="ValveTestWindow.send_schedules-733"><a href="#ValveTestWindow.send_schedules-733"><span class="linenos">733</span></a><span class="sd">        Sends the actual valve schedule (0-indexed) and verifies it using `verify_schedule`.</span>
</span><span id="ValveTestWindow.send_schedules-734"><a href="#ValveTestWindow.send_schedules-734"><span class="linenos">734</span></a>
</span><span id="ValveTestWindow.send_schedules-735"><a href="#ValveTestWindow.send_schedules-735"><span class="linenos">735</span></a><span class="sd">        User is then prompted to confirm before proceeding.</span>
</span><span id="ValveTestWindow.send_schedules-736"><a href="#ValveTestWindow.send_schedules-736"><span class="linenos">736</span></a><span class="sd">        If confirmed, initiates the test/prime sequence on the Arduino</span>
</span><span id="ValveTestWindow.send_schedules-737"><a href="#ValveTestWindow.send_schedules-737"><span class="linenos">737</span></a><span class="sd">        and starts the listener thread (`run_test`) if Testing, or sends start command if Priming.</span>
</span><span id="ValveTestWindow.send_schedules-738"><a href="#ValveTestWindow.send_schedules-738"><span class="linenos">738</span></a><span class="sd">        Updates button states accordingly.</span>
</span><span id="ValveTestWindow.send_schedules-739"><a href="#ValveTestWindow.send_schedules-739"><span class="linenos">739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.send_schedules-740"><a href="#ValveTestWindow.send_schedules-740"><span class="linenos">740</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[:</span><span class="n">VALVES_PER_SIDE</span><span class="p">])</span>
</span><span id="ValveTestWindow.send_schedules-741"><a href="#ValveTestWindow.send_schedules-741"><span class="linenos">741</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="n">VALVES_PER_SIDE</span><span class="p">:])</span>
</span><span id="ValveTestWindow.send_schedules-742"><a href="#ValveTestWindow.send_schedules-742"><span class="linenos">742</span></a>
</span><span id="ValveTestWindow.send_schedules-743"><a href="#ValveTestWindow.send_schedules-743"><span class="linenos">743</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="n">len_sched_one</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-744"><a href="#ValveTestWindow.send_schedules-744"><span class="linenos">744</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="n">len_sched_two</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-745"><a href="#ValveTestWindow.send_schedules-745"><span class="linenos">745</span></a>        <span class="n">len_sched</span> <span class="o">=</span> <span class="n">len_sched_one</span> <span class="o">+</span> <span class="n">len_sched_two</span>
</span><span id="ValveTestWindow.send_schedules-746"><a href="#ValveTestWindow.send_schedules-746"><span class="linenos">746</span></a>
</span><span id="ValveTestWindow.send_schedules-747"><a href="#ValveTestWindow.send_schedules-747"><span class="linenos">747</span></a>        <span class="c1"># because self.actuations is a IntVar, we use .get() method to get its value</span>
</span><span id="ValveTestWindow.send_schedules-748"><a href="#ValveTestWindow.send_schedules-748"><span class="linenos">748</span></a>        <span class="n">valve_acuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</span><span id="ValveTestWindow.send_schedules-749"><a href="#ValveTestWindow.send_schedules-749"><span class="linenos">749</span></a>
</span><span id="ValveTestWindow.send_schedules-750"><a href="#ValveTestWindow.send_schedules-750"><span class="linenos">750</span></a>        <span class="c1"># schedule is TOTAL_VALVES long to accomodate testing of up to all valves at one time.</span>
</span><span id="ValveTestWindow.send_schedules-751"><a href="#ValveTestWindow.send_schedules-751"><span class="linenos">751</span></a>        <span class="c1"># if we are not testing them all, filter out the zero entries (valves we are not testing)</span>
</span><span id="ValveTestWindow.send_schedules-752"><a href="#ValveTestWindow.send_schedules-752"><span class="linenos">752</span></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_selections</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="ValveTestWindow.send_schedules-753"><a href="#ValveTestWindow.send_schedules-753"><span class="linenos">753</span></a>
</span><span id="ValveTestWindow.send_schedules-754"><a href="#ValveTestWindow.send_schedules-754"><span class="linenos">754</span></a>        <span class="c1"># decrement each element in the array by one to move to zero-indexing. We moved to 1</span>
</span><span id="ValveTestWindow.send_schedules-755"><a href="#ValveTestWindow.send_schedules-755"><span class="linenos">755</span></a>        <span class="c1"># indexing becuase using zero indexing does not work with the method of toggling valves</span>
</span><span id="ValveTestWindow.send_schedules-756"><a href="#ValveTestWindow.send_schedules-756"><span class="linenos">756</span></a>        <span class="c1"># defined above</span>
</span><span id="ValveTestWindow.send_schedules-757"><a href="#ValveTestWindow.send_schedules-757"><span class="linenos">757</span></a>        <span class="n">schedule</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ValveTestWindow.send_schedules-758"><a href="#ValveTestWindow.send_schedules-758"><span class="linenos">758</span></a>
</span><span id="ValveTestWindow.send_schedules-759"><a href="#ValveTestWindow.send_schedules-759"><span class="linenos">759</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[:</span><span class="n">len_sched_one</span><span class="p">]</span>
</span><span id="ValveTestWindow.send_schedules-760"><a href="#ValveTestWindow.send_schedules-760"><span class="linenos">760</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="n">len_sched_one</span><span class="p">:]</span>
</span><span id="ValveTestWindow.send_schedules-761"><a href="#ValveTestWindow.send_schedules-761"><span class="linenos">761</span></a>
</span><span id="ValveTestWindow.send_schedules-762"><a href="#ValveTestWindow.send_schedules-762"><span class="linenos">762</span></a>        <span class="n">len_sched_one</span> <span class="o">=</span> <span class="n">len_sched_one</span>
</span><span id="ValveTestWindow.send_schedules-763"><a href="#ValveTestWindow.send_schedules-763"><span class="linenos">763</span></a>        <span class="n">len_sched_two</span> <span class="o">=</span> <span class="n">len_sched_two</span>
</span><span id="ValveTestWindow.send_schedules-764"><a href="#ValveTestWindow.send_schedules-764"><span class="linenos">764</span></a>        <span class="n">valve_acuations</span> <span class="o">=</span> <span class="n">valve_acuations</span>
</span><span id="ValveTestWindow.send_schedules-765"><a href="#ValveTestWindow.send_schedules-765"><span class="linenos">765</span></a>
</span><span id="ValveTestWindow.send_schedules-766"><a href="#ValveTestWindow.send_schedules-766"><span class="linenos">766</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_valve_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-767"><a href="#ValveTestWindow.send_schedules-767"><span class="linenos">767</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-768"><a href="#ValveTestWindow.send_schedules-768"><span class="linenos">768</span></a>            <span class="c1">###====SENDING TEST COMMAND====###</span>
</span><span id="ValveTestWindow.send_schedules-769"><a href="#ValveTestWindow.send_schedules-769"><span class="linenos">769</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;TEST VOL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-770"><a href="#ValveTestWindow.send_schedules-770"><span class="linenos">770</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-771"><a href="#ValveTestWindow.send_schedules-771"><span class="linenos">771</span></a>
</span><span id="ValveTestWindow.send_schedules-772"><a href="#ValveTestWindow.send_schedules-772"><span class="linenos">772</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-773"><a href="#ValveTestWindow.send_schedules-773"><span class="linenos">773</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ValveTestWindow.send_schedules-774"><a href="#ValveTestWindow.send_schedules-774"><span class="linenos">774</span></a>
</span><span id="ValveTestWindow.send_schedules-775"><a href="#ValveTestWindow.send_schedules-775"><span class="linenos">775</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;PRIME VALVES</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-776"><a href="#ValveTestWindow.send_schedules-776"><span class="linenos">776</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-777"><a href="#ValveTestWindow.send_schedules-777"><span class="linenos">777</span></a>
</span><span id="ValveTestWindow.send_schedules-778"><a href="#ValveTestWindow.send_schedules-778"><span class="linenos">778</span></a>        <span class="c1">###====SENDING TEST VARIABLES (len side one, two, num_actuations per test)====###</span>
</span><span id="ValveTestWindow.send_schedules-779"><a href="#ValveTestWindow.send_schedules-779"><span class="linenos">779</span></a>        <span class="n">data_bytes</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ValveTestWindow.send_schedules-780"><a href="#ValveTestWindow.send_schedules-780"><span class="linenos">780</span></a>            <span class="n">len_sched_one</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-781"><a href="#ValveTestWindow.send_schedules-781"><span class="linenos">781</span></a>            <span class="o">+</span> <span class="n">len_sched_two</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-782"><a href="#ValveTestWindow.send_schedules-782"><span class="linenos">782</span></a>            <span class="o">+</span> <span class="n">valve_acuations</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-783"><a href="#ValveTestWindow.send_schedules-783"><span class="linenos">783</span></a>        <span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-784"><a href="#ValveTestWindow.send_schedules-784"><span class="linenos">784</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-785"><a href="#ValveTestWindow.send_schedules-785"><span class="linenos">785</span></a>
</span><span id="ValveTestWindow.send_schedules-786"><a href="#ValveTestWindow.send_schedules-786"><span class="linenos">786</span></a>        <span class="c1"># verify the data</span>
</span><span id="ValveTestWindow.send_schedules-787"><a href="#ValveTestWindow.send_schedules-787"><span class="linenos">787</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_variables</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">):</span>
</span><span id="ValveTestWindow.send_schedules-788"><a href="#ValveTestWindow.send_schedules-788"><span class="linenos">788</span></a>            <span class="k">return</span>
</span><span id="ValveTestWindow.send_schedules-789"><a href="#ValveTestWindow.send_schedules-789"><span class="linenos">789</span></a>
</span><span id="ValveTestWindow.send_schedules-790"><a href="#ValveTestWindow.send_schedules-790"><span class="linenos">790</span></a>        <span class="c1">###====SENDING SCHEDULE====###</span>
</span><span id="ValveTestWindow.send_schedules-791"><a href="#ValveTestWindow.send_schedules-791"><span class="linenos">791</span></a>        <span class="n">sched_data_bytes</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-792"><a href="#ValveTestWindow.send_schedules-792"><span class="linenos">792</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">sched_data_bytes</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-793"><a href="#ValveTestWindow.send_schedules-793"><span class="linenos">793</span></a>
</span><span id="ValveTestWindow.send_schedules-794"><a href="#ValveTestWindow.send_schedules-794"><span class="linenos">794</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_schedule</span><span class="p">(</span><span class="n">len_sched</span><span class="p">,</span> <span class="n">schedule</span><span class="p">):</span>
</span><span id="ValveTestWindow.send_schedules-795"><a href="#ValveTestWindow.send_schedules-795"><span class="linenos">795</span></a>            <span class="k">return</span>
</span><span id="ValveTestWindow.send_schedules-796"><a href="#ValveTestWindow.send_schedules-796"><span class="linenos">796</span></a>
</span><span id="ValveTestWindow.send_schedules-797"><a href="#ValveTestWindow.send_schedules-797"><span class="linenos">797</span></a>        <span class="n">schedule</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ValveTestWindow.send_schedules-798"><a href="#ValveTestWindow.send_schedules-798"><span class="linenos">798</span></a>
</span><span id="ValveTestWindow.send_schedules-799"><a href="#ValveTestWindow.send_schedules-799"><span class="linenos">799</span></a>        <span class="n">valves</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valve</span><span class="p">)</span> <span class="k">for</span> <span class="n">valve</span> <span class="ow">in</span> <span class="n">schedule</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-800"><a href="#ValveTestWindow.send_schedules-800"><span class="linenos">800</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">TESTING</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-801"><a href="#ValveTestWindow.send_schedules-801"><span class="linenos">801</span></a>            <span class="c1">####### ARDUINO HALTS HERE UNTIL THE GO-AHEAD IS GIVEN #######</span>
</span><span id="ValveTestWindow.send_schedules-802"><a href="#ValveTestWindow.send_schedules-802"><span class="linenos">802</span></a>            <span class="c1"># inc each sched element by one so that it is 1-indexes and matches the valve labels</span>
</span><span id="ValveTestWindow.send_schedules-803"><a href="#ValveTestWindow.send_schedules-803"><span class="linenos">803</span></a>            <span class="n">test_confirmed</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span>
</span><span id="ValveTestWindow.send_schedules-804"><a href="#ValveTestWindow.send_schedules-804"><span class="linenos">804</span></a>                <span class="s2">&quot;CONFIRM THE TEST SCHEDULE&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.send_schedules-805"><a href="#ValveTestWindow.send_schedules-805"><span class="linenos">805</span></a>                <span class="sa">f</span><span class="s2">&quot;Valves </span><span class="si">{</span><span class="n">valves</span><span class="si">}</span><span class="s2">, will be tested. Review the test table to confirm schedule and timings. Each valve will be actuated </span><span class="si">{</span><span class="n">valve_acuations</span><span class="si">}</span><span class="s2"> times. Ok to begin?&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.send_schedules-806"><a href="#ValveTestWindow.send_schedules-806"><span class="linenos">806</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-807"><a href="#ValveTestWindow.send_schedules-807"><span class="linenos">807</span></a>
</span><span id="ValveTestWindow.send_schedules-808"><a href="#ValveTestWindow.send_schedules-808"><span class="linenos">808</span></a>            <span class="c1">### include section to manually modify timings</span>
</span><span id="ValveTestWindow.send_schedules-809"><a href="#ValveTestWindow.send_schedules-809"><span class="linenos">809</span></a>            <span class="k">if</span> <span class="n">test_confirmed</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-810"><a href="#ValveTestWindow.send_schedules-810"><span class="linenos">810</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event0&gt;&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testing_complete</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-811"><a href="#ValveTestWindow.send_schedules-811"><span class="linenos">811</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event1&gt;&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_input</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-812"><a href="#ValveTestWindow.send_schedules-812"><span class="linenos">812</span></a>                <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_test</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-813"><a href="#ValveTestWindow.send_schedules-813"><span class="linenos">813</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-814"><a href="#ValveTestWindow.send_schedules-814"><span class="linenos">814</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-815"><a href="#ValveTestWindow.send_schedules-815"><span class="linenos">815</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_mode</span> <span class="o">==</span> <span class="n">WindowMode</span><span class="o">.</span><span class="n">PRIMING</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-816"><a href="#ValveTestWindow.send_schedules-816"><span class="linenos">816</span></a>            <span class="n">priming_confirmed</span> <span class="o">=</span> <span class="n">GUIUtils</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span>
</span><span id="ValveTestWindow.send_schedules-817"><a href="#ValveTestWindow.send_schedules-817"><span class="linenos">817</span></a>                <span class="s2">&quot;CONFIRM THE ACTION&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.send_schedules-818"><a href="#ValveTestWindow.send_schedules-818"><span class="linenos">818</span></a>                <span class="sa">f</span><span class="s2">&quot;Valves </span><span class="si">{</span><span class="n">valves</span><span class="si">}</span><span class="s2">, will be primed (opened and closed) </span><span class="si">{</span><span class="n">valve_acuations</span><span class="si">}</span><span class="s2"> times. Ok to begin?&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.send_schedules-819"><a href="#ValveTestWindow.send_schedules-819"><span class="linenos">819</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-820"><a href="#ValveTestWindow.send_schedules-820"><span class="linenos">820</span></a>            <span class="k">if</span> <span class="n">priming_confirmed</span><span class="p">:</span>
</span><span id="ValveTestWindow.send_schedules-821"><a href="#ValveTestWindow.send_schedules-821"><span class="linenos">821</span></a>                <span class="c1"># in case of prime, we send 0 to mean continue or start</span>
</span><span id="ValveTestWindow.send_schedules-822"><a href="#ValveTestWindow.send_schedules-822"><span class="linenos">822</span></a>                <span class="c1"># and we send a 1 at any point to abort or cancel the prime</span>
</span><span id="ValveTestWindow.send_schedules-823"><a href="#ValveTestWindow.send_schedules-823"><span class="linenos">823</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.send_schedules-824"><a href="#ValveTestWindow.send_schedules-824"><span class="linenos">824</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
</span><span id="ValveTestWindow.send_schedules-825"><a href="#ValveTestWindow.send_schedules-825"><span class="linenos">825</span></a>
</span><span id="ValveTestWindow.send_schedules-826"><a href="#ValveTestWindow.send_schedules-826"><span class="linenos">826</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.send_schedules-827"><a href="#ValveTestWindow.send_schedules-827"><span class="linenos">827</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow.send_schedules-828"><a href="#ValveTestWindow.send_schedules-828"><span class="linenos">828</span></a>                        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;STOP Priming&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.send_schedules-829"><a href="#ValveTestWindow.send_schedules-829"><span class="linenos">829</span></a>                        <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.send_schedules-830"><a href="#ValveTestWindow.send_schedules-830"><span class="linenos">830</span></a>                        <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_priming</span><span class="p">(),</span>
</span><span id="ValveTestWindow.send_schedules-831"><a href="#ValveTestWindow.send_schedules-831"><span class="linenos">831</span></a>                    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs the process of sending test or prime configuration to the Arduino.</p>

<p>Determines selected valves and schedule lengths for each side. Sends current
valve durations to Arduino. Then sends the appropriate command ('TEST VOL' or 'PRIME VALVES').</p>

<p>Sends test parameters (schedule lengths, actuations) and verifies them using <code><a href="#ValveTestWindow.verify_variables">verify_variables</a></code>.
Sends the actual valve schedule (0-indexed) and verifies it using <code><a href="#ValveTestWindow.verify_schedule">verify_schedule</a></code>.</p>

<p>User is then prompted to confirm before proceeding.
If confirmed, initiates the test/prime sequence on the Arduino
and starts the listener thread (<code><a href="#ValveTestWindow.run_test">run_test</a></code>) if Testing, or sends start command if Priming.
Updates button states accordingly.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.stop_priming" class="classattr">
                                        <input id="ValveTestWindow.stop_priming-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_priming</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.stop_priming-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.stop_priming"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.stop_priming-833"><a href="#ValveTestWindow.stop_priming-833"><span class="linenos">833</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop_priming</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.stop_priming-834"><a href="#ValveTestWindow.stop_priming-834"><span class="linenos">834</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.stop_priming-835"><a href="#ValveTestWindow.stop_priming-835"><span class="linenos">835</span></a><span class="sd">        Sends the stop command to the Arduino during a priming sequence.</span>
</span><span id="ValveTestWindow.stop_priming-836"><a href="#ValveTestWindow.stop_priming-836"><span class="linenos">836</span></a>
</span><span id="ValveTestWindow.stop_priming-837"><a href="#ValveTestWindow.stop_priming-837"><span class="linenos">837</span></a><span class="sd">        Sets the `prime_running` flag to False. Updates the prime button state.</span>
</span><span id="ValveTestWindow.stop_priming-838"><a href="#ValveTestWindow.stop_priming-838"><span class="linenos">838</span></a><span class="sd">        Sends a byte representation of 1 (`np.int8(1).tobytes()`) to signal abort to the Arduino.</span>
</span><span id="ValveTestWindow.stop_priming-839"><a href="#ValveTestWindow.stop_priming-839"><span class="linenos">839</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.stop_priming-840"><a href="#ValveTestWindow.stop_priming-840"><span class="linenos">840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prime_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow.stop_priming-841"><a href="#ValveTestWindow.stop_priming-841"><span class="linenos">841</span></a>
</span><span id="ValveTestWindow.stop_priming-842"><a href="#ValveTestWindow.stop_priming-842"><span class="linenos">842</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.stop_priming-843"><a href="#ValveTestWindow.stop_priming-843"><span class="linenos">843</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="ValveTestWindow.stop_priming-844"><a href="#ValveTestWindow.stop_priming-844"><span class="linenos">844</span></a>                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Priming&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.stop_priming-845"><a href="#ValveTestWindow.stop_priming-845"><span class="linenos">845</span></a>                <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;coral&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.stop_priming-846"><a href="#ValveTestWindow.stop_priming-846"><span class="linenos">846</span></a>                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_schedules</span><span class="p">(),</span>
</span><span id="ValveTestWindow.stop_priming-847"><a href="#ValveTestWindow.stop_priming-847"><span class="linenos">847</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.stop_priming-848"><a href="#ValveTestWindow.stop_priming-848"><span class="linenos">848</span></a>
</span><span id="ValveTestWindow.stop_priming-849"><a href="#ValveTestWindow.stop_priming-849"><span class="linenos">849</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.stop_priming-850"><a href="#ValveTestWindow.stop_priming-850"><span class="linenos">850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sends the stop command to the Arduino during a priming sequence.</p>

<p>Sets the <code><a href="#ValveTestWindow.prime_running">prime_running</a></code> flag to False. Updates the prime button state.
Sends a byte representation of 1 (<code>np.int8(1).tobytes()</code>) to signal abort to the Arduino.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.take_input" class="classattr">
                                        <input id="ValveTestWindow.take_input-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">take_input</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">event</span><span class="p">:</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">pair_num_override</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.take_input-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.take_input"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.take_input-852"><a href="#ValveTestWindow.take_input-852"><span class="linenos">852</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">take_input</span><span class="p">(</span>
</span><span id="ValveTestWindow.take_input-853"><a href="#ValveTestWindow.take_input-853"><span class="linenos">853</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pair_num_override</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow.take_input-854"><a href="#ValveTestWindow.take_input-854"><span class="linenos">854</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-855"><a href="#ValveTestWindow.take_input-855"><span class="linenos">855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.take_input-856"><a href="#ValveTestWindow.take_input-856"><span class="linenos">856</span></a><span class="sd">        Prompts the user to enter the dispensed volume for a completed test pair.</span>
</span><span id="ValveTestWindow.take_input-857"><a href="#ValveTestWindow.take_input-857"><span class="linenos">857</span></a>
</span><span id="ValveTestWindow.take_input-858"><a href="#ValveTestWindow.take_input-858"><span class="linenos">858</span></a><span class="sd">        Determines which valve(s) were just tested based on the pair number received</span>
</span><span id="ValveTestWindow.take_input-859"><a href="#ValveTestWindow.take_input-859"><span class="linenos">859</span></a><span class="sd">        from the Arduino (via the event state or override). Uses `simpledialog.askfloat`</span>
</span><span id="ValveTestWindow.take_input-860"><a href="#ValveTestWindow.take_input-860"><span class="linenos">860</span></a><span class="sd">        to get the dispensed volume (in mL) for each valve in the pair. Stores the</span>
</span><span id="ValveTestWindow.take_input-861"><a href="#ValveTestWindow.take_input-861"><span class="linenos">861</span></a><span class="sd">        results in `self.ml_dispensed`.</span>
</span><span id="ValveTestWindow.take_input-862"><a href="#ValveTestWindow.take_input-862"><span class="linenos">862</span></a>
</span><span id="ValveTestWindow.take_input-863"><a href="#ValveTestWindow.take_input-863"><span class="linenos">863</span></a><span class="sd">        Sends a byte back to the Arduino to instruct if further pairs will be tested or if this is the final iteration,</span>
</span><span id="ValveTestWindow.take_input-864"><a href="#ValveTestWindow.take_input-864"><span class="linenos">864</span></a><span class="sd">        (1 if via event, 0 if via override/final pair).</span>
</span><span id="ValveTestWindow.take_input-865"><a href="#ValveTestWindow.take_input-865"><span class="linenos">865</span></a><span class="sd">        Handles potential abort if the user cancels the dialog window.</span>
</span><span id="ValveTestWindow.take_input-866"><a href="#ValveTestWindow.take_input-866"><span class="linenos">866</span></a>
</span><span id="ValveTestWindow.take_input-867"><a href="#ValveTestWindow.take_input-867"><span class="linenos">867</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.take_input-868"><a href="#ValveTestWindow.take_input-868"><span class="linenos">868</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.take_input-869"><a href="#ValveTestWindow.take_input-869"><span class="linenos">869</span></a><span class="sd">        - **event** (*tk.Event | None*): Uses custom thread-safe event (`&lt;&lt;event1&gt;&gt;`) generated by `run_test`, carrying the pair number in `event.state`</span>
</span><span id="ValveTestWindow.take_input-870"><a href="#ValveTestWindow.take_input-870"><span class="linenos">870</span></a><span class="sd">        attribute. This is None if called directly by `testing_complete`, which indicated procedure is now finished.</span>
</span><span id="ValveTestWindow.take_input-871"><a href="#ValveTestWindow.take_input-871"><span class="linenos">871</span></a><span class="sd">        - **pair_num_override** (*int | None, optional*): Allows manually specifying the pair number, used when called from `testing_complete` for the</span>
</span><span id="ValveTestWindow.take_input-872"><a href="#ValveTestWindow.take_input-872"><span class="linenos">872</span></a><span class="sd">        final pair. Defaults to None.</span>
</span><span id="ValveTestWindow.take_input-873"><a href="#ValveTestWindow.take_input-873"><span class="linenos">873</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.take_input-874"><a href="#ValveTestWindow.take_input-874"><span class="linenos">874</span></a>        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-875"><a href="#ValveTestWindow.take_input-875"><span class="linenos">875</span></a>            <span class="n">pair_number</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">state</span>
</span><span id="ValveTestWindow.take_input-876"><a href="#ValveTestWindow.take_input-876"><span class="linenos">876</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-877"><a href="#ValveTestWindow.take_input-877"><span class="linenos">877</span></a>            <span class="n">pair_number</span> <span class="o">=</span> <span class="n">pair_num_override</span>
</span><span id="ValveTestWindow.take_input-878"><a href="#ValveTestWindow.take_input-878"><span class="linenos">878</span></a>
</span><span id="ValveTestWindow.take_input-879"><a href="#ValveTestWindow.take_input-879"><span class="linenos">879</span></a>        <span class="c1"># decide how many valves were tested last. if 0 we will not arrive</span>
</span><span id="ValveTestWindow.take_input-880"><a href="#ValveTestWindow.take_input-880"><span class="linenos">880</span></a>        <span class="c1"># here so we need not test for this.</span>
</span><span id="ValveTestWindow.take_input-881"><a href="#ValveTestWindow.take_input-881"><span class="linenos">881</span></a>        <span class="k">if</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="ValveTestWindow.take_input-882"><a href="#ValveTestWindow.take_input-882"><span class="linenos">882</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span>
</span><span id="ValveTestWindow.take_input-883"><a href="#ValveTestWindow.take_input-883"><span class="linenos">883</span></a>        <span class="p">):</span>
</span><span id="ValveTestWindow.take_input-884"><a href="#ValveTestWindow.take_input-884"><span class="linenos">884</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow.take_input-885"><a href="#ValveTestWindow.take_input-885"><span class="linenos">885</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow.take_input-886"><a href="#ValveTestWindow.take_input-886"><span class="linenos">886</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow.take_input-887"><a href="#ValveTestWindow.take_input-887"><span class="linenos">887</span></a>            <span class="p">]</span>
</span><span id="ValveTestWindow.take_input-888"><a href="#ValveTestWindow.take_input-888"><span class="linenos">888</span></a>        <span class="k">elif</span> <span class="n">pair_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">):</span>
</span><span id="ValveTestWindow.take_input-889"><a href="#ValveTestWindow.take_input-889"><span class="linenos">889</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow.take_input-890"><a href="#ValveTestWindow.take_input-890"><span class="linenos">890</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_one_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow.take_input-891"><a href="#ValveTestWindow.take_input-891"><span class="linenos">891</span></a>            <span class="p">]</span>
</span><span id="ValveTestWindow.take_input-892"><a href="#ValveTestWindow.take_input-892"><span class="linenos">892</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-893"><a href="#ValveTestWindow.take_input-893"><span class="linenos">893</span></a>            <span class="n">valves_tested</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ValveTestWindow.take_input-894"><a href="#ValveTestWindow.take_input-894"><span class="linenos">894</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">side_two_tests</span><span class="p">[</span><span class="n">pair_number</span><span class="p">],</span>
</span><span id="ValveTestWindow.take_input-895"><a href="#ValveTestWindow.take_input-895"><span class="linenos">895</span></a>            <span class="p">]</span>
</span><span id="ValveTestWindow.take_input-896"><a href="#ValveTestWindow.take_input-896"><span class="linenos">896</span></a>
</span><span id="ValveTestWindow.take_input-897"><a href="#ValveTestWindow.take_input-897"><span class="linenos">897</span></a>        <span class="c1"># for each test that we ran store the amount dispensed or abort</span>
</span><span id="ValveTestWindow.take_input-898"><a href="#ValveTestWindow.take_input-898"><span class="linenos">898</span></a>        <span class="k">for</span> <span class="n">valve</span> <span class="ow">in</span> <span class="n">valves_tested</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-899"><a href="#ValveTestWindow.take_input-899"><span class="linenos">899</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">simpledialog</span><span class="o">.</span><span class="n">askfloat</span><span class="p">(</span>
</span><span id="ValveTestWindow.take_input-900"><a href="#ValveTestWindow.take_input-900"><span class="linenos">900</span></a>                <span class="s2">&quot;INPUT AMOUNT DISPENSED&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.take_input-901"><a href="#ValveTestWindow.take_input-901"><span class="linenos">901</span></a>                <span class="sa">f</span><span class="s2">&quot;Please input the amount of liquid dispensed for the test of valve </span><span class="si">{</span><span class="n">valve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.take_input-902"><a href="#ValveTestWindow.take_input-902"><span class="linenos">902</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.take_input-903"><a href="#ValveTestWindow.take_input-903"><span class="linenos">903</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-904"><a href="#ValveTestWindow.take_input-904"><span class="linenos">904</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">abort_test</span><span class="p">()</span>
</span><span id="ValveTestWindow.take_input-905"><a href="#ValveTestWindow.take_input-905"><span class="linenos">905</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-906"><a href="#ValveTestWindow.take_input-906"><span class="linenos">906</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">valve</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
</span><span id="ValveTestWindow.take_input-907"><a href="#ValveTestWindow.take_input-907"><span class="linenos">907</span></a>        <span class="k">if</span> <span class="n">pair_num_override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-908"><a href="#ValveTestWindow.take_input-908"><span class="linenos">908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
</span><span id="ValveTestWindow.take_input-909"><a href="#ValveTestWindow.take_input-909"><span class="linenos">909</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.take_input-910"><a href="#ValveTestWindow.take_input-910"><span class="linenos">910</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Prompts the user to enter the dispensed volume for a completed test pair.</p>

<p>Determines which valve(s) were just tested based on the pair number received
from the Arduino (via the event state or override). Uses <code>simpledialog.askfloat</code>
to get the dispensed volume (in mL) for each valve in the pair. Stores the
results in <code>self.ml_dispensed</code>.</p>

<p>Sends a byte back to the Arduino to instruct if further pairs will be tested or if this is the final iteration,
(1 if via event, 0 if via override/final pair).
Handles potential abort if the user cancels the dialog window.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>event</strong> (<em>tk.Event | None</em>): Uses custom thread-safe event (<code>&lt;&lt;event1&gt;&gt;</code>) generated by <code><a href="#ValveTestWindow.run_test">run_test</a></code>, carrying the pair number in <code>event.state</code>
attribute. This is None if called directly by <code><a href="#ValveTestWindow.testing_complete">testing_complete</a></code>, which indicated procedure is now finished.</li>
<li><strong>pair_num_override</strong> (<em>int | None, optional</em>): Allows manually specifying the pair number, used when called from <code><a href="#ValveTestWindow.testing_complete">testing_complete</a></code> for the
final pair. Defaults to None.</li>
</ul>
</div>


                            </div>
                            <div id="ValveTestWindow.run_test" class="classattr">
                                        <input id="ValveTestWindow.run_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.run_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.run_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.run_test-912"><a href="#ValveTestWindow.run_test-912"><span class="linenos">912</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.run_test-913"><a href="#ValveTestWindow.run_test-913"><span class="linenos">913</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.run_test-914"><a href="#ValveTestWindow.run_test-914"><span class="linenos">914</span></a><span class="sd">        Listens for messages from the Arduino during an active test sequence (runs in a background thread).</span>
</span><span id="ValveTestWindow.run_test-915"><a href="#ValveTestWindow.run_test-915"><span class="linenos">915</span></a>
</span><span id="ValveTestWindow.run_test-916"><a href="#ValveTestWindow.run_test-916"><span class="linenos">916</span></a><span class="sd">        Sends the initial &#39;start test&#39; command byte to the Arduino. Enters a loop</span>
</span><span id="ValveTestWindow.run_test-917"><a href="#ValveTestWindow.run_test-917"><span class="linenos">917</span></a><span class="sd">        that continues as long as `self.test_running` is True and `self.stop_event`</span>
</span><span id="ValveTestWindow.run_test-918"><a href="#ValveTestWindow.run_test-918"><span class="linenos">918</span></a><span class="sd">        is not set. Checks for incoming data from the Arduino. Reads bytes indicating</span>
</span><span id="ValveTestWindow.run_test-919"><a href="#ValveTestWindow.run_test-919"><span class="linenos">919</span></a><span class="sd">        if more tests remain and the number of the just-completed pair. Generates</span>
</span><span id="ValveTestWindow.run_test-920"><a href="#ValveTestWindow.run_test-920"><span class="linenos">920</span></a><span class="sd">        custom Tkinter events (`&lt;&lt;event1&gt;&gt;` for input dispensed liquid prompt, `&lt;&lt;event0&gt;&gt;` for test completion)</span>
</span><span id="ValveTestWindow.run_test-921"><a href="#ValveTestWindow.run_test-921"><span class="linenos">921</span></a><span class="sd">        to communicate back to the main GUI thread safely. Updates the main button state to &#39;ABORT TESTING&#39;.</span>
</span><span id="ValveTestWindow.run_test-922"><a href="#ValveTestWindow.run_test-922"><span class="linenos">922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.run_test-923"><a href="#ValveTestWindow.run_test-923"><span class="linenos">923</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="ValveTestWindow.run_test-924"><a href="#ValveTestWindow.run_test-924"><span class="linenos">924</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ValveTestWindow.run_test-925"><a href="#ValveTestWindow.run_test-925"><span class="linenos">925</span></a>
</span><span id="ValveTestWindow.run_test-926"><a href="#ValveTestWindow.run_test-926"><span class="linenos">926</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.run_test-927"><a href="#ValveTestWindow.run_test-927"><span class="linenos">927</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;ABORT TESTING&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.run_test-928"><a href="#ValveTestWindow.run_test-928"><span class="linenos">928</span></a>
</span><span id="ValveTestWindow.run_test-929"><a href="#ValveTestWindow.run_test-929"><span class="linenos">929</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ValveTestWindow.run_test-930"><a href="#ValveTestWindow.run_test-930"><span class="linenos">930</span></a>        <span class="c1">###====SENDING BEGIN TEST COMMAND====###</span>
</span><span id="ValveTestWindow.run_test-931"><a href="#ValveTestWindow.run_test-931"><span class="linenos">931</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.run_test-932"><a href="#ValveTestWindow.run_test-932"><span class="linenos">932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="ValveTestWindow.run_test-933"><a href="#ValveTestWindow.run_test-933"><span class="linenos">933</span></a>
</span><span id="ValveTestWindow.run_test-934"><a href="#ValveTestWindow.run_test-934"><span class="linenos">934</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span><span class="p">:</span>
</span><span id="ValveTestWindow.run_test-935"><a href="#ValveTestWindow.run_test-935"><span class="linenos">935</span></a>            <span class="c1"># if stop event, shut down the thread</span>
</span><span id="ValveTestWindow.run_test-936"><a href="#ValveTestWindow.run_test-936"><span class="linenos">936</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="ValveTestWindow.run_test-937"><a href="#ValveTestWindow.run_test-937"><span class="linenos">937</span></a>                <span class="k">break</span>
</span><span id="ValveTestWindow.run_test-938"><a href="#ValveTestWindow.run_test-938"><span class="linenos">938</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ValveTestWindow.run_test-939"><a href="#ValveTestWindow.run_test-939"><span class="linenos">939</span></a>                <span class="n">remaining_tests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ValveTestWindow.run_test-940"><a href="#ValveTestWindow.run_test-940"><span class="linenos">940</span></a>                <span class="n">pair_number</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span>
</span><span id="ValveTestWindow.run_test-941"><a href="#ValveTestWindow.run_test-941"><span class="linenos">941</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
</span><span id="ValveTestWindow.run_test-942"><a href="#ValveTestWindow.run_test-942"><span class="linenos">942</span></a>                    <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">,</span>
</span><span id="ValveTestWindow.run_test-943"><a href="#ValveTestWindow.run_test-943"><span class="linenos">943</span></a>                    <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ValveTestWindow.run_test-944"><a href="#ValveTestWindow.run_test-944"><span class="linenos">944</span></a>                <span class="p">)</span>
</span><span id="ValveTestWindow.run_test-945"><a href="#ValveTestWindow.run_test-945"><span class="linenos">945</span></a>
</span><span id="ValveTestWindow.run_test-946"><a href="#ValveTestWindow.run_test-946"><span class="linenos">946</span></a>                <span class="k">if</span> <span class="n">remaining_tests</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">():</span>
</span><span id="ValveTestWindow.run_test-947"><a href="#ValveTestWindow.run_test-947"><span class="linenos">947</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event1&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">pair_number</span><span class="p">)</span>
</span><span id="ValveTestWindow.run_test-948"><a href="#ValveTestWindow.run_test-948"><span class="linenos">948</span></a>                <span class="k">if</span> <span class="n">remaining_tests</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">():</span>
</span><span id="ValveTestWindow.run_test-949"><a href="#ValveTestWindow.run_test-949"><span class="linenos">949</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;event0&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">pair_number</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Listens for messages from the Arduino during an active test sequence (runs in a background thread).</p>

<p>Sends the initial 'start test' command byte to the Arduino. Enters a loop
that continues as long as <code>self.test_running</code> is True and <code>self.stop_event</code>
is not set. Checks for incoming data from the Arduino. Reads bytes indicating
if more tests remain and the number of the just-completed pair. Generates
custom Tkinter events (<code>&lt;&lt;event1&gt;&gt;</code> for input dispensed liquid prompt, <code>&lt;&lt;event0&gt;&gt;</code> for test completion)
to communicate back to the main GUI thread safely. Updates the main button state to 'ABORT TESTING'.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.abort_test" class="classattr">
                                        <input id="ValveTestWindow.abort_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">abort_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.abort_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.abort_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.abort_test-951"><a href="#ValveTestWindow.abort_test-951"><span class="linenos">951</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">abort_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.abort_test-952"><a href="#ValveTestWindow.abort_test-952"><span class="linenos">952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.abort_test-953"><a href="#ValveTestWindow.abort_test-953"><span class="linenos">953</span></a><span class="sd">        Aborts an ongoing test sequence.</span>
</span><span id="ValveTestWindow.abort_test-954"><a href="#ValveTestWindow.abort_test-954"><span class="linenos">954</span></a>
</span><span id="ValveTestWindow.abort_test-955"><a href="#ValveTestWindow.abort_test-955"><span class="linenos">955</span></a><span class="sd">        Sets the `self.stop_event` to signal the `run_test` listener thread to exit.</span>
</span><span id="ValveTestWindow.abort_test-956"><a href="#ValveTestWindow.abort_test-956"><span class="linenos">956</span></a><span class="sd">        Sets `self.test_running` to False. Sends the abort *testing* command byte</span>
</span><span id="ValveTestWindow.abort_test-957"><a href="#ValveTestWindow.abort_test-957"><span class="linenos">957</span></a><span class="sd">        (`np.int8(0).tobytes()`) to the Arduino. Resets the main button state to &#39;Start Testing&#39;.</span>
</span><span id="ValveTestWindow.abort_test-958"><a href="#ValveTestWindow.abort_test-958"><span class="linenos">958</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.abort_test-959"><a href="#ValveTestWindow.abort_test-959"><span class="linenos">959</span></a>        <span class="c1"># if test is aborted, stop the test listener thread</span>
</span><span id="ValveTestWindow.abort_test-960"><a href="#ValveTestWindow.abort_test-960"><span class="linenos">960</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.abort_test-961"><a href="#ValveTestWindow.abort_test-961"><span class="linenos">961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.abort_test-962"><a href="#ValveTestWindow.abort_test-962"><span class="linenos">962</span></a>
</span><span id="ValveTestWindow.abort_test-963"><a href="#ValveTestWindow.abort_test-963"><span class="linenos">963</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="ValveTestWindow.abort_test-964"><a href="#ValveTestWindow.abort_test-964"><span class="linenos">964</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow.abort_test-965"><a href="#ValveTestWindow.abort_test-965"><span class="linenos">965</span></a>        <span class="c1">###====SENDING ABORT TEST COMMAND====###</span>
</span><span id="ValveTestWindow.abort_test-966"><a href="#ValveTestWindow.abort_test-966"><span class="linenos">966</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="ValveTestWindow.abort_test-967"><a href="#ValveTestWindow.abort_test-967"><span class="linenos">967</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Aborts an ongoing test sequence.</p>

<p>Sets the <code>self.stop_event</code> to signal the <code><a href="#ValveTestWindow.run_test">run_test</a></code> listener thread to exit.
Sets <code>self.test_running</code> to False. Sends the abort <em>testing</em> command byte
(<code>np.int8(0).tobytes()</code>) to the Arduino. Resets the main button state to 'Start Testing'.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.testing_complete" class="classattr">
                                        <input id="ValveTestWindow.testing_complete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">testing_complete</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">event</span><span class="p">:</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Event</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ValveTestWindow.testing_complete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.testing_complete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.testing_complete-969"><a href="#ValveTestWindow.testing_complete-969"><span class="linenos">969</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">testing_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">tk</span><span class="o">.</span><span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ValveTestWindow.testing_complete-970"><a href="#ValveTestWindow.testing_complete-970"><span class="linenos">970</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.testing_complete-971"><a href="#ValveTestWindow.testing_complete-971"><span class="linenos">971</span></a><span class="sd">        Handles the final steps after the Arduino signals test completion.</span>
</span><span id="ValveTestWindow.testing_complete-972"><a href="#ValveTestWindow.testing_complete-972"><span class="linenos">972</span></a>
</span><span id="ValveTestWindow.testing_complete-973"><a href="#ValveTestWindow.testing_complete-973"><span class="linenos">973</span></a><span class="sd">        Calls `take_input` one last time for the final test pair (using `pair_num_override`).</span>
</span><span id="ValveTestWindow.testing_complete-974"><a href="#ValveTestWindow.testing_complete-974"><span class="linenos">974</span></a>
</span><span id="ValveTestWindow.testing_complete-975"><a href="#ValveTestWindow.testing_complete-975"><span class="linenos">975</span></a><span class="sd">        Resets the main button state and `self.test_running` flag. Sets the</span>
</span><span id="ValveTestWindow.testing_complete-976"><a href="#ValveTestWindow.testing_complete-976"><span class="linenos">976</span></a><span class="sd">        `self.stop_event` to ensure the listener thread terminates cleanly.</span>
</span><span id="ValveTestWindow.testing_complete-977"><a href="#ValveTestWindow.testing_complete-977"><span class="linenos">977</span></a><span class="sd">        Calls `auto_update_durations` to process the collected data and suggest timing changes.</span>
</span><span id="ValveTestWindow.testing_complete-978"><a href="#ValveTestWindow.testing_complete-978"><span class="linenos">978</span></a>
</span><span id="ValveTestWindow.testing_complete-979"><a href="#ValveTestWindow.testing_complete-979"><span class="linenos">979</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.testing_complete-980"><a href="#ValveTestWindow.testing_complete-980"><span class="linenos">980</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.testing_complete-981"><a href="#ValveTestWindow.testing_complete-981"><span class="linenos">981</span></a><span class="sd">        - **event** (*tk.Event*): The custom event (`&lt;&lt;event0&gt;&gt;`) generated by `run_test`, carrying the final pair number in `event.state`.</span>
</span><span id="ValveTestWindow.testing_complete-982"><a href="#ValveTestWindow.testing_complete-982"><span class="linenos">982</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.testing_complete-983"><a href="#ValveTestWindow.testing_complete-983"><span class="linenos">983</span></a>        <span class="c1"># take input from last pair/valve</span>
</span><span id="ValveTestWindow.testing_complete-984"><a href="#ValveTestWindow.testing_complete-984"><span class="linenos">984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">take_input</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair_num_override</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span><span id="ValveTestWindow.testing_complete-985"><a href="#ValveTestWindow.testing_complete-985"><span class="linenos">985</span></a>        <span class="c1"># reconfigure the testing button and testing state</span>
</span><span id="ValveTestWindow.testing_complete-986"><a href="#ValveTestWindow.testing_complete-986"><span class="linenos">986</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
</span><span id="ValveTestWindow.testing_complete-987"><a href="#ValveTestWindow.testing_complete-987"><span class="linenos">987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">valve_test_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Start Testing&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.testing_complete-988"><a href="#ValveTestWindow.testing_complete-988"><span class="linenos">988</span></a>
</span><span id="ValveTestWindow.testing_complete-989"><a href="#ValveTestWindow.testing_complete-989"><span class="linenos">989</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ValveTestWindow.testing_complete-990"><a href="#ValveTestWindow.testing_complete-990"><span class="linenos">990</span></a>        <span class="c1"># stop the arduino testing listener thread</span>
</span><span id="ValveTestWindow.testing_complete-991"><a href="#ValveTestWindow.testing_complete-991"><span class="linenos">991</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="ValveTestWindow.testing_complete-992"><a href="#ValveTestWindow.testing_complete-992"><span class="linenos">992</span></a>
</span><span id="ValveTestWindow.testing_complete-993"><a href="#ValveTestWindow.testing_complete-993"><span class="linenos">993</span></a>        <span class="c1"># update valves and such</span>
</span><span id="ValveTestWindow.testing_complete-994"><a href="#ValveTestWindow.testing_complete-994"><span class="linenos">994</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_update_durations</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Handles the final steps after the Arduino signals test completion.</p>

<p>Calls <code><a href="#ValveTestWindow.take_input">take_input</a></code> one last time for the final test pair (using <code>pair_num_override</code>).</p>

<p>Resets the main button state and <code>self.test_running</code> flag. Sets the
<code>self.stop_event</code> to ensure the listener thread terminates cleanly.
Calls <code><a href="#ValveTestWindow.auto_update_durations">auto_update_durations</a></code> to process the collected data and suggest timing changes.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>event</strong> (<em>tk.Event</em>): The custom event (<code>&lt;&lt;event0&gt;&gt;</code>) generated by <code><a href="#ValveTestWindow.run_test">run_test</a></code>, carrying the final pair number in <code>event.state</code>.</li>
</ul>
</div>


                            </div>
                            <div id="ValveTestWindow.auto_update_durations" class="classattr">
                                        <input id="ValveTestWindow.auto_update_durations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">auto_update_durations</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ValveTestWindow.auto_update_durations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.auto_update_durations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.auto_update_durations-996"><a href="#ValveTestWindow.auto_update_durations-996"><span class="linenos"> 996</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">auto_update_durations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ValveTestWindow.auto_update_durations-997"><a href="#ValveTestWindow.auto_update_durations-997"><span class="linenos"> 997</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.auto_update_durations-998"><a href="#ValveTestWindow.auto_update_durations-998"><span class="linenos"> 998</span></a><span class="sd">        This function is similar to the `views.valve_testing.manual_time_adjustment_window.ManualTimeAdjustment.write_timing_changes` function, it</span>
</span><span id="ValveTestWindow.auto_update_durations-999"><a href="#ValveTestWindow.auto_update_durations-999"><span class="linenos"> 999</span></a><span class="sd">        calculates new valve durations based on test results and desired volume.</span>
</span><span id="ValveTestWindow.auto_update_durations-1000"><a href="#ValveTestWindow.auto_update_durations-1000"><span class="linenos">1000</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1001"><a href="#ValveTestWindow.auto_update_durations-1001"><span class="linenos">1001</span></a><span class="sd">        Loads the current &#39;selected&#39; durations. Iterates through the collected</span>
</span><span id="ValveTestWindow.auto_update_durations-1002"><a href="#ValveTestWindow.auto_update_durations-1002"><span class="linenos">1002</span></a><span class="sd">        `self.ml_dispensed` data. For each tested valve, it calculates the actual</span>
</span><span id="ValveTestWindow.auto_update_durations-1003"><a href="#ValveTestWindow.auto_update_durations-1003"><span class="linenos">1003</span></a><span class="sd">        volume dispensed per actuation and compares it to the desired volume per actuation.</span>
</span><span id="ValveTestWindow.auto_update_durations-1004"><a href="#ValveTestWindow.auto_update_durations-1004"><span class="linenos">1004</span></a><span class="sd">        It computes a new duration using a ratio (`new_duration = old_duration * (desired_vol / actual_vol)`).</span>
</span><span id="ValveTestWindow.auto_update_durations-1005"><a href="#ValveTestWindow.auto_update_durations-1005"><span class="linenos">1005</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1006"><a href="#ValveTestWindow.auto_update_durations-1006"><span class="linenos">1006</span></a><span class="sd">        Updates the corresponding duration in the local copies of the side_one/side_two arrays.</span>
</span><span id="ValveTestWindow.auto_update_durations-1007"><a href="#ValveTestWindow.auto_update_durations-1007"><span class="linenos">1007</span></a><span class="sd">        Updates the table display for the valve using `update_table_entry_test_status`.</span>
</span><span id="ValveTestWindow.auto_update_durations-1008"><a href="#ValveTestWindow.auto_update_durations-1008"><span class="linenos">1008</span></a><span class="sd">        Compiles a list of changes (`changed_durations`) and opens the `ValveChanges`</span>
</span><span id="ValveTestWindow.auto_update_durations-1009"><a href="#ValveTestWindow.auto_update_durations-1009"><span class="linenos">1009</span></a><span class="sd">        confirmation window, passing the changes and the `confirm_valve_changes` callback.</span>
</span><span id="ValveTestWindow.auto_update_durations-1010"><a href="#ValveTestWindow.auto_update_durations-1010"><span class="linenos">1010</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.auto_update_durations-1011"><a href="#ValveTestWindow.auto_update_durations-1011"><span class="linenos">1011</span></a>        <span class="c1"># list of tuples of tuples ==&gt; [(valve, (old_dur, new_dur))] sent to ChangesWindow instance, so that</span>
</span><span id="ValveTestWindow.auto_update_durations-1012"><a href="#ValveTestWindow.auto_update_durations-1012"><span class="linenos">1012</span></a>        <span class="c1"># user can confirm duration changes</span>
</span><span id="ValveTestWindow.auto_update_durations-1013"><a href="#ValveTestWindow.auto_update_durations-1013"><span class="linenos">1013</span></a>        <span class="n">changed_durations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ValveTestWindow.auto_update_durations-1014"><a href="#ValveTestWindow.auto_update_durations-1014"><span class="linenos">1014</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1015"><a href="#ValveTestWindow.auto_update_durations-1015"><span class="linenos">1015</span></a>        <span class="c1">## save current durations in the oldest valve duration archival location</span>
</span><span id="ValveTestWindow.auto_update_durations-1016"><a href="#ValveTestWindow.auto_update_durations-1016"><span class="linenos">1016</span></a>        <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">date_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">load_durations</span><span class="p">()</span>
</span><span id="ValveTestWindow.auto_update_durations-1017"><a href="#ValveTestWindow.auto_update_durations-1017"><span class="linenos">1017</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1018"><a href="#ValveTestWindow.auto_update_durations-1018"><span class="linenos">1018</span></a>        <span class="n">side_one_old</span> <span class="o">=</span> <span class="n">side_one</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ValveTestWindow.auto_update_durations-1019"><a href="#ValveTestWindow.auto_update_durations-1019"><span class="linenos">1019</span></a>        <span class="n">side_two_old</span> <span class="o">=</span> <span class="n">side_two</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ValveTestWindow.auto_update_durations-1020"><a href="#ValveTestWindow.auto_update_durations-1020"><span class="linenos">1020</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1021"><a href="#ValveTestWindow.auto_update_durations-1021"><span class="linenos">1021</span></a>        <span class="k">for</span> <span class="n">valve</span><span class="p">,</span> <span class="n">dispensed_amt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_dispensed</span><span class="p">:</span>
</span><span id="ValveTestWindow.auto_update_durations-1022"><a href="#ValveTestWindow.auto_update_durations-1022"><span class="linenos">1022</span></a>            <span class="n">logical_valve</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow.auto_update_durations-1023"><a href="#ValveTestWindow.auto_update_durations-1023"><span class="linenos">1023</span></a>            <span class="n">tested_duration</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow.auto_update_durations-1024"><a href="#ValveTestWindow.auto_update_durations-1024"><span class="linenos">1024</span></a>            <span class="n">side_durations</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ValveTestWindow.auto_update_durations-1025"><a href="#ValveTestWindow.auto_update_durations-1025"><span class="linenos">1025</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1026"><a href="#ValveTestWindow.auto_update_durations-1026"><span class="linenos">1026</span></a>            <span class="k">if</span> <span class="n">valve</span> <span class="o">&gt;</span> <span class="n">VALVES_PER_SIDE</span><span class="p">:</span>
</span><span id="ValveTestWindow.auto_update_durations-1027"><a href="#ValveTestWindow.auto_update_durations-1027"><span class="linenos">1027</span></a>                <span class="n">logical_valve</span> <span class="o">=</span> <span class="p">(</span><span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">VALVES_PER_SIDE</span>
</span><span id="ValveTestWindow.auto_update_durations-1028"><a href="#ValveTestWindow.auto_update_durations-1028"><span class="linenos">1028</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1029"><a href="#ValveTestWindow.auto_update_durations-1029"><span class="linenos">1029</span></a>                <span class="n">tested_duration</span> <span class="o">=</span> <span class="n">side_two</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span>
</span><span id="ValveTestWindow.auto_update_durations-1030"><a href="#ValveTestWindow.auto_update_durations-1030"><span class="linenos">1030</span></a>                <span class="n">side_durations</span> <span class="o">=</span> <span class="n">side_two</span>
</span><span id="ValveTestWindow.auto_update_durations-1031"><a href="#ValveTestWindow.auto_update_durations-1031"><span class="linenos">1031</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ValveTestWindow.auto_update_durations-1032"><a href="#ValveTestWindow.auto_update_durations-1032"><span class="linenos">1032</span></a>                <span class="n">logical_valve</span> <span class="o">=</span> <span class="n">valve</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ValveTestWindow.auto_update_durations-1033"><a href="#ValveTestWindow.auto_update_durations-1033"><span class="linenos">1033</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1034"><a href="#ValveTestWindow.auto_update_durations-1034"><span class="linenos">1034</span></a>                <span class="n">tested_duration</span> <span class="o">=</span> <span class="n">side_one</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span>
</span><span id="ValveTestWindow.auto_update_durations-1035"><a href="#ValveTestWindow.auto_update_durations-1035"><span class="linenos">1035</span></a>                <span class="n">side_durations</span> <span class="o">=</span> <span class="n">side_one</span>
</span><span id="ValveTestWindow.auto_update_durations-1036"><a href="#ValveTestWindow.auto_update_durations-1036"><span class="linenos">1036</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1037"><a href="#ValveTestWindow.auto_update_durations-1037"><span class="linenos">1037</span></a>            <span class="c1"># divide by 1000 to get to mL from ul</span>
</span><span id="ValveTestWindow.auto_update_durations-1038"><a href="#ValveTestWindow.auto_update_durations-1038"><span class="linenos">1038</span></a>            <span class="n">desired_per_open_vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_volume</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="ValveTestWindow.auto_update_durations-1039"><a href="#ValveTestWindow.auto_update_durations-1039"><span class="linenos">1039</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1040"><a href="#ValveTestWindow.auto_update_durations-1040"><span class="linenos">1040</span></a>            <span class="c1"># divide by 1000 to get amount per opening, NOT changing units</span>
</span><span id="ValveTestWindow.auto_update_durations-1041"><a href="#ValveTestWindow.auto_update_durations-1041"><span class="linenos">1041</span></a>            <span class="n">actual_per_open_vol</span> <span class="o">=</span> <span class="n">dispensed_amt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuations</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="ValveTestWindow.auto_update_durations-1042"><a href="#ValveTestWindow.auto_update_durations-1042"><span class="linenos">1042</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1043"><a href="#ValveTestWindow.auto_update_durations-1043"><span class="linenos">1043</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update_table_entry_test_status</span><span class="p">(</span><span class="n">valve</span><span class="p">,</span> <span class="n">actual_per_open_vol</span><span class="p">)</span>
</span><span id="ValveTestWindow.auto_update_durations-1044"><a href="#ValveTestWindow.auto_update_durations-1044"><span class="linenos">1044</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1045"><a href="#ValveTestWindow.auto_update_durations-1045"><span class="linenos">1045</span></a>            <span class="n">new_duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="ValveTestWindow.auto_update_durations-1046"><a href="#ValveTestWindow.auto_update_durations-1046"><span class="linenos">1046</span></a>                <span class="n">tested_duration</span> <span class="o">*</span> <span class="p">(</span><span class="n">desired_per_open_vol</span> <span class="o">/</span> <span class="n">actual_per_open_vol</span><span class="p">)</span>
</span><span id="ValveTestWindow.auto_update_durations-1047"><a href="#ValveTestWindow.auto_update_durations-1047"><span class="linenos">1047</span></a>            <span class="p">)</span>
</span><span id="ValveTestWindow.auto_update_durations-1048"><a href="#ValveTestWindow.auto_update_durations-1048"><span class="linenos">1048</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1049"><a href="#ValveTestWindow.auto_update_durations-1049"><span class="linenos">1049</span></a>            <span class="n">side_durations</span><span class="p">[</span><span class="n">logical_valve</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_duration</span>
</span><span id="ValveTestWindow.auto_update_durations-1050"><a href="#ValveTestWindow.auto_update_durations-1050"><span class="linenos">1050</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1051"><a href="#ValveTestWindow.auto_update_durations-1051"><span class="linenos">1051</span></a>            <span class="n">changed_durations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">valve</span><span class="p">,</span> <span class="p">(</span><span class="n">tested_duration</span><span class="p">,</span> <span class="n">new_duration</span><span class="p">)))</span>
</span><span id="ValveTestWindow.auto_update_durations-1052"><a href="#ValveTestWindow.auto_update_durations-1052"><span class="linenos">1052</span></a>
</span><span id="ValveTestWindow.auto_update_durations-1053"><a href="#ValveTestWindow.auto_update_durations-1053"><span class="linenos">1053</span></a>        <span class="n">ValveChanges</span><span class="p">(</span>
</span><span id="ValveTestWindow.auto_update_durations-1054"><a href="#ValveTestWindow.auto_update_durations-1054"><span class="linenos">1054</span></a>            <span class="n">changed_durations</span><span class="p">,</span>
</span><span id="ValveTestWindow.auto_update_durations-1055"><a href="#ValveTestWindow.auto_update_durations-1055"><span class="linenos">1055</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_valve_changes</span><span class="p">(</span>
</span><span id="ValveTestWindow.auto_update_durations-1056"><a href="#ValveTestWindow.auto_update_durations-1056"><span class="linenos">1056</span></a>                <span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="n">side_one_old</span><span class="p">,</span> <span class="n">side_two_old</span>
</span><span id="ValveTestWindow.auto_update_durations-1057"><a href="#ValveTestWindow.auto_update_durations-1057"><span class="linenos">1057</span></a>            <span class="p">),</span>
</span><span id="ValveTestWindow.auto_update_durations-1058"><a href="#ValveTestWindow.auto_update_durations-1058"><span class="linenos">1058</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function is similar to the <code>views.valve_testing.manual_time_adjustment_window.ManualTimeAdjustment.write_timing_changes</code> function, it
calculates new valve durations based on test results and desired volume.</p>

<p>Loads the current 'selected' durations. Iterates through the collected
<code>self.ml_dispensed</code> data. For each tested valve, it calculates the actual
volume dispensed per actuation and compares it to the desired volume per actuation.
It computes a new duration using a ratio (<code>new_duration = old_duration * (desired_vol / actual_vol)</code>).</p>

<p>Updates the corresponding duration in the local copies of the side_one/side_two arrays.
Updates the table display for the valve using <code><a href="#ValveTestWindow.update_table_entry_test_status">update_table_entry_test_status</a></code>.
Compiles a list of changes (<code>changed_durations</code>) and opens the <code>ValveChanges</code>
confirmation window, passing the changes and the <code><a href="#ValveTestWindow.confirm_valve_changes">confirm_valve_changes</a></code> callback.</p>
</div>


                            </div>
                            <div id="ValveTestWindow.confirm_valve_changes" class="classattr">
                                        <input id="ValveTestWindow.confirm_valve_changes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">confirm_valve_changes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">side_one</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]]</span>,</span><span class="param">	<span class="n">side_two</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]]</span>,</span><span class="param">	<span class="n">side_one_old</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]]</span>,</span><span class="param">	<span class="n">side_two_old</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ValveTestWindow.confirm_valve_changes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ValveTestWindow.confirm_valve_changes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ValveTestWindow.confirm_valve_changes-1060"><a href="#ValveTestWindow.confirm_valve_changes-1060"><span class="linenos">1060</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">confirm_valve_changes</span><span class="p">(</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1061"><a href="#ValveTestWindow.confirm_valve_changes-1061"><span class="linenos">1061</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1062"><a href="#ValveTestWindow.confirm_valve_changes-1062"><span class="linenos">1062</span></a>        <span class="n">side_one</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1063"><a href="#ValveTestWindow.confirm_valve_changes-1063"><span class="linenos">1063</span></a>        <span class="n">side_two</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1064"><a href="#ValveTestWindow.confirm_valve_changes-1064"><span class="linenos">1064</span></a>        <span class="n">side_one_old</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1065"><a href="#ValveTestWindow.confirm_valve_changes-1065"><span class="linenos">1065</span></a>        <span class="n">side_two_old</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1066"><a href="#ValveTestWindow.confirm_valve_changes-1066"><span class="linenos">1066</span></a>    <span class="p">):</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1067"><a href="#ValveTestWindow.confirm_valve_changes-1067"><span class="linenos">1067</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1068"><a href="#ValveTestWindow.confirm_valve_changes-1068"><span class="linenos">1068</span></a><span class="sd">        Callback function executed when changes are confirmed in the ValveChanges window.</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1069"><a href="#ValveTestWindow.confirm_valve_changes-1069"><span class="linenos">1069</span></a>
</span><span id="ValveTestWindow.confirm_valve_changes-1070"><a href="#ValveTestWindow.confirm_valve_changes-1070"><span class="linenos">1070</span></a><span class="sd">        Instructs `self.arduino_data` to first save the `side_one_old` and `side_two_old`</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1071"><a href="#ValveTestWindow.confirm_valve_changes-1071"><span class="linenos">1071</span></a><span class="sd">        arrays to an archive slot, and then save the newly calculated `side_one` and `side_two`</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1072"><a href="#ValveTestWindow.confirm_valve_changes-1072"><span class="linenos">1072</span></a><span class="sd">        arrays as the &#39;selected&#39; durations.</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1073"><a href="#ValveTestWindow.confirm_valve_changes-1073"><span class="linenos">1073</span></a>
</span><span id="ValveTestWindow.confirm_valve_changes-1074"><a href="#ValveTestWindow.confirm_valve_changes-1074"><span class="linenos">1074</span></a><span class="sd">        Parameters</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1075"><a href="#ValveTestWindow.confirm_valve_changes-1075"><span class="linenos">1075</span></a><span class="sd">        ----------</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1076"><a href="#ValveTestWindow.confirm_valve_changes-1076"><span class="linenos">1076</span></a><span class="sd">        - **side_one** (*npt.NDArray[np.int32]*): The numpy array containing the newly calculated durations for side one valves.</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1077"><a href="#ValveTestWindow.confirm_valve_changes-1077"><span class="linenos">1077</span></a><span class="sd">        - **side_two** (*npt.NDArray[np.int32]*): The numpy array containing the newly calculated durations for side two valves.</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1078"><a href="#ValveTestWindow.confirm_valve_changes-1078"><span class="linenos">1078</span></a><span class="sd">        - **side_one_old** (*npt.NDArray[np.int32]*): The numpy array containing the durations for side one valves *before* the test.</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1079"><a href="#ValveTestWindow.confirm_valve_changes-1079"><span class="linenos">1079</span></a><span class="sd">        - **side_two_old** (*npt.NDArray[np.int32]*): The numpy array containing the durations for side two valves *before* the test.</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1080"><a href="#ValveTestWindow.confirm_valve_changes-1080"><span class="linenos">1080</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1081"><a href="#ValveTestWindow.confirm_valve_changes-1081"><span class="linenos">1081</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">save_durations</span><span class="p">(</span><span class="n">side_one_old</span><span class="p">,</span> <span class="n">side_two_old</span><span class="p">,</span> <span class="s2">&quot;archive&quot;</span><span class="p">)</span>
</span><span id="ValveTestWindow.confirm_valve_changes-1082"><a href="#ValveTestWindow.confirm_valve_changes-1082"><span class="linenos">1082</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_data</span><span class="o">.</span><span class="n">save_durations</span><span class="p">(</span><span class="n">side_one</span><span class="p">,</span> <span class="n">side_two</span><span class="p">,</span> <span class="s2">&quot;selected&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Callback function executed when changes are confirmed in the ValveChanges window.</p>

<p>Instructs <code>self.arduino_data</code> to first save the <code>side_one_old</code> and <code>side_two_old</code>
arrays to an archive slot, and then save the newly calculated <code>side_one</code> and <code>side_two</code>
arrays as the 'selected' durations.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><strong>side_one</strong> (<em>npt.NDArray[np.int32]</em>): The numpy array containing the newly calculated durations for side one valves.</li>
<li><strong>side_two</strong> (<em>npt.NDArray[np.int32]</em>): The numpy array containing the newly calculated durations for side two valves.</li>
<li><strong>side_one_old</strong> (<em>npt.NDArray[np.int32]</em>): The numpy array containing the durations for side one valves <em>before</em> the test.</li>
<li><strong>side_two_old</strong> (<em>npt.NDArray[np.int32]</em>): The numpy array containing the durations for side two valves <em>before</em> the test.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>